USE [NEOE]
GO

/****** Object:  StoredProcedure [NEOE].[SP_CZ_PR_ID_NO_HISTORYL_S]    Script Date: 2019-03-26 오전 11:26:39 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

ALTER PROCEDURE [NEOE].[SP_CZ_PR_ID_NO_HISTORYL_S]
(
    @P_CD_COMPANY   NVARCHAR(7),
    @P_NO_WO        NVARCHAR(20),
	@P_SEQ_WO		NUMERIC(5, 0)
)
AS

SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED

SELECT WR.NO_WO,
       @P_SEQ_WO AS SEQ_WO,
	   WR.NO_LINE,
	   WR.CD_OP,
	   WR.CD_WC,
	   MW.NM_WC,
	   WR.CD_WCOP,
	   OP.NM_OP,
	   WR.CD_EQUIP,
	   EQ.NM_EQUIP,
	   WR.ST_OP,
	   CD.NM_SYSDEF AS NM_ST_OP,
	   WR.QT_WO,
	   WR.QT_START,
	   WR.QT_WORK,
	   WR.QT_MOVE,
	   WR.QT_WIP,
	   (CASE WHEN EXISTS (SELECT 1 
						  FROM CZ_PR_WO_INSP WI
						  WHERE WI.CD_COMPANY = WR.CD_COMPANY
						  AND WI.NO_WO = WR.NO_WO
						  AND WI.NO_LINE = WR.NO_LINE
						  AND WI.NO_INSP = -1) THEN 'Y' ELSE 'N' END) AS YN_BAD
FROM PR_WO_ROUT WR
LEFT JOIN MA_WC MW ON MW.CD_COMPANY = WR.CD_COMPANY AND MW.CD_PLANT = WR.CD_PLANT AND MW.CD_WC = WR.CD_WC
LEFT JOIN PR_WCOP OP ON OP.CD_COMPANY = WR.CD_COMPANY AND OP.CD_PLANT = WR.CD_PLANT AND OP.CD_WC = WR.CD_WC AND OP.CD_WCOP = WR.CD_WCOP
LEFT JOIN PR_EQUIP EQ ON EQ.CD_COMPANY = WR.CD_COMPANY AND EQ.CD_PLANT = WR.CD_PLANT AND EQ.CD_EQUIP = WR.CD_EQUIP
LEFT JOIN MA_CODEDTL CD ON CD.CD_COMPANY = WR.CD_COMPANY AND CD.CD_FIELD = 'PR_0000009' AND CD.CD_SYSDEF = WR.ST_OP
WHERE WR.CD_COMPANY = @P_CD_COMPANY
AND WR.NO_WO = @P_NO_WO
ORDER BY WR.NO_LINE

GO