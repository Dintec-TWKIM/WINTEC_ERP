USE [NEOE]
GO
/****** Object:  StoredProcedure [NEOE].[SP_CZ_PR_ROUT_INSP_SUB_S]    Script Date: 2021-02-18 오후 1:09:25 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

ALTER PROCEDURE [NEOE].[SP_CZ_PR_ROUT_INSP_SUB_S]
(
	@P_CD_COMPANY	NVARCHAR(7),
	@P_CD_PLANT		NVARCHAR(7),
	@P_CD_ITEM		NVARCHAR(20),
	@P_NO_OPPATH	NVARCHAR(3),
	@P_CD_OP		NVARCHAR(4),
	@P_CD_WCOP		NVARCHAR(7),
	@P_YN_USE		NVARCHAR(1)
)
AS

SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED

SELECT RI.CD_COMPANY,
	   RI.CD_PLANT,
	   RI.CD_ITEM,
	   MI.NM_ITEM,
	   RI.NO_OPPATH,
	   RI.CD_OP,
	   RI.CD_WCOP,
	   WP.NM_OP,
	   RI.NO_INSP,
	   RI.DC_ITEM,
	   RI.CD_MEASURE,
	   RI.DC_MEASURE,
	   RI.DC_LOCATION,
	   RI.DC_SPEC,
	   RI.QT_MIN,
	   RI.QT_MAX,
	   RI.TP_DATA,
	   CONVERT(CHAR(1), RI.CNT_INSP) AS CNT_INSP,
	   ISNULL(RI.YN_CERT,'N') AS YN_CERT,
	   RI.YN_SAMPLING,
	   RI.YN_USE,
	   RI.YN_ASSY,
	   RI.CD_CLEAR_GRP,
	   RI.DC_RMK
FROM CZ_PR_ROUT_INSP RI
LEFT JOIN PR_ROUT_L RL ON RL.CD_COMPANY = RI.CD_COMPANY AND RL.CD_PLANT = RI.CD_PLANT AND RL.CD_ITEM = RI.CD_ITEM AND RL.NO_OPPATH = RI.NO_OPPATH AND RL.CD_OP = RI.CD_OP
LEFT JOIN PR_WCOP WP ON WP.CD_COMPANY = RL.CD_COMPANY AND WP.CD_PLANT = RL.CD_PLANT AND WP.CD_WC = RL.CD_WC AND WP.CD_WCOP = RL.CD_WCOP
LEFT JOIN MA_PITEM MI ON MI.CD_COMPANY = RI.CD_COMPANY AND MI.CD_PLANT = RI.CD_PLANT AND MI.CD_ITEM = RI.CD_ITEM
WHERE RI.CD_COMPANY = @P_CD_COMPANY
AND RI.CD_PLANT = @P_CD_PLANT
AND (ISNULL(@P_CD_ITEM, '') = '' OR RI.CD_ITEM = @P_CD_ITEM)
AND (ISNULL(@P_NO_OPPATH, '') = '' OR RI.NO_OPPATH = @P_NO_OPPATH)
AND (ISNULL(@P_CD_OP, '') = '' OR RI.CD_OP = @P_CD_OP)
AND (ISNULL(@P_CD_WCOP, '') = '' OR RI.CD_WCOP = @P_CD_WCOP)
AND (ISNULL(@P_YN_USE, 'N') = 'N' OR RI.YN_USE = 'Y')