USE [NEOE]
GO

/****** Object:  StoredProcedure [NEOE].[SP_CZ_PR_POP_REG_SUB1_I]    Script Date: 2017-01-05 오후 5:48:55 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

ALTER PROCEDURE [NEOE].[SP_CZ_PR_POP_REG_SUB1_I]          
(
	@P_CD_COMPANY	NVARCHAR(7),
	@P_NO_WO		NVARCHAR(20),
	@P_SEQ_WO		NUMERIC(5, 0),
	@P_NO_LINE		NUMERIC(5, 0),
	@P_NO_INSP		NUMERIC(4, 0),
	@P_NO_EMP		NVARCHAR(10),
	@P_NO_SPEC		NUMERIC(18, 4),
	@P_NO_DATA1		NUMERIC(18, 4),
	@P_NO_DATA2		NUMERIC(18, 4),
	@P_NO_DATA3		NUMERIC(18, 4),
	@P_NO_DATA4		NUMERIC(18, 4),
	@P_NO_DATA5		NUMERIC(18, 4),
	@P_ID_INSERT	NVARCHAR(15)
)  
AS

SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED

IF EXISTS (SELECT 1 
		   FROM CZ_PR_WO_INSP WI 
		   WHERE WI.CD_COMPANY = @P_CD_COMPANY
		   AND WI.NO_WO = @P_NO_WO
		   AND WI.SEQ_WO = @P_SEQ_WO
		   AND WI.NO_LINE = @P_NO_LINE
		   AND WI.NO_INSP = @P_NO_INSP)
BEGIN
	UPDATE CZ_PR_WO_INSP
	SET DT_INSP = CONVERT(CHAR(8), GETDATE(), 112),
		NO_EMP = @P_NO_EMP,
		NO_DATA1 = (CASE WHEN @P_NO_SPEC = 0 THEN @P_NO_DATA1 ELSE (@P_NO_SPEC + (@P_NO_DATA1 / 1000.0)) END),
		NO_DATA2 = (CASE WHEN @P_NO_SPEC = 0 THEN @P_NO_DATA2 ELSE (@P_NO_SPEC + (@P_NO_DATA2 / 1000.0)) END),
		NO_DATA3 = (CASE WHEN @P_NO_SPEC = 0 THEN @P_NO_DATA3 ELSE (@P_NO_SPEC + (@P_NO_DATA3 / 1000.0)) END),
		NO_DATA4 = (CASE WHEN @P_NO_SPEC = 0 THEN @P_NO_DATA4 ELSE (@P_NO_SPEC + (@P_NO_DATA4 / 1000.0)) END),
		NO_DATA5 = (CASE WHEN @P_NO_SPEC = 0 THEN @P_NO_DATA5 ELSE (@P_NO_SPEC + (@P_NO_DATA5 / 1000.0)) END),
		DTS_UPDATE = NEOE.SF_SYSDATE(GETDATE()),
		ID_UPDATE = @P_ID_INSERT
	WHERE CD_COMPANY = @P_CD_COMPANY
	AND NO_WO = @P_NO_WO
	AND SEQ_WO = @P_SEQ_WO
	AND NO_LINE = @P_NO_LINE
	AND NO_INSP = @P_NO_INSP
END
ELSE
BEGIN
	INSERT INTO CZ_PR_WO_INSP
	(
		CD_COMPANY,
		NO_WO,
		SEQ_WO,
		NO_LINE,
		NO_INSP,
		DT_INSP,
		NO_EMP,
		NO_DATA1,
		NO_DATA2,
		NO_DATA3,
		NO_DATA4,
		NO_DATA5,
		DTS_INSERT,
		ID_INSERT
	)
	VALUES
	(
		@P_CD_COMPANY,
		@P_NO_WO,
		@P_SEQ_WO,
		@P_NO_LINE,
		@P_NO_INSP,
		CONVERT(CHAR(8), GETDATE(), 112),
		@P_NO_EMP,
		(CASE WHEN @P_NO_SPEC = 0 THEN @P_NO_DATA1 ELSE (@P_NO_SPEC + (@P_NO_DATA1 / 1000.0)) END),
		(CASE WHEN @P_NO_SPEC = 0 THEN @P_NO_DATA2 ELSE (@P_NO_SPEC + (@P_NO_DATA2 / 1000.0)) END),
		(CASE WHEN @P_NO_SPEC = 0 THEN @P_NO_DATA3 ELSE (@P_NO_SPEC + (@P_NO_DATA3 / 1000.0)) END),
		(CASE WHEN @P_NO_SPEC = 0 THEN @P_NO_DATA4 ELSE (@P_NO_SPEC + (@P_NO_DATA4 / 1000.0)) END),
		(CASE WHEN @P_NO_SPEC = 0 THEN @P_NO_DATA5 ELSE (@P_NO_SPEC + (@P_NO_DATA5 / 1000.0)) END),
		NEOE.SF_SYSDATE(GETDATE()),
		@P_ID_INSERT
	)
END

GO