SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

ALTER PROCEDURE [NEOE].[SP_CZ_PR_WO_ITEM_GRP_RPT_DL_S]
(  
    @P_CD_COMPANY       NVARCHAR(7),
    @P_CD_PLANT			NVARCHAR(7),
    @P_NO_WO            NVARCHAR(20)
)  
AS

SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED

SELECT
    WR.CD_OP,
    WP.NM_OP,
    WR.CD_WC,
	WC.NM_WC,
    WR.ST_OP,
    CD1.NM_SYSDEF AS NM_ST_OP,
    CASE WHEN ISNULL(WR.QT_WO, 0) = 0 THEN 0 ELSE ROUND((ISNULL(WR.QT_WORK, 0) / WR.QT_WO) * 100, 4) END RT_WORK,
	ISNULL(WR.QT_WO, 0) AS QT_WO,
	ISNULL(WR.QT_WORK, 0) AS QT_WORK,
	ISNULL(QT_START, 0) AS QT_START,
	ISNULL(QT_REJECT, 0) AS QT_REJECT,
	ISNULL(QT_REWORK, 0) AS QT_REWORK,
	ISNULL(QT_MOVE, 0) AS QT_MOVE,
	ISNULL(QT_WIP, 0) AS QT_WIP,
    WR.DT_REL,
	WR.DT_DUE,
    WR.DC_RMK,
	WR.DC_RMK_1,
    WR.NO_SFT,
	SF.NM_SFT,
	WR.CD_EQUIP,
	EQ.NM_EQUIP,
    WO.NO_EMP,
	ME.NM_KOR
FROM PR_WO WO
JOIN PR_WO_ROUT WR ON WR.CD_COMPANY = WO.CD_COMPANY AND WR.CD_PLANT = WO.CD_PLANT AND WR.NO_WO = WO.NO_WO
JOIN PR_WCOP WP ON WP.CD_COMPANY = WR.CD_COMPANY AND WP.CD_PLANT = WR.CD_PLANT AND WP.CD_WCOP = WR.CD_WCOP AND WP.CD_WC = WR.CD_WC
JOIN MA_WC WC ON WC.CD_COMPANY = WR.CD_COMPANY AND WC.CD_PLANT = WR.CD_PLANT AND WC.CD_WC = WR.CD_WC
LEFT JOIN PR_SHIFT SF ON SF.CD_COMPANY = WR.CD_COMPANY AND SF.CD_PLANT = WR.CD_PLANT AND SF.NO_SFT = WR.NO_SFT
LEFT JOIN PR_EQUIP EQ ON EQ.CD_COMPANY = WR.CD_COMPANY AND EQ.CD_PLANT = WR.CD_PLANT AND EQ.CD_EQUIP = WR.CD_EQUIP
LEFT JOIN MA_EMP ME ON WO.CD_COMPANY = ME.CD_COMPANY AND WO.CD_PLANT = ME.CD_PLANT AND WO.NO_EMP = ME.NO_EMP
LEFT JOIN MA_CODEDTL CD1 ON CD1.CD_COMPANY = WR.CD_COMPANY AND CD1.CD_FIELD = 'PR_0000009' AND CD1.CD_SYSDEF = WR.ST_OP
WHERE WO.CD_COMPANY = @P_CD_COMPANY
AND WO.CD_PLANT = @P_CD_PLANT
AND WO.NO_WO = @P_NO_WO
OPTION(RECOMPILE)

GO
