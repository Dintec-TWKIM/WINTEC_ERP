USE [NEOE]
GO
/****** Object:  StoredProcedure [NEOE].[SP_CZ_PR_WO_ITEM_GRP_RPT_GIR_PACK]    Script Date: 2021-02-18 오후 1:19:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

ALTER PROCEDURE [NEOE].[SP_CZ_PR_WO_ITEM_GRP_RPT_GIR_PACK]
(  
    @P_CD_COMPANY   NVARCHAR(7),
	@P_NO_SO		NVARCHAR(20),
	@P_SEQ_SO		NUMERIC(5, 0),
	@P_ID_USER		NVARCHAR(10) 
)  
AS

BEGIN TRAN SP_CZ_PR_GIR_PACK
BEGIN TRY

DECLARE @V_ERRMSG   VARCHAR(255)   -- ERROR 메시지

IF EXISTS (SELECT 1
		   FROM SA_GIRH GH
		   WHERE GH.CD_COMPANY = @P_CD_COMPANY
		   AND EXISTS (SELECT 1 
		   		       FROM SA_GIRL GL
		   			   WHERE GL.CD_COMPANY = GH.CD_COMPANY
		   			   AND GL.NO_GIR = GH.NO_GIR
		   			   AND GL.NO_SO = @P_NO_SO
		   			   AND GL.SEQ_SO = @P_SEQ_SO))
BEGIN
	UPDATE GH
	SET CD_USERDEF1 = 'Y',
	    ID_UPDATE = @P_ID_USER,
		DTS_UPDATE = NEOE.SF_SYSDATE(GETDATE())
	FROM SA_GIRH GH
	WHERE GH.CD_COMPANY = @P_CD_COMPANY
	AND EXISTS (SELECT 1 
			    FROM SA_GIRL GL
				WHERE GL.CD_COMPANY = GH.CD_COMPANY
				AND GL.NO_GIR = GH.NO_GIR
				AND GL.NO_SO = @P_NO_SO
				AND GL.SEQ_SO = @P_SEQ_SO)
END
ELSE
BEGIN
	SELECT @V_ERRMSG = '해당 건으로 납품의뢰된 건이 없습니다.'
	GOTO ERROR
END

COMMIT TRAN SP_CZ_PR_GIR_PACK

END TRY
BEGIN CATCH
	ROLLBACK TRAN SP_CZ_PR_GIR_PACK
	SELECT @V_ERRMSG = ERROR_MESSAGE()
	GOTO ERROR
END CATCH

RETURN
ERROR: 
RAISERROR(@V_ERRMSG, 16, 1)
ROLLBACK TRAN SP_CZ_PR_GIR_PACK

GO