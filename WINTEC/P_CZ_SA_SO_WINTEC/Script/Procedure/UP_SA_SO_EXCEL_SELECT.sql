USE [NEOE]
GO

/****** Object:  StoredProcedure [NEOE].[UP_SA_SO_EXCEL_SELECT]    Script Date: 2019-11-04 오전 10:38:55 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

/*******************************************    
*********************************************/    
ALTER PROCEDURE [NEOE].[UP_SA_SO_EXCEL_SELECT]    
(    
	@P_CD_COMPANY	NVARCHAR(7),
	@P_MULTI_ITEM	NVARCHAR(4000),
	@P_CD_PLANT     NVARCHAR(7),
    @P_FG_LANG     NVARCHAR(4) = NULL	--언어
)    
AS
-- MultiLang Call
EXEC UP_MA_LOCAL_LANGUAGE @P_FG_LANG
    
    
SET NOCOUNT ON    
    
SELECT	CD_ITEM,    
		NM_ITEM,	--품목명    
		STND_ITEM,	--규격    
		UNIT_SO,	--단위    
		UNIT_IM,	--관리단위    
		A.CD_GISL AS CD_SL,    
		MS.NM_SL,      
		A.CD_PLANT,    
		'' DT_DUEDATE,    
		0 QT_SO, LT_GI, UNIT_SO_FACT,
		RTRIM(A.FG_TAX_SA) AS FG_TAX_SA, VT.CD_FLAG1 AS RT_TAX_SA,
		A.FG_SERNO, --002:LOT, 003:SERIAL
		A.GRP_ITEM AS CD_ITEMGRP, IG.NM_ITEMGRP,
		A.EN_ITEM, A.STND_DETAIL_ITEM, A.GRP_MFG, A.TP_ITEM, A.WEIGHT, A.UNIT_WEIGHT,
		A.YN_ATP, A.CUR_ATP_DAY, A.FG_MODEL, A.UNIT_GI_FACT,
		A.NUM_USERDEF1, A.NUM_USERDEF2, A.NUM_USERDEF3, A.NUM_USERDEF4, A.NUM_USERDEF5, A.NUM_USERDEF6, A.NUM_USERDEF7,
		A.MAT_ITEM, A.CD_USERDEF1, A.CD_USERDEF2, A.CD_USERDEF3, A.CD_USERDEF11, A.URL_ITEM, A.NM_MAKER,
		A.CLS_ITEM,
		PL.NM_PLANT,
		A.CLS_L, A.CLS_M, A.CLS_S
FROM	DZSN_MA_PITEM A  
		LEFT OUTER JOIN DZSN_MA_SL AS MS ON A.CD_GISL = MS.CD_SL AND A.CD_PLANT = MS.CD_PLANT  AND A.CD_COMPANY = MS.CD_COMPANY    --AND A.CD_BIZAREA = MS.CD_BIZAREA
		LEFT OUTER JOIN DZSN_MA_CODEDTL VT ON A.CD_COMPANY = VT.CD_COMPANY AND VT.CD_FIELD = 'MA_B000040' AND A.FG_TAX_SA = VT.CD_SYSDEF
		LEFT OUTER JOIN DZSN_MA_PLANT PL ON A.CD_COMPANY = PL.CD_COMPANY AND A.CD_PLANT = PL.CD_PLANT
		LEFT OUTER JOIN DZSN_MA_ITEMGRP IG ON A.CD_COMPANY = IG.CD_COMPANY AND A.GRP_ITEM = IG.CD_ITEMGRP
WHERE	A.CD_COMPANY = @P_CD_COMPANY
AND     (A.CD_PLANT = @P_CD_PLANT OR @P_CD_PLANT IS NULL OR @P_CD_PLANT = '')
AND		(CD_ITEM IN (SELECT CD_STR FROM GETTABLEFROMSPLIT(@P_MULTI_ITEM)) OR @P_MULTI_ITEM IS NULL OR @P_MULTI_ITEM = '')    
    
SET NOCOUNT OFF
GO

