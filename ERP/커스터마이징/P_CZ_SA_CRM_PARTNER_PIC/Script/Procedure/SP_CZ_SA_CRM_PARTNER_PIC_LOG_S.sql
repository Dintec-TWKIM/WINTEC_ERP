USE [NEOE]
GO

/****** Object:  StoredProcedure [NEOE].[SP_CZ_SA_CRM_PARTNER_PIC_LOG_S]    Script Date: 2018-04-11 오후 7:28:12 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO






ALTER PROCEDURE [NEOE].[SP_CZ_SA_CRM_PARTNER_PIC_LOG_S]
(
	@P_CD_COMPANY		NVARCHAR(7),
	@P_CD_PARTNER		NVARCHAR(20),
	@P_SEQ				NUMERIC(5, 0)
) 
AS
 
SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED

SELECT PL.CD_COMPANY, 
	   PL.CD_PARTNER,
	   PL.SEQ,
	   PL.NO_INDEX,
	   PL.DT_LOG,
	   PL.DC_CONTENTS,
	   PL.QT_RATE,
	   PL.DC_RMK,
	   MF.FILE_PATH_MNG
FROM CZ_CRM_PARTNER_PIC_LOG PL 
LEFT JOIN (SELECT CD_FILE,
				  CONVERT(VARCHAR, COUNT(1)) AS FILE_PATH_MNG
		   FROM MA_FILEINFO
		   WHERE CD_COMPANY = 'K100' 
		   AND CD_MODULE = 'SA' 
		   AND ID_MENU = 'P_CZ_SA_CRM_PARTNER_PIC_LOG'
		   GROUP BY CD_FILE) MF 
ON  MF.CD_FILE = PL.CD_COMPANY + '_' + PL.CD_PARTNER + '_' + CONVERT(NVARCHAR, PL.SEQ) + '_' + CONVERT(NVARCHAR, PL.NO_INDEX)
WHERE PL.CD_COMPANY = @P_CD_COMPANY
AND PL.CD_PARTNER = @P_CD_PARTNER
AND PL.SEQ = @P_SEQ

GO

