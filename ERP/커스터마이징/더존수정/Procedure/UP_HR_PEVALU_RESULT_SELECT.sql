USE [NEOE]
GO

/****** Object:  StoredProcedure [NEOE].[UP_HR_PEVALU_RESULT_SELECT]    Script Date: 2015-11-11 오후 8:06:00 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO



/*******************************************
**  System		: 인사관리
**  Sub System	: 인사평가
**  Page		: 평가결과조정
**  Desc		: 조회
**  
**  Return Values
**
**  작    성    자 	: 강연철
**  작    성    일	: 2015.06.02
**  수    정    자  : 
**  수  정  내  용  : 
*********************************************
** Change History
*********************************************
*********************************************/

ALTER PROCEDURE [NEOE].[UP_HR_PEVALU_RESULT_SELECT]
(
	@P_CD_COMPANY	NVARCHAR(7),
	@P_CD_EVALU		NVARCHAR(8),
	@P_NO_EMPM		NVARCHAR(10)
)
AS
DECLARE	@V_SELECT1	NVARCHAR(MAX),
		@V_SELECT2	NVARCHAR(MAX),
		@V_FROM1	NVARCHAR(MAX),
		@V_FROM2	NVARCHAR(MAX),
		@V_FROM3	NVARCHAR(MAX),
		@V_FROM4	NVARCHAR(MAX),
		@V_FROM5	NVARCHAR(MAX),
		@V_FROM6	NVARCHAR(MAX),
		@V_FROM7	NVARCHAR(MAX),
		@V_FROM8	NVARCHAR(MAX),
		@V_FROM9	NVARCHAR(MAX),
		@V_WHERE	NVARCHAR(MAX),
		@V_ROWCOUNT	INT,
		@V_ID		INT
		
SET		@V_FROM1	= ''
SET		@V_FROM2	= ''
SET		@V_FROM3	= ''
SET		@V_FROM4	= ''
SET		@V_FROM5	= ''
SET		@V_FROM6	= ''
SET		@V_FROM7	= ''
SET		@V_FROM8	= ''
SET		@V_FROM9	= ''
SET		@V_SELECT1	= ''
SET		@V_SELECT2	= ''
BEGIN	
	SELECT	ROW_NUMBER() OVER (ORDER BY CD_HCODE) AS RN, CD_HCODE
	INTO	#TEMP1
	FROM	HR_PEVALU_CODE
	WHERE	CD_COMPANY	= @P_CD_COMPANY
	AND		CD_EVALU	= @P_CD_EVALU
	AND		CD_FIELD	= '100'

	SET		@V_ROWCOUNT	= @@ROWCOUNT   
	SET		@V_ID		= 1  

	WHILE (@V_ID <= @V_ROWCOUNT)  
	BEGIN 
		SELECT	@V_SELECT2 = @V_SELECT2 + ', M' + CD_HCODE + '.PT_SCORE AS SCORE_' + CD_HCODE
		FROM	#TEMP1
		WHERE	RN		= @V_ID  
		
		IF @V_ID = 1
		BEGIN
			SELECT @V_FROM2 = ' LEFT OUTER JOIN (	SELECT	SC.CD_COMPANY, SC.CD_EVALU, SC.NO_EMPM, SC.NO_EMPAN, SC.CD_EVNUMBER, SUM(SC.SCORE * ISNULL(HN.NUM_EWEIGHT, 1))  AS PT_SCORE
FROM	( SELECT	M.CD_COMPANY, M.CD_EVALU, M.CD_EVTYPE, M.CD_EVNUMBER, M.CD_GROUP, M.NO_EMPM, M.NO_EMPAN, SUM(M.SCORE_PT) * ISNULL(GP.RT_WEIGHT1, 1) AS SCORE
FROM	(	SELECT	SE.CD_COMPANY, SE.CD_EVALU, SE.CD_EVTYPE, SE.CD_EVNUMBER, SE.CD_GROUP,  SE.NO_EMPM, SE.NO_EMPAN, SE.CD_EVOTYPE, CE.YN_OBJECT, SE.LB_EVITEM, 
CASE WHEN SE.CD_GRADE IS NOT NULL THEN SE.PT_HSCORE ELSE SE.PT_SCORE END SCORE,
CASE WHEN (CE.YN_OBJECT = ''Y'' OR CE.YN_OBJECT IS NULL OR CE.YN_OBJECT = '''') THEN OT.RT_WEIGHT ELSE IM.NUM_EWEIGHT END EWEIGHT,
(CASE WHEN SE.CD_GRADE IS NOT NULL THEN SE.PT_HSCORE ELSE SE.PT_SCORE END *
CASE WHEN (CE.YN_OBJECT = ''Y'' OR CE.YN_OBJECT IS NULL OR CE.YN_OBJECT = '''') THEN OT.RT_WEIGHT ELSE IM.NUM_EWEIGHT END * ISNULL(IM2.NUM_EWEIGHT, 1) * ISNULL(IM3.NUM_EWEIGHT, 1)) AS SCORE_PT
FROM	HR_PEVALU_SCORE SE
LEFT OUTER JOIN HR_PEVALU_CODE CE
ON		SE.CD_COMPANY	= CE.CD_COMPANY
AND		SE.CD_EVALU		= CE.CD_EVALU
AND		CE.CD_FIELD		= ''100''
AND		SE.CD_EVTYPE	= CE.CD_HCODE
LEFT OUTER JOIN HR_PEVALU_ITEM IM
ON		SE.CD_COMPANY	= IM.CD_COMPANY
AND		SE.CD_EVALU		= IM.CD_EVALU
AND		SE.CD_EVTYPE	= IM.CD_EVTYPE
AND		SE.CD_GROUP		= IM.CD_GROUP
AND		SE.CD_EVOTYPE	= IM.CD_EVITEM
LEFT OUTER JOIN HR_PEVALU_ITEM IM2
ON		SE.CD_COMPANY	= IM2.CD_COMPANY
AND		SE.CD_EVALU		= IM2.CD_EVALU
AND		SE.CD_EVTYPE	= IM2.CD_EVTYPE
AND		SE.CD_GROUP		= IM2.CD_GROUP
AND		IM.H_EVITEM		= IM2.CD_EVITEM
LEFT OUTER JOIN HR_PEVALU_ITEM IM3
ON		SE.CD_COMPANY	= IM3.CD_COMPANY
AND		SE.CD_EVALU		= IM3.CD_EVALU
AND		SE.CD_EVTYPE	= IM3.CD_EVTYPE
AND		SE.CD_GROUP		= IM3.CD_GROUP
AND		IM2.H_EVITEM	= IM3.CD_EVITEM
LEFT OUTER JOIN HR_PEVALU_OBJECT OT
ON		OT.CD_COMPANY	= SE.CD_COMPANY
AND		OT.CD_EVALU		= SE.CD_EVALU
AND		OT.CD_EVTYPE	= SE.CD_EVTYPE
AND		OT.CD_EVOTYPE	= SE.CD_EVOTYPE
AND		OT.NO_EMP		= SE.NO_EMPAN
WHERE	SE.CD_COMPANY	= ''' + @P_CD_COMPANY + '''
AND		SE.CD_EVALU		= ''' + @P_CD_EVALU + '''
AND		SE.NO_EMPM		= ''' + @P_NO_EMPM + '''	) M
LEFT OUTER JOIN HR_PEVALU_CODE GP
ON		M.CD_COMPANY	= GP.CD_COMPANY
AND		M.CD_EVALU		= GP.CD_EVALU
AND		GP.CD_FIELD		= ''200''
AND		M.CD_GROUP		= GP.CD_HCODE
WHERE	M.CD_EVTYPE		= ''' + CD_HCODE + '''
GROUP BY M.CD_COMPANY, M.CD_EVALU, M.CD_EVTYPE, M.CD_EVNUMBER, M.CD_GROUP, M.NO_EMPM, M.NO_EMPAN, GP.RT_WEIGHT1 ) SC
LEFT OUTER JOIN HR_PEVALU_HUMEMPAN HN
ON		SC.CD_COMPANY	= HN.CD_COMPANY
AND		SC.CD_EVALU		= HN.CD_EVALU
AND		SC.CD_EVTYPE	= HN.CD_EVTYPE
AND		SC.CD_EVNUMBER	= HN.CD_EVNUMBER
AND		SC.CD_GROUP		= HN.CD_GROUP
AND		SC.NO_EMPM		= HN.NO_EMPM
AND		SC.NO_EMPAN		= HN.NO_EMPAN
GROUP BY SC.CD_COMPANY, SC.CD_EVALU, SC.NO_EMPM, SC.NO_EMPAN, SC.CD_EVNUMBER	) M' + CD_HCODE + '
ON		MAN.CD_COMPANY	= M' + CD_HCODE + '.CD_COMPANY
AND		MAN.CD_EVALU	= M' + CD_HCODE + '.CD_EVALU
AND		MAN.CD_EVNUMBER	= M' + CD_HCODE + '.CD_EVNUMBER
AND		MAN.NO_EMPM		= M' + CD_HCODE + '.NO_EMPM
AND		MAN.NO_EMPAN	= M' + CD_HCODE + '.NO_EMPAN'
			FROM	#TEMP1
			WHERE	RN		= @V_ID 
		END
		ELSE IF @V_ID = 2
		BEGIN
			SELECT @V_FROM3 = ' LEFT OUTER JOIN (	SELECT	SC.CD_COMPANY, SC.CD_EVALU, SC.NO_EMPM, SC.NO_EMPAN, SC.CD_EVNUMBER, SUM(SC.SCORE * ISNULL(HN.NUM_EWEIGHT, 1))  AS PT_SCORE
FROM	( SELECT	M.CD_COMPANY, M.CD_EVALU, M.CD_EVTYPE, M.CD_EVNUMBER, M.CD_GROUP, M.NO_EMPM, M.NO_EMPAN, SUM(M.SCORE_PT) * ISNULL(GP.RT_WEIGHT1, 1) AS SCORE
FROM	(	SELECT	SE.CD_COMPANY, SE.CD_EVALU, SE.CD_EVTYPE, SE.CD_EVNUMBER, SE.CD_GROUP,  SE.NO_EMPM, SE.NO_EMPAN, SE.CD_EVOTYPE, CE.YN_OBJECT, SE.LB_EVITEM, 
CASE WHEN SE.CD_GRADE IS NOT NULL THEN SE.PT_HSCORE ELSE SE.PT_SCORE END SCORE,
CASE WHEN (CE.YN_OBJECT = ''Y'' OR CE.YN_OBJECT IS NULL OR CE.YN_OBJECT = '''') THEN OT.RT_WEIGHT ELSE IM.NUM_EWEIGHT END EWEIGHT,
(CASE WHEN SE.CD_GRADE IS NOT NULL THEN SE.PT_HSCORE ELSE SE.PT_SCORE END *
CASE WHEN (CE.YN_OBJECT = ''Y'' OR CE.YN_OBJECT IS NULL OR CE.YN_OBJECT = '''') THEN OT.RT_WEIGHT ELSE IM.NUM_EWEIGHT END * ISNULL(IM2.NUM_EWEIGHT, 1) * ISNULL(IM3.NUM_EWEIGHT, 1)) AS SCORE_PT
FROM	HR_PEVALU_SCORE SE
LEFT OUTER JOIN HR_PEVALU_CODE CE
ON		SE.CD_COMPANY	= CE.CD_COMPANY
AND		SE.CD_EVALU		= CE.CD_EVALU
AND		CE.CD_FIELD		= ''100''
AND		SE.CD_EVTYPE	= CE.CD_HCODE
LEFT OUTER JOIN HR_PEVALU_ITEM IM
ON		SE.CD_COMPANY	= IM.CD_COMPANY
AND		SE.CD_EVALU		= IM.CD_EVALU
AND		SE.CD_EVTYPE	= IM.CD_EVTYPE
AND		SE.CD_GROUP		= IM.CD_GROUP
AND		SE.CD_EVOTYPE	= IM.CD_EVITEM
LEFT OUTER JOIN HR_PEVALU_ITEM IM2
ON		SE.CD_COMPANY	= IM2.CD_COMPANY
AND		SE.CD_EVALU		= IM2.CD_EVALU
AND		SE.CD_EVTYPE	= IM2.CD_EVTYPE
AND		SE.CD_GROUP		= IM2.CD_GROUP
AND		IM.H_EVITEM		= IM2.CD_EVITEM
LEFT OUTER JOIN HR_PEVALU_ITEM IM3
ON		SE.CD_COMPANY	= IM3.CD_COMPANY
AND		SE.CD_EVALU		= IM3.CD_EVALU
AND		SE.CD_EVTYPE	= IM3.CD_EVTYPE
AND		SE.CD_GROUP		= IM3.CD_GROUP
AND		IM2.H_EVITEM	= IM3.CD_EVITEM
LEFT OUTER JOIN HR_PEVALU_OBJECT OT
ON		OT.CD_COMPANY	= SE.CD_COMPANY
AND		OT.CD_EVALU		= SE.CD_EVALU
AND		OT.CD_EVTYPE	= SE.CD_EVTYPE
AND		OT.CD_EVOTYPE	= SE.CD_EVOTYPE
AND		OT.NO_EMP		= SE.NO_EMPAN
WHERE	SE.CD_COMPANY	= ''' + @P_CD_COMPANY + '''
AND		SE.CD_EVALU		= ''' + @P_CD_EVALU + '''
AND		SE.NO_EMPM		= ''' + @P_NO_EMPM + '''	) M
LEFT OUTER JOIN HR_PEVALU_CODE GP
ON		M.CD_COMPANY	= GP.CD_COMPANY
AND		M.CD_EVALU		= GP.CD_EVALU
AND		GP.CD_FIELD		= ''200''
AND		M.CD_GROUP		= GP.CD_HCODE
WHERE	M.CD_EVTYPE		= ''' + CD_HCODE + '''
GROUP BY M.CD_COMPANY, M.CD_EVALU, M.CD_EVTYPE, M.CD_EVNUMBER, M.CD_GROUP, M.NO_EMPM, M.NO_EMPAN, GP.RT_WEIGHT1 ) SC
LEFT OUTER JOIN HR_PEVALU_HUMEMPAN HN
ON		SC.CD_COMPANY	= HN.CD_COMPANY
AND		SC.CD_EVALU		= HN.CD_EVALU
AND		SC.CD_EVTYPE	= HN.CD_EVTYPE
AND		SC.CD_EVNUMBER	= HN.CD_EVNUMBER
AND		SC.CD_GROUP		= HN.CD_GROUP
AND		SC.NO_EMPM		= HN.NO_EMPM
AND		SC.NO_EMPAN		= HN.NO_EMPAN
GROUP BY SC.CD_COMPANY, SC.CD_EVALU, SC.NO_EMPM, SC.NO_EMPAN, SC.CD_EVNUMBER	) M' + CD_HCODE + '
ON		MAN.CD_COMPANY	= M' + CD_HCODE + '.CD_COMPANY
AND		MAN.CD_EVALU	= M' + CD_HCODE + '.CD_EVALU
AND		MAN.CD_EVNUMBER	= M' + CD_HCODE + '.CD_EVNUMBER
AND		MAN.NO_EMPM		= M' + CD_HCODE + '.NO_EMPM
AND		MAN.NO_EMPAN	= M' + CD_HCODE + '.NO_EMPAN'
			FROM	#TEMP1
			WHERE	RN		= @V_ID 
		END
		ELSE IF @V_ID = 3
		BEGIN
			SELECT @V_FROM4 = ' LEFT OUTER JOIN (	SELECT	SC.CD_COMPANY, SC.CD_EVALU, SC.NO_EMPM, SC.NO_EMPAN, SC.CD_EVNUMBER, SUM(SC.SCORE * ISNULL(HN.NUM_EWEIGHT, 1))  AS PT_SCORE
FROM	( SELECT	M.CD_COMPANY, M.CD_EVALU, M.CD_EVTYPE, M.CD_EVNUMBER, M.CD_GROUP, M.NO_EMPM, M.NO_EMPAN, SUM(M.SCORE_PT) * ISNULL(GP.RT_WEIGHT1, 1) AS SCORE
FROM	(	SELECT	SE.CD_COMPANY, SE.CD_EVALU, SE.CD_EVTYPE, SE.CD_EVNUMBER, SE.CD_GROUP,  SE.NO_EMPM, SE.NO_EMPAN, SE.CD_EVOTYPE, CE.YN_OBJECT, SE.LB_EVITEM, 
CASE WHEN SE.CD_GRADE IS NOT NULL THEN SE.PT_HSCORE ELSE SE.PT_SCORE END SCORE,
CASE WHEN (CE.YN_OBJECT = ''Y'' OR CE.YN_OBJECT IS NULL OR CE.YN_OBJECT = '''') THEN OT.RT_WEIGHT ELSE IM.NUM_EWEIGHT END EWEIGHT,
(CASE WHEN SE.CD_GRADE IS NOT NULL THEN SE.PT_HSCORE ELSE SE.PT_SCORE END *
CASE WHEN (CE.YN_OBJECT = ''Y'' OR CE.YN_OBJECT IS NULL OR CE.YN_OBJECT = '''') THEN OT.RT_WEIGHT ELSE IM.NUM_EWEIGHT END * ISNULL(IM2.NUM_EWEIGHT, 1) * ISNULL(IM3.NUM_EWEIGHT, 1)) AS SCORE_PT
FROM	HR_PEVALU_SCORE SE
LEFT OUTER JOIN HR_PEVALU_CODE CE
ON		SE.CD_COMPANY	= CE.CD_COMPANY
AND		SE.CD_EVALU		= CE.CD_EVALU
AND		CE.CD_FIELD		= ''100''
AND		SE.CD_EVTYPE	= CE.CD_HCODE
LEFT OUTER JOIN HR_PEVALU_ITEM IM
ON		SE.CD_COMPANY	= IM.CD_COMPANY
AND		SE.CD_EVALU		= IM.CD_EVALU
AND		SE.CD_EVTYPE	= IM.CD_EVTYPE
AND		SE.CD_GROUP		= IM.CD_GROUP
AND		SE.CD_EVOTYPE	= IM.CD_EVITEM
LEFT OUTER JOIN HR_PEVALU_ITEM IM2
ON		SE.CD_COMPANY	= IM2.CD_COMPANY
AND		SE.CD_EVALU		= IM2.CD_EVALU
AND		SE.CD_EVTYPE	= IM2.CD_EVTYPE
AND		SE.CD_GROUP		= IM2.CD_GROUP
AND		IM.H_EVITEM		= IM2.CD_EVITEM
LEFT OUTER JOIN HR_PEVALU_ITEM IM3
ON		SE.CD_COMPANY	= IM3.CD_COMPANY
AND		SE.CD_EVALU		= IM3.CD_EVALU
AND		SE.CD_EVTYPE	= IM3.CD_EVTYPE
AND		SE.CD_GROUP		= IM3.CD_GROUP
AND		IM2.H_EVITEM	= IM3.CD_EVITEM
LEFT OUTER JOIN HR_PEVALU_OBJECT OT
ON		OT.CD_COMPANY	= SE.CD_COMPANY
AND		OT.CD_EVALU		= SE.CD_EVALU
AND		OT.CD_EVTYPE	= SE.CD_EVTYPE
AND		OT.CD_EVOTYPE	= SE.CD_EVOTYPE
AND		OT.NO_EMP		= SE.NO_EMPAN
WHERE	SE.CD_COMPANY	= ''' + @P_CD_COMPANY + '''
AND		SE.CD_EVALU		= ''' + @P_CD_EVALU + '''
AND		SE.NO_EMPM		= ''' + @P_NO_EMPM + '''	) M
LEFT OUTER JOIN HR_PEVALU_CODE GP
ON		M.CD_COMPANY	= GP.CD_COMPANY
AND		M.CD_EVALU		= GP.CD_EVALU
AND		GP.CD_FIELD		= ''200''
AND		M.CD_GROUP		= GP.CD_HCODE
WHERE	M.CD_EVTYPE		= ''' + CD_HCODE + '''
GROUP BY M.CD_COMPANY, M.CD_EVALU, M.CD_EVTYPE, M.CD_EVNUMBER, M.CD_GROUP, M.NO_EMPM, M.NO_EMPAN, GP.RT_WEIGHT1 ) SC
LEFT OUTER JOIN HR_PEVALU_HUMEMPAN HN
ON		SC.CD_COMPANY	= HN.CD_COMPANY
AND		SC.CD_EVALU		= HN.CD_EVALU
AND		SC.CD_EVTYPE	= HN.CD_EVTYPE
AND		SC.CD_EVNUMBER	= HN.CD_EVNUMBER
AND		SC.CD_GROUP		= HN.CD_GROUP
AND		SC.NO_EMPM		= HN.NO_EMPM
AND		SC.NO_EMPAN		= HN.NO_EMPAN
GROUP BY SC.CD_COMPANY, SC.CD_EVALU, SC.NO_EMPM, SC.NO_EMPAN, SC.CD_EVNUMBER	) M' + CD_HCODE + '
ON		MAN.CD_COMPANY	= M' + CD_HCODE + '.CD_COMPANY
AND		MAN.CD_EVALU	= M' + CD_HCODE + '.CD_EVALU
AND		MAN.CD_EVNUMBER	= M' + CD_HCODE + '.CD_EVNUMBER
AND		MAN.NO_EMPM		= M' + CD_HCODE + '.NO_EMPM
AND		MAN.NO_EMPAN	= M' + CD_HCODE + '.NO_EMPAN'
			FROM	#TEMP1
			WHERE	RN		= @V_ID 
		END
		ELSE IF @V_ID = 4
		BEGIN
			SELECT @V_FROM5 = ' LEFT OUTER JOIN (	SELECT	SC.CD_COMPANY, SC.CD_EVALU, SC.NO_EMPM, SC.NO_EMPAN, SC.CD_EVNUMBER, SUM(SC.SCORE * ISNULL(HN.NUM_EWEIGHT, 1))  AS PT_SCORE
FROM	( SELECT	M.CD_COMPANY, M.CD_EVALU, M.CD_EVTYPE, M.CD_EVNUMBER, M.CD_GROUP, M.NO_EMPM, M.NO_EMPAN, SUM(M.SCORE_PT) * ISNULL(GP.RT_WEIGHT1, 1) AS SCORE
FROM	(	SELECT	SE.CD_COMPANY, SE.CD_EVALU, SE.CD_EVTYPE, SE.CD_EVNUMBER, SE.CD_GROUP,  SE.NO_EMPM, SE.NO_EMPAN, SE.CD_EVOTYPE, CE.YN_OBJECT, SE.LB_EVITEM, 
CASE WHEN SE.CD_GRADE IS NOT NULL THEN SE.PT_HSCORE ELSE SE.PT_SCORE END SCORE,
CASE WHEN (CE.YN_OBJECT = ''Y'' OR CE.YN_OBJECT IS NULL OR CE.YN_OBJECT = '''') THEN OT.RT_WEIGHT ELSE IM.NUM_EWEIGHT END EWEIGHT,
(CASE WHEN SE.CD_GRADE IS NOT NULL THEN SE.PT_HSCORE ELSE SE.PT_SCORE END *
CASE WHEN (CE.YN_OBJECT = ''Y'' OR CE.YN_OBJECT IS NULL OR CE.YN_OBJECT = '''') THEN OT.RT_WEIGHT ELSE IM.NUM_EWEIGHT END * ISNULL(IM2.NUM_EWEIGHT, 1) * ISNULL(IM3.NUM_EWEIGHT, 1)) AS SCORE_PT
FROM	HR_PEVALU_SCORE SE
LEFT OUTER JOIN HR_PEVALU_CODE CE
ON		SE.CD_COMPANY	= CE.CD_COMPANY
AND		SE.CD_EVALU		= CE.CD_EVALU
AND		CE.CD_FIELD		= ''100''
AND		SE.CD_EVTYPE	= CE.CD_HCODE
LEFT OUTER JOIN HR_PEVALU_ITEM IM
ON		SE.CD_COMPANY	= IM.CD_COMPANY
AND		SE.CD_EVALU		= IM.CD_EVALU
AND		SE.CD_EVTYPE	= IM.CD_EVTYPE
AND		SE.CD_GROUP		= IM.CD_GROUP
AND		SE.CD_EVOTYPE	= IM.CD_EVITEM
LEFT OUTER JOIN HR_PEVALU_ITEM IM2
ON		SE.CD_COMPANY	= IM2.CD_COMPANY
AND		SE.CD_EVALU		= IM2.CD_EVALU
AND		SE.CD_EVTYPE	= IM2.CD_EVTYPE
AND		SE.CD_GROUP		= IM2.CD_GROUP
AND		IM.H_EVITEM		= IM2.CD_EVITEM
LEFT OUTER JOIN HR_PEVALU_ITEM IM3
ON		SE.CD_COMPANY	= IM3.CD_COMPANY
AND		SE.CD_EVALU		= IM3.CD_EVALU
AND		SE.CD_EVTYPE	= IM3.CD_EVTYPE
AND		SE.CD_GROUP		= IM3.CD_GROUP
AND		IM2.H_EVITEM	= IM3.CD_EVITEM
LEFT OUTER JOIN HR_PEVALU_OBJECT OT
ON		OT.CD_COMPANY	= SE.CD_COMPANY
AND		OT.CD_EVALU		= SE.CD_EVALU
AND		OT.CD_EVTYPE	= SE.CD_EVTYPE
AND		OT.CD_EVOTYPE	= SE.CD_EVOTYPE
AND		OT.NO_EMP		= SE.NO_EMPAN
WHERE	SE.CD_COMPANY	= ''' + @P_CD_COMPANY + '''
AND		SE.CD_EVALU		= ''' + @P_CD_EVALU + '''
AND		SE.NO_EMPM		= ''' + @P_NO_EMPM + '''	) M
LEFT OUTER JOIN HR_PEVALU_CODE GP
ON		M.CD_COMPANY	= GP.CD_COMPANY
AND		M.CD_EVALU		= GP.CD_EVALU
AND		GP.CD_FIELD		= ''200''
AND		M.CD_GROUP		= GP.CD_HCODE
WHERE	M.CD_EVTYPE		= ''' + CD_HCODE + '''
GROUP BY M.CD_COMPANY, M.CD_EVALU, M.CD_EVTYPE, M.CD_EVNUMBER, M.CD_GROUP, M.NO_EMPM, M.NO_EMPAN, GP.RT_WEIGHT1 ) SC
LEFT OUTER JOIN HR_PEVALU_HUMEMPAN HN
ON		SC.CD_COMPANY	= HN.CD_COMPANY
AND		SC.CD_EVALU		= HN.CD_EVALU
AND		SC.CD_EVTYPE	= HN.CD_EVTYPE
AND		SC.CD_EVNUMBER	= HN.CD_EVNUMBER
AND		SC.CD_GROUP		= HN.CD_GROUP
AND		SC.NO_EMPM		= HN.NO_EMPM
AND		SC.NO_EMPAN		= HN.NO_EMPAN
GROUP BY SC.CD_COMPANY, SC.CD_EVALU, SC.NO_EMPM, SC.NO_EMPAN, SC.CD_EVNUMBER	) M' + CD_HCODE + '
ON		MAN.CD_COMPANY	= M' + CD_HCODE + '.CD_COMPANY
AND		MAN.CD_EVALU	= M' + CD_HCODE + '.CD_EVALU
AND		MAN.CD_EVNUMBER	= M' + CD_HCODE + '.CD_EVNUMBER
AND		MAN.NO_EMPM		= M' + CD_HCODE + '.NO_EMPM
AND		MAN.NO_EMPAN	= M' + CD_HCODE + '.NO_EMPAN'
			FROM	#TEMP1
			WHERE	RN		= @V_ID 
		END
		ELSE IF @V_ID = 5
		BEGIN
			SELECT @V_FROM6 = ' LEFT OUTER JOIN (	SELECT	SC.CD_COMPANY, SC.CD_EVALU, SC.NO_EMPM, SC.NO_EMPAN, SC.CD_EVNUMBER, SUM(SC.SCORE * ISNULL(HN.NUM_EWEIGHT, 1))  AS PT_SCORE
FROM	( SELECT	M.CD_COMPANY, M.CD_EVALU, M.CD_EVTYPE, M.CD_EVNUMBER, M.CD_GROUP, M.NO_EMPM, M.NO_EMPAN, SUM(M.SCORE_PT) * ISNULL(GP.RT_WEIGHT1, 1) AS SCORE
FROM	(	SELECT	SE.CD_COMPANY, SE.CD_EVALU, SE.CD_EVTYPE, SE.CD_EVNUMBER, SE.CD_GROUP,  SE.NO_EMPM, SE.NO_EMPAN, SE.CD_EVOTYPE, CE.YN_OBJECT, SE.LB_EVITEM, 
CASE WHEN SE.CD_GRADE IS NOT NULL THEN SE.PT_HSCORE ELSE SE.PT_SCORE END SCORE,
CASE WHEN (CE.YN_OBJECT = ''Y'' OR CE.YN_OBJECT IS NULL OR CE.YN_OBJECT = '''') THEN OT.RT_WEIGHT ELSE IM.NUM_EWEIGHT END EWEIGHT,
(CASE WHEN SE.CD_GRADE IS NOT NULL THEN SE.PT_HSCORE ELSE SE.PT_SCORE END *
CASE WHEN (CE.YN_OBJECT = ''Y'' OR CE.YN_OBJECT IS NULL OR CE.YN_OBJECT = '''') THEN OT.RT_WEIGHT ELSE IM.NUM_EWEIGHT END * ISNULL(IM2.NUM_EWEIGHT, 1) * ISNULL(IM3.NUM_EWEIGHT, 1)) AS SCORE_PT
FROM	HR_PEVALU_SCORE SE
LEFT OUTER JOIN HR_PEVALU_CODE CE
ON		SE.CD_COMPANY	= CE.CD_COMPANY
AND		SE.CD_EVALU		= CE.CD_EVALU
AND		CE.CD_FIELD		= ''100''
AND		SE.CD_EVTYPE	= CE.CD_HCODE
LEFT OUTER JOIN HR_PEVALU_ITEM IM
ON		SE.CD_COMPANY	= IM.CD_COMPANY
AND		SE.CD_EVALU		= IM.CD_EVALU
AND		SE.CD_EVTYPE	= IM.CD_EVTYPE
AND		SE.CD_GROUP		= IM.CD_GROUP
AND		SE.CD_EVOTYPE	= IM.CD_EVITEM
LEFT OUTER JOIN HR_PEVALU_ITEM IM2
ON		SE.CD_COMPANY	= IM2.CD_COMPANY
AND		SE.CD_EVALU		= IM2.CD_EVALU
AND		SE.CD_EVTYPE	= IM2.CD_EVTYPE
AND		SE.CD_GROUP		= IM2.CD_GROUP
AND		IM.H_EVITEM		= IM2.CD_EVITEM
LEFT OUTER JOIN HR_PEVALU_ITEM IM3
ON		SE.CD_COMPANY	= IM3.CD_COMPANY
AND		SE.CD_EVALU		= IM3.CD_EVALU
AND		SE.CD_EVTYPE	= IM3.CD_EVTYPE
AND		SE.CD_GROUP		= IM3.CD_GROUP
AND		IM2.H_EVITEM	= IM3.CD_EVITEM
LEFT OUTER JOIN HR_PEVALU_OBJECT OT
ON		OT.CD_COMPANY	= SE.CD_COMPANY
AND		OT.CD_EVALU		= SE.CD_EVALU
AND		OT.CD_EVTYPE	= SE.CD_EVTYPE
AND		OT.CD_EVOTYPE	= SE.CD_EVOTYPE
AND		OT.NO_EMP		= SE.NO_EMPAN
WHERE	SE.CD_COMPANY	= ''' + @P_CD_COMPANY + '''
AND		SE.CD_EVALU		= ''' + @P_CD_EVALU + '''
AND		SE.NO_EMPM		= ''' + @P_NO_EMPM + '''	) M
LEFT OUTER JOIN HR_PEVALU_CODE GP
ON		M.CD_COMPANY	= GP.CD_COMPANY
AND		M.CD_EVALU		= GP.CD_EVALU
AND		GP.CD_FIELD		= ''200''
AND		M.CD_GROUP		= GP.CD_HCODE
WHERE	M.CD_EVTYPE		= ''' + CD_HCODE + '''
GROUP BY M.CD_COMPANY, M.CD_EVALU, M.CD_EVTYPE, M.CD_EVNUMBER, M.CD_GROUP, M.NO_EMPM, M.NO_EMPAN, GP.RT_WEIGHT1 ) SC
LEFT OUTER JOIN HR_PEVALU_HUMEMPAN HN
ON		SC.CD_COMPANY	= HN.CD_COMPANY
AND		SC.CD_EVALU		= HN.CD_EVALU
AND		SC.CD_EVTYPE	= HN.CD_EVTYPE
AND		SC.CD_EVNUMBER	= HN.CD_EVNUMBER
AND		SC.CD_GROUP		= HN.CD_GROUP
AND		SC.NO_EMPM		= HN.NO_EMPM
AND		SC.NO_EMPAN		= HN.NO_EMPAN
GROUP BY SC.CD_COMPANY, SC.CD_EVALU, SC.NO_EMPM, SC.NO_EMPAN, SC.CD_EVNUMBER	) M' + CD_HCODE + '
ON		MAN.CD_COMPANY	= M' + CD_HCODE + '.CD_COMPANY
AND		MAN.CD_EVALU	= M' + CD_HCODE + '.CD_EVALU
AND		MAN.CD_EVNUMBER	= M' + CD_HCODE + '.CD_EVNUMBER
AND		MAN.NO_EMPM		= M' + CD_HCODE + '.NO_EMPM
AND		MAN.NO_EMPAN	= M' + CD_HCODE + '.NO_EMPAN'
			FROM	#TEMP1
			WHERE	RN		= @V_ID 
		END
		ELSE IF @V_ID = 6
		BEGIN
			SELECT @V_FROM7 = ' LEFT OUTER JOIN (	SELECT	SC.CD_COMPANY, SC.CD_EVALU, SC.NO_EMPM, SC.NO_EMPAN, SC.CD_EVNUMBER, SUM(SC.SCORE * ISNULL(HN.NUM_EWEIGHT, 1))  AS PT_SCORE
FROM	( SELECT	M.CD_COMPANY, M.CD_EVALU, M.CD_EVTYPE, M.CD_EVNUMBER, M.CD_GROUP, M.NO_EMPM, M.NO_EMPAN, SUM(M.SCORE_PT) * ISNULL(GP.RT_WEIGHT1, 1) AS SCORE
FROM	(	SELECT	SE.CD_COMPANY, SE.CD_EVALU, SE.CD_EVTYPE, SE.CD_EVNUMBER, SE.CD_GROUP,  SE.NO_EMPM, SE.NO_EMPAN, SE.CD_EVOTYPE, CE.YN_OBJECT, SE.LB_EVITEM, 
CASE WHEN SE.CD_GRADE IS NOT NULL THEN SE.PT_HSCORE ELSE SE.PT_SCORE END SCORE,
CASE WHEN (CE.YN_OBJECT = ''Y'' OR CE.YN_OBJECT IS NULL OR CE.YN_OBJECT = '''') THEN OT.RT_WEIGHT ELSE IM.NUM_EWEIGHT END EWEIGHT,
(CASE WHEN SE.CD_GRADE IS NOT NULL THEN SE.PT_HSCORE ELSE SE.PT_SCORE END *
CASE WHEN (CE.YN_OBJECT = ''Y'' OR CE.YN_OBJECT IS NULL OR CE.YN_OBJECT = '''') THEN OT.RT_WEIGHT ELSE IM.NUM_EWEIGHT END * ISNULL(IM2.NUM_EWEIGHT, 1) * ISNULL(IM3.NUM_EWEIGHT, 1)) AS SCORE_PT
FROM	HR_PEVALU_SCORE SE
LEFT OUTER JOIN HR_PEVALU_CODE CE
ON		SE.CD_COMPANY	= CE.CD_COMPANY
AND		SE.CD_EVALU		= CE.CD_EVALU
AND		CE.CD_FIELD		= ''100''
AND		SE.CD_EVTYPE	= CE.CD_HCODE
LEFT OUTER JOIN HR_PEVALU_ITEM IM
ON		SE.CD_COMPANY	= IM.CD_COMPANY
AND		SE.CD_EVALU		= IM.CD_EVALU
AND		SE.CD_EVTYPE	= IM.CD_EVTYPE
AND		SE.CD_GROUP		= IM.CD_GROUP
AND		SE.CD_EVOTYPE	= IM.CD_EVITEM
LEFT OUTER JOIN HR_PEVALU_ITEM IM2
ON		SE.CD_COMPANY	= IM2.CD_COMPANY
AND		SE.CD_EVALU		= IM2.CD_EVALU
AND		SE.CD_EVTYPE	= IM2.CD_EVTYPE
AND		SE.CD_GROUP		= IM2.CD_GROUP
AND		IM.H_EVITEM		= IM2.CD_EVITEM
LEFT OUTER JOIN HR_PEVALU_ITEM IM3
ON		SE.CD_COMPANY	= IM3.CD_COMPANY
AND		SE.CD_EVALU		= IM3.CD_EVALU
AND		SE.CD_EVTYPE	= IM3.CD_EVTYPE
AND		SE.CD_GROUP		= IM3.CD_GROUP
AND		IM2.H_EVITEM	= IM3.CD_EVITEM
LEFT OUTER JOIN HR_PEVALU_OBJECT OT
ON		OT.CD_COMPANY	= SE.CD_COMPANY
AND		OT.CD_EVALU		= SE.CD_EVALU
AND		OT.CD_EVTYPE	= SE.CD_EVTYPE
AND		OT.CD_EVOTYPE	= SE.CD_EVOTYPE
AND		OT.NO_EMP		= SE.NO_EMPAN
WHERE	SE.CD_COMPANY	= ''' + @P_CD_COMPANY + '''
AND		SE.CD_EVALU		= ''' + @P_CD_EVALU + '''
AND		SE.NO_EMPM		= ''' + @P_NO_EMPM + '''	) M
LEFT OUTER JOIN HR_PEVALU_CODE GP
ON		M.CD_COMPANY	= GP.CD_COMPANY
AND		M.CD_EVALU		= GP.CD_EVALU
AND		GP.CD_FIELD		= ''200''
AND		M.CD_GROUP		= GP.CD_HCODE
WHERE	M.CD_EVTYPE		= ''' + CD_HCODE + '''
GROUP BY M.CD_COMPANY, M.CD_EVALU, M.CD_EVTYPE, M.CD_EVNUMBER, M.CD_GROUP, M.NO_EMPM, M.NO_EMPAN, GP.RT_WEIGHT1 ) SC
LEFT OUTER JOIN HR_PEVALU_HUMEMPAN HN
ON		SC.CD_COMPANY	= HN.CD_COMPANY
AND		SC.CD_EVALU		= HN.CD_EVALU
AND		SC.CD_EVTYPE	= HN.CD_EVTYPE
AND		SC.CD_EVNUMBER	= HN.CD_EVNUMBER
AND		SC.CD_GROUP		= HN.CD_GROUP
AND		SC.NO_EMPM		= HN.NO_EMPM
AND		SC.NO_EMPAN		= HN.NO_EMPAN
GROUP BY SC.CD_COMPANY, SC.CD_EVALU, SC.NO_EMPM, SC.NO_EMPAN, SC.CD_EVNUMBER	) M' + CD_HCODE + '
ON		MAN.CD_COMPANY	= M' + CD_HCODE + '.CD_COMPANY
AND		MAN.CD_EVALU	= M' + CD_HCODE + '.CD_EVALU
AND		MAN.CD_EVNUMBER	= M' + CD_HCODE + '.CD_EVNUMBER
AND		MAN.NO_EMPM		= M' + CD_HCODE + '.NO_EMPM
AND		MAN.NO_EMPAN	= M' + CD_HCODE + '.NO_EMPAN'
			FROM	#TEMP1
			WHERE	RN		= @V_ID 
		END
		ELSE IF @V_ID = 7
		BEGIN
			SELECT @V_FROM8 = ' LEFT OUTER JOIN (	SELECT	SC.CD_COMPANY, SC.CD_EVALU, SC.NO_EMPM, SC.NO_EMPAN, SC.CD_EVNUMBER, SUM(SC.SCORE * ISNULL(HN.NUM_EWEIGHT, 1))  AS PT_SCORE
FROM	( SELECT	M.CD_COMPANY, M.CD_EVALU, M.CD_EVTYPE, M.CD_EVNUMBER, M.CD_GROUP, M.NO_EMPM, M.NO_EMPAN, SUM(M.SCORE_PT) * ISNULL(GP.RT_WEIGHT1, 1) AS SCORE
FROM	(	SELECT	SE.CD_COMPANY, SE.CD_EVALU, SE.CD_EVTYPE, SE.CD_EVNUMBER, SE.CD_GROUP,  SE.NO_EMPM, SE.NO_EMPAN, SE.CD_EVOTYPE, CE.YN_OBJECT, SE.LB_EVITEM, 
CASE WHEN SE.CD_GRADE IS NOT NULL THEN SE.PT_HSCORE ELSE SE.PT_SCORE END SCORE,
CASE WHEN (CE.YN_OBJECT = ''Y'' OR CE.YN_OBJECT IS NULL OR CE.YN_OBJECT = '''') THEN OT.RT_WEIGHT ELSE IM.NUM_EWEIGHT END EWEIGHT,
(CASE WHEN SE.CD_GRADE IS NOT NULL THEN SE.PT_HSCORE ELSE SE.PT_SCORE END *
CASE WHEN (CE.YN_OBJECT = ''Y'' OR CE.YN_OBJECT IS NULL OR CE.YN_OBJECT = '''') THEN OT.RT_WEIGHT ELSE IM.NUM_EWEIGHT END * ISNULL(IM2.NUM_EWEIGHT, 1) * ISNULL(IM3.NUM_EWEIGHT, 1)) AS SCORE_PT
FROM	HR_PEVALU_SCORE SE
LEFT OUTER JOIN HR_PEVALU_CODE CE
ON		SE.CD_COMPANY	= CE.CD_COMPANY
AND		SE.CD_EVALU		= CE.CD_EVALU
AND		CE.CD_FIELD		= ''100''
AND		SE.CD_EVTYPE	= CE.CD_HCODE
LEFT OUTER JOIN HR_PEVALU_ITEM IM
ON		SE.CD_COMPANY	= IM.CD_COMPANY
AND		SE.CD_EVALU		= IM.CD_EVALU
AND		SE.CD_EVTYPE	= IM.CD_EVTYPE
AND		SE.CD_GROUP		= IM.CD_GROUP
AND		SE.CD_EVOTYPE	= IM.CD_EVITEM
LEFT OUTER JOIN HR_PEVALU_ITEM IM2
ON		SE.CD_COMPANY	= IM2.CD_COMPANY
AND		SE.CD_EVALU		= IM2.CD_EVALU
AND		SE.CD_EVTYPE	= IM2.CD_EVTYPE
AND		SE.CD_GROUP		= IM2.CD_GROUP
AND		IM.H_EVITEM		= IM2.CD_EVITEM
LEFT OUTER JOIN HR_PEVALU_ITEM IM3
ON		SE.CD_COMPANY	= IM3.CD_COMPANY
AND		SE.CD_EVALU		= IM3.CD_EVALU
AND		SE.CD_EVTYPE	= IM3.CD_EVTYPE
AND		SE.CD_GROUP		= IM3.CD_GROUP
AND		IM2.H_EVITEM	= IM3.CD_EVITEM
LEFT OUTER JOIN HR_PEVALU_OBJECT OT
ON		OT.CD_COMPANY	= SE.CD_COMPANY
AND		OT.CD_EVALU		= SE.CD_EVALU
AND		OT.CD_EVTYPE	= SE.CD_EVTYPE
AND		OT.CD_EVOTYPE	= SE.CD_EVOTYPE
AND		OT.NO_EMP		= SE.NO_EMPAN
WHERE	SE.CD_COMPANY	= ''' + @P_CD_COMPANY + '''
AND		SE.CD_EVALU		= ''' + @P_CD_EVALU + '''
AND		SE.NO_EMPM		= ''' + @P_NO_EMPM + '''	) M
LEFT OUTER JOIN HR_PEVALU_CODE GP
ON		M.CD_COMPANY	= GP.CD_COMPANY
AND		M.CD_EVALU		= GP.CD_EVALU
AND		GP.CD_FIELD		= ''200''
AND		M.CD_GROUP		= GP.CD_HCODE
WHERE	M.CD_EVTYPE		= ''' + CD_HCODE + '''
GROUP BY M.CD_COMPANY, M.CD_EVALU, M.CD_EVTYPE, M.CD_EVNUMBER, M.CD_GROUP, M.NO_EMPM, M.NO_EMPAN, GP.RT_WEIGHT1 ) SC
LEFT OUTER JOIN HR_PEVALU_HUMEMPAN HN
ON		SC.CD_COMPANY	= HN.CD_COMPANY
AND		SC.CD_EVALU		= HN.CD_EVALU
AND		SC.CD_EVTYPE	= HN.CD_EVTYPE
AND		SC.CD_EVNUMBER	= HN.CD_EVNUMBER
AND		SC.CD_GROUP		= HN.CD_GROUP
AND		SC.NO_EMPM		= HN.NO_EMPM
AND		SC.NO_EMPAN		= HN.NO_EMPAN
GROUP BY SC.CD_COMPANY, SC.CD_EVALU, SC.NO_EMPM, SC.NO_EMPAN, SC.CD_EVNUMBER	) M' + CD_HCODE + '
ON		MAN.CD_COMPANY	= M' + CD_HCODE + '.CD_COMPANY
AND		MAN.CD_EVALU	= M' + CD_HCODE + '.CD_EVALU
AND		MAN.CD_EVNUMBER	= M' + CD_HCODE + '.CD_EVNUMBER
AND		MAN.NO_EMPM		= M' + CD_HCODE + '.NO_EMPM
AND		MAN.NO_EMPAN	= M' + CD_HCODE + '.NO_EMPAN'
			FROM	#TEMP1
			WHERE	RN		= @V_ID 
		END
		ELSE IF @V_ID = 8
		BEGIN
			SELECT @V_FROM9 = ' LEFT OUTER JOIN (	SELECT	SC.CD_COMPANY, SC.CD_EVALU, SC.NO_EMPM, SC.NO_EMPAN, SC.CD_EVNUMBER, SUM(SC.SCORE * ISNULL(HN.NUM_EWEIGHT, 1))  AS PT_SCORE
FROM	( SELECT	M.CD_COMPANY, M.CD_EVALU, M.CD_EVTYPE, M.CD_EVNUMBER, M.CD_GROUP, M.NO_EMPM, M.NO_EMPAN, SUM(M.SCORE_PT) * ISNULL(GP.RT_WEIGHT1, 1) AS SCORE
FROM	(	SELECT	SE.CD_COMPANY, SE.CD_EVALU, SE.CD_EVTYPE, SE.CD_EVNUMBER, SE.CD_GROUP,  SE.NO_EMPM, SE.NO_EMPAN, SE.CD_EVOTYPE, CE.YN_OBJECT, SE.LB_EVITEM, 
CASE WHEN SE.CD_GRADE IS NOT NULL THEN SE.PT_HSCORE ELSE SE.PT_SCORE END SCORE,
CASE WHEN (CE.YN_OBJECT = ''Y'' OR CE.YN_OBJECT IS NULL OR CE.YN_OBJECT = '''') THEN OT.RT_WEIGHT ELSE IM.NUM_EWEIGHT END EWEIGHT,
(CASE WHEN SE.CD_GRADE IS NOT NULL THEN SE.PT_HSCORE ELSE SE.PT_SCORE END *
CASE WHEN (CE.YN_OBJECT = ''Y'' OR CE.YN_OBJECT IS NULL OR CE.YN_OBJECT = '''') THEN OT.RT_WEIGHT ELSE IM.NUM_EWEIGHT END * ISNULL(IM2.NUM_EWEIGHT, 1) * ISNULL(IM3.NUM_EWEIGHT, 1)) AS SCORE_PT
FROM	HR_PEVALU_SCORE SE
LEFT OUTER JOIN HR_PEVALU_CODE CE
ON		SE.CD_COMPANY	= CE.CD_COMPANY
AND		SE.CD_EVALU		= CE.CD_EVALU
AND		CE.CD_FIELD		= ''100''
AND		SE.CD_EVTYPE	= CE.CD_HCODE
LEFT OUTER JOIN HR_PEVALU_ITEM IM
ON		SE.CD_COMPANY	= IM.CD_COMPANY
AND		SE.CD_EVALU		= IM.CD_EVALU
AND		SE.CD_EVTYPE	= IM.CD_EVTYPE
AND		SE.CD_GROUP		= IM.CD_GROUP
AND		SE.CD_EVOTYPE	= IM.CD_EVITEM
LEFT OUTER JOIN HR_PEVALU_ITEM IM2
ON		SE.CD_COMPANY	= IM2.CD_COMPANY
AND		SE.CD_EVALU		= IM2.CD_EVALU
AND		SE.CD_EVTYPE	= IM2.CD_EVTYPE
AND		SE.CD_GROUP		= IM2.CD_GROUP
AND		IM.H_EVITEM		= IM2.CD_EVITEM
LEFT OUTER JOIN HR_PEVALU_ITEM IM3
ON		SE.CD_COMPANY	= IM3.CD_COMPANY
AND		SE.CD_EVALU		= IM3.CD_EVALU
AND		SE.CD_EVTYPE	= IM3.CD_EVTYPE
AND		SE.CD_GROUP		= IM3.CD_GROUP
AND		IM2.H_EVITEM	= IM3.CD_EVITEM
LEFT OUTER JOIN HR_PEVALU_OBJECT OT
ON		OT.CD_COMPANY	= SE.CD_COMPANY
AND		OT.CD_EVALU		= SE.CD_EVALU
AND		OT.CD_EVTYPE	= SE.CD_EVTYPE
AND		OT.CD_EVOTYPE	= SE.CD_EVOTYPE
AND		OT.NO_EMP		= SE.NO_EMPAN
WHERE	SE.CD_COMPANY	= ''' + @P_CD_COMPANY + '''
AND		SE.CD_EVALU		= ''' + @P_CD_EVALU + '''
AND		SE.NO_EMPM		= ''' + @P_NO_EMPM + '''	) M
LEFT OUTER JOIN HR_PEVALU_CODE GP
ON		M.CD_COMPANY	= GP.CD_COMPANY
AND		M.CD_EVALU		= GP.CD_EVALU
AND		GP.CD_FIELD		= ''200''
AND		M.CD_GROUP		= GP.CD_HCODE
WHERE	M.CD_EVTYPE		= ''' + CD_HCODE + '''
GROUP BY M.CD_COMPANY, M.CD_EVALU, M.CD_EVTYPE, M.CD_EVNUMBER, M.CD_GROUP, M.NO_EMPM, M.NO_EMPAN, GP.RT_WEIGHT1 ) SC
LEFT OUTER JOIN HR_PEVALU_HUMEMPAN HN
ON		SC.CD_COMPANY	= HN.CD_COMPANY
AND		SC.CD_EVALU		= HN.CD_EVALU
AND		SC.CD_EVTYPE	= HN.CD_EVTYPE
AND		SC.CD_EVNUMBER	= HN.CD_EVNUMBER
AND		SC.CD_GROUP		= HN.CD_GROUP
AND		SC.NO_EMPM		= HN.NO_EMPM
AND		SC.NO_EMPAN		= HN.NO_EMPAN
GROUP BY SC.CD_COMPANY, SC.CD_EVALU, SC.NO_EMPM, SC.NO_EMPAN, SC.CD_EVNUMBER	) M' + CD_HCODE + '
ON		MAN.CD_COMPANY	= M' + CD_HCODE + '.CD_COMPANY
AND		MAN.CD_EVALU	= M' + CD_HCODE + '.CD_EVALU
AND		MAN.CD_EVNUMBER	= M' + CD_HCODE + '.CD_EVNUMBER
AND		MAN.NO_EMPM		= M' + CD_HCODE + '.NO_EMPM
AND		MAN.NO_EMPAN	= M' + CD_HCODE + '.NO_EMPAN'
			FROM	#TEMP1
			WHERE	RN		= @V_ID 
		END
		
		SET		@V_ID	= @V_ID + 1  
	END 
	
	SET	@V_SELECT1	= 'SELECT	'''' S, MAN.CD_COMPANY, MAN.CD_EVALU, MAN.NO_EMPM, MAN.NO_EMPAN, MAN.NM_KOR, MAN.CD_EVNUMBER, PCE.NM_HCODE,
								RST.PT_SCORE, RST.PT_ADJUST, RST.PT_FINAL, RST.GRD_FINAL'
	SET	@V_FROM1	= '	FROM	(SELECT	PS.CD_COMPANY, PS.CD_EVALU, PS.CD_EVNUMBER, PS.NO_EMPM, PS.NO_EMPAN, EP.NM_KOR
								 FROM	HR_PEVALU_SCORE PS
								 LEFT OUTER JOIN HR_PEVALU_HUMEMPAN HN
								 ON	PS.CD_COMPANY = HN.CD_COMPANY
								 AND PS.CD_EVALU = HN.CD_EVALU
								 AND PS.CD_EVTYPE = HN.CD_EVTYPE
								 AND PS.CD_EVNUMBER	= HN.CD_EVNUMBER
								 AND PS.CD_GROUP = HN.CD_GROUP
								 AND PS.NO_EMPM	= HN.NO_EMPM
								 AND PS.NO_EMPAN = HN.NO_EMPAN
								 LEFT OUTER JOIN MA_EMP EP
								 ON	HN.CD_BIZAREA = EP.CD_COMPANY
								 AND HN.NO_EMPAN = EP.NO_EMP
								 WHERE PS.CD_COMPANY = ''' + @P_CD_COMPANY + '''
								 AND PS.CD_EVALU = ''' + @P_CD_EVALU + '''
								 AND PS.NO_EMPM	= ''' + @P_NO_EMPM + '''
								 GROUP BY PS.CD_COMPANY, PS.CD_EVALU, PS.CD_EVNUMBER, PS.NO_EMPM, PS.NO_EMPAN, EP.NM_KOR) MAN
						LEFT OUTER JOIN HR_PEVALU_CODE PCE
						ON		MAN.CD_COMPANY	= PCE.CD_COMPANY
						AND		MAN.CD_EVALU	= PCE.CD_EVALU
						AND		PCE.CD_FIELD	= ''300''
						AND		MAN.CD_EVNUMBER	= PCE.CD_HCODE
						LEFT OUTER JOIN HR_PEVALU_RESULT RST
						ON		MAN.CD_COMPANY	= RST.CD_COMPANY
						AND		MAN.CD_EVALU	= RST.CD_EVALU
						AND		MAN.CD_EVNUMBER	= RST.CD_EVNUMBER
						AND		MAN.NO_EMPAN	= RST.NO_EMP '


	DROP TABLE #TEMP1

	--PRINT (@V_SELECT1 + @V_SELECT2 + @V_FROM1 + @V_FROM2 + @V_FROM3 + @V_FROM4 + @V_FROM5 + @V_FROM6 + @V_FROM7 + @V_FROM8 + @V_FROM9)

	EXEC (@V_SELECT1 + @V_SELECT2 + @V_FROM1 + @V_FROM2 + @V_FROM3 + @V_FROM4 + @V_FROM5 + @V_FROM6 + @V_FROM7 + @V_FROM8 + @V_FROM9)
END



GO

