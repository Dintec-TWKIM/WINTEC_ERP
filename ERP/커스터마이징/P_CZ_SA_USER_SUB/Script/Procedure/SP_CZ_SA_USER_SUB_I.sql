USE [NEOE]
GO

/****** Object:  StoredProcedure [NEOE].[SP_CZ_SA_USER_SUB_I]    Script Date: 2015-07-01 오후 2:15:04 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO


ALTER PROCEDURE [NEOE].[SP_CZ_SA_USER_SUB_I]
(
	@P_CD_COMPANY			NVARCHAR(7),
	@P_ID_USER				NVARCHAR(15),
	@P_TP_SALES				NVARCHAR(MAX),
	@P_TP_SALES_DEF			NVARCHAR(2),
	@P_TP_BIZ				NVARCHAR(2),
	@P_CD_SALEGRP			NVARCHAR(12),
	@P_CD_PARTNER_GRP		NVARCHAR(10),
	@P_ID_SALES				NVARCHAR(MAX),
	@P_ID_SALES_DEF			NVARCHAR(15),
	@P_ID_TYPIST			NVARCHAR(MAX),
	@P_ID_TYPIST_DEF		NVARCHAR(15),
	@P_ID_PUR				NVARCHAR(MAX),
	@P_ID_PUR_DEF			NVARCHAR(15),
	@P_ID_LOG				NVARCHAR(MAX),
	@P_ID_LOG_DEF			NVARCHAR(15),
	@P_ID_FIRST_APPROVAL	NVARCHAR(15),
	@P_ID_SECOND_APPROVAL	NVARCHAR(15),
	@P_NM_ENG				NVARCHAR(40),
	@P_NO_EMAIL				NVARCHAR(100),
	@P_NO_TEL				NVARCHAR(20),
	@P_NO_TEL_EMER			NVARCHAR(20),
	@P_DC_RMK				NVARCHAR(200),
	@P_DC_RMK1				NVARCHAR(200),
	@P_YN_EXPECT			NVARCHAR(1),
	@P_ID_INSERT			NVARCHAR(15)
)
AS

INSERT INTO CZ_SA_USER  
(
	CD_COMPANY,
	ID_USER,
	TP_SALES,
	TP_SALES_DEF,
	TP_BIZ,
	ID_SALES,
	ID_SALES_DEF,
	ID_TYPIST,
	ID_TYPIST_DEF,
	ID_TYPIST_AUTO,
	ID_PUR,
	ID_PUR_DEF,
	ID_LOG,
	ID_LOG_DEF,
	ID_FIRST_APPROVAL,
	ID_SECOND_APPROVAL,
	ID_EXPECT,
	DTS_EXPECT,
	YN_EXPECT,
	CD_PARTNER_GRP,
	ID_INSERT,
	DTS_INSERT
)  
VALUES
(
	@P_CD_COMPANY,
	@P_ID_USER,
	@P_TP_SALES,			
	@P_TP_SALES_DEF,		
	@P_TP_BIZ,			
	@P_ID_SALES,			
	@P_ID_SALES_DEF,		
	@P_ID_TYPIST,		
	@P_ID_TYPIST_DEF,	
	@P_ID_TYPIST,
	@P_ID_PUR,			
	@P_ID_PUR_DEF,		
	@P_ID_LOG,
	@P_ID_LOG_DEF,
	@P_ID_FIRST_APPROVAL,
	@P_ID_SECOND_APPROVAL,
	(CASE WHEN @P_YN_EXPECT = 'Y' THEN @P_ID_INSERT ELSE NULL END),
	(CASE WHEN @P_YN_EXPECT = 'Y' THEN NEOE.SF_SYSDATE(GETDATE()) ELSE NULL END),
	@P_YN_EXPECT,
	@P_CD_PARTNER_GRP,
	@P_ID_INSERT,
	NEOE.SF_SYSDATE(GETDATE()) 
)

UPDATE MA_USER
SET CD_SALEGRP = @P_CD_SALEGRP,			
	CD_PURGRP = @P_CD_SALEGRP,
	ID_UPDATE = @P_ID_INSERT, 
	DTS_UPDATE = NEOE.SF_SYSDATE(GETDATE())
WHERE CD_COMPANY = @P_CD_COMPANY
AND ID_USER = @P_ID_USER

UPDATE ME
SET ME.NM_ENG = @P_NM_ENG,
	ME.NO_EMAIL = @P_NO_EMAIL,
	ME.NO_TEL = @P_NO_TEL,
	ME.NO_TEL_EMER = @P_NO_TEL_EMER,
	ME.DC_RMK = @P_DC_RMK,
	ME.DC_RMK1 = @P_DC_RMK1,
	ME.ID_UPDATE = @P_ID_INSERT,
	ME.DTS_UPDATE = NEOE.SF_SYSDATE(GETDATE())
FROM MA_EMP ME
WHERE ME.CD_COMPANY = @P_CD_COMPANY
AND EXISTS (SELECT 1 
		    FROM MA_USER MU
			WHERE MU.CD_COMPANY = ME.CD_COMPANY
			AND MU.ID_USER = @P_ID_USER
			AND MU.NO_EMP = ME.NO_EMP)

GO

