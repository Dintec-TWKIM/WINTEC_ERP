USE [NEOE]
GO

/****** Object:  StoredProcedure [NEOE].[SP_CZ_SA_USER_SUB_S]    Script Date: 2015-07-01 오후 2:15:16 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO




ALTER PROCEDURE [NEOE].[SP_CZ_SA_USER_SUB_S]
(
	@P_CD_COMPANY       NVARCHAR(7),
	@P_LANGUAGE			NVARCHAR(5) = 'KR',
	@P_ID_USER          NVARCHAR(15)
)
AS

SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED

SELECT SU.TP_SALES,
	   SU.TP_SALES_DEF,
	   SU.TP_BIZ,
	   SU.ID_SALES,
	   SU.ID_SALES_DEF,
	   SU.ID_TYPIST,
	   SU.ID_TYPIST_DEF,
	   SU.ID_PUR,
	   SU.ID_PUR_DEF,
	   SU.ID_LOG,
	   SU.ID_LOG_DEF,
	   SU.ID_FIRST_APPROVAL,
	   (CASE WHEN @P_LANGUAGE = 'KR' THEN ME1.NM_KOR
			 WHEN @P_LANGUAGE = 'US' THEN ME1.NM_ENG
			 WHEN @P_LANGUAGE = 'JP' THEN ME1.NM_KOR  
			 WHEN @P_LANGUAGE = 'CH' THEN ME1.NM_CHIN END) NM_FIRST_APPROVAL,
	   SU.ID_SECOND_APPROVAL,
	   (CASE WHEN @P_LANGUAGE = 'KR' THEN ME2.NM_KOR
			 WHEN @P_LANGUAGE = 'US' THEN ME2.NM_ENG
			 WHEN @P_LANGUAGE = 'JP' THEN ME2.NM_KOR  
			 WHEN @P_LANGUAGE = 'CH' THEN ME2.NM_CHIN END) NM_SECOND_APPROVAL,
	   MU.CD_SALEGRP,
	   MS.NM_SALEGRP,
	   SU.CD_PARTNER_GRP,
	   MC.NM_SYSDEF AS NM_PARTNER_GRP,
	   ME.NM_ENG,
	   ME.NO_EMAIL,
	   ME.NO_TEL,
	   ME.NO_TEL_EMER,
	   ME.DC_RMK,
	   ME.DC_RMK1,
	   ISNULL(SU.YN_EXPECT, 'N') AS YN_EXPECT 
FROM CZ_SA_USER SU
JOIN MA_USER MU ON MU.CD_COMPANY = SU.CD_COMPANY AND MU.ID_USER = SU.ID_USER
LEFT JOIN MA_EMP ME ON ME.CD_COMPANY = MU.CD_COMPANY AND ME.NO_EMP = MU.NO_EMP
LEFT JOIN MA_SALEGRP MS ON MS.CD_COMPANY = MU.CD_COMPANY AND MS.CD_SALEGRP = MU.CD_SALEGRP
LEFT JOIN MA_CODEDTL MC ON MC.CD_COMPANY = SU.CD_COMPANY AND MC.CD_FIELD = 'MA_B000065' AND MC.CD_SYSDEF = SU.CD_PARTNER_GRP
LEFT JOIN MA_PURGRP MP ON MP.CD_COMPANY = MU.CD_COMPANY AND MP.CD_PURGRP = MU.CD_PURGRP
LEFT JOIN MA_USER MU1 ON MU1.CD_COMPANY = SU.CD_COMPANY AND MU1.ID_USER = SU.ID_FIRST_APPROVAL
LEFT JOIN MA_EMP ME1 ON ME1.CD_COMPANY = MU1.CD_COMPANY AND ME1.NO_EMP = MU1.NO_EMP
LEFT JOIN MA_USER MU2 ON MU2.CD_COMPANY = SU.CD_COMPANY AND MU2.ID_USER = SU.ID_SECOND_APPROVAL
LEFT JOIN MA_EMP ME2 ON ME2.CD_COMPANY = MU2.CD_COMPANY AND ME2.NO_EMP = MU2.NO_EMP
WHERE SU.CD_COMPANY = @P_CD_COMPANY
AND SU.ID_USER = @P_ID_USER

GO