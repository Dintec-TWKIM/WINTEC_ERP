USE [NEOE]
GO
/****** Object:  StoredProcedure [NEOE].[SP_CZ_BI_BIZ_RESULT_CHART_S]    Script Date: 2018-02-09 오전 9:32:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO




ALTER PROCEDURE [NEOE].[SP_CZ_BI_BIZ_RESULT_CHART_S]
(
	@P_CD_COMPANY		NVARCHAR(7),
	@P_TYPE				NVARCHAR(3),
	@P_DT_START			NVARCHAR(8),
	@P_DT_END			NVARCHAR(8),
	@P_CD_UNIT			NVARCHAR(3)
) 
AS
 
SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED

DECLARE @V_NUM_UNIT NUMERIC(9, 0)

SET @V_NUM_UNIT = (CASE @P_CD_UNIT WHEN '001' THEN 1
								   WHEN '002' THEN 10
								   WHEN '003' THEN 100
								   WHEN '004' THEN 1000
								   WHEN '005' THEN 10000
								   WHEN '006' THEN 100000
								   WHEN '007' THEN 1000000
								   WHEN '008' THEN 10000000
								   WHEN '009' THEN 100000000 END)

IF @P_TYPE = '000'
BEGIN
	IF @P_CD_COMPANY = 'K100'
	BEGIN
		SELECT (SUBSTRING(SH.DT_SO, 3, 2) + '/' + SUBSTRING(SH.DT_SO, 5, 2)) AS DT_SO,
			   (SUM(CASE WHEN SH.CD_SALEORG = '010300' OR SH.CD_SALEORG = 'SD1' THEN SH.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_SD1,
			   (SUM(CASE WHEN SH.CD_SALEORG = '010400' OR SH.CD_SALEORG = 'SD2' THEN SH.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_SD2,
			   (SUM(CASE WHEN SH.CD_SALEORG = '010600' OR SH.CD_SALEORG = 'TSD' THEN SH.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_TSD,
			   (SUM(CASE WHEN SH.CD_SALEORG IN ('010300', '010400', '010600', 'SD1', 'SD2', 'TSD') THEN SH.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_TOTAL,
			   (SUM(CASE WHEN SH.CD_CC = '010310' THEN SH.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_SD1_1,
			   (SUM(CASE WHEN SH.CD_CC = '010320' THEN SH.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_SD1_2,
			   (SUM(CASE WHEN SH.CD_CC = '010340' THEN SH.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_SD1_3,
			   (SUM(CASE WHEN SH.CD_CC = '010350' THEN SH.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_SD1_T,
			   (SUM(CASE WHEN SH.CD_CC = '010420' OR SH.CD_CC = 'SD2-1' THEN SH.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_SD2_2,
			   (SUM(CASE WHEN SH.CD_CC = '010410' OR SH.CD_CC = 'SD2-2' THEN SH.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_SD2_1,
			   (SUM(CASE WHEN SH.CD_CC = '010430' OR SH.CD_CC = 'SD2-D' THEN SH.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_SD2_D,

			   (SUM(CASE WHEN SH.CD_SALEORG = '010300' OR SH.CD_SALEORG = 'SD1' THEN SH.AM_SO_PLAN ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_PLAN_SD1,
			   (SUM(CASE WHEN SH.CD_SALEORG = '010400' OR SH.CD_SALEORG = 'SD2' THEN SH.AM_SO_PLAN ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_PLAN_SD2,
			   (SUM(CASE WHEN SH.CD_SALEORG = '010600' OR SH.CD_SALEORG = 'TSD' THEN SH.AM_SO_PLAN ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_PLAN_TSD,
			   (SUM(CASE WHEN SH.CD_SALEORG IN ('010300', '010400', '010600', 'SD1', 'SD2', 'TSD') THEN SH.AM_SO_PLAN ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_PLAN_TOTAL,
			   (SUM(CASE WHEN SH.CD_CC = '010310' THEN SH.AM_SO_PLAN ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_PLAN_SD1_1,
			   (SUM(CASE WHEN SH.CD_CC = '010320' THEN SH.AM_SO_PLAN ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_PLAN_SD1_2,
			   (SUM(CASE WHEN SH.CD_CC = '010340' THEN SH.AM_SO_PLAN ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_PLAN_SD1_3,
			   (SUM(CASE WHEN SH.CD_CC = '010350' THEN SH.AM_SO_PLAN ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_PLAN_SD1_T,
			   (SUM(CASE WHEN SH.CD_CC = '010420' OR SH.CD_CC = 'SD2-1' THEN SH.AM_SO_PLAN ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_PLAN_SD2_2,
			   (SUM(CASE WHEN SH.CD_CC = '010410' OR SH.CD_CC = 'SD2-2' THEN SH.AM_SO_PLAN ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_PLAN_SD2_1,
			   (SUM(CASE WHEN SH.CD_CC = '010430' OR SH.CD_CC = 'SD2-D' THEN SH.AM_SO_PLAN ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_PLAN_SD2_D,

			   (SUM(CASE WHEN SH.CD_SALEORG = '010300' OR SH.CD_SALEORG = 'SD1' THEN SH1.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_BEFORE_SD1,
			   (SUM(CASE WHEN SH.CD_SALEORG = '010400' OR SH.CD_SALEORG = 'SD2' THEN SH1.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_BEFORE_SD2,
			   (SUM(CASE WHEN SH.CD_SALEORG = '010600' OR SH.CD_SALEORG = 'TSD' THEN SH1.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_BEFORE_TSD,
			   (SUM(CASE WHEN SH.CD_SALEORG IN ('010300', '010400', '010600', 'SD1', 'SD2', 'TSD') THEN SH1.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_BEFORE_TOTAL,
			   (SUM(CASE WHEN SH.CD_CC = '010310' THEN SH1.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_BEFORE_SD1_1,
			   (SUM(CASE WHEN SH.CD_CC = '010320' THEN SH1.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_BEFORE_SD1_2,
			   (SUM(CASE WHEN SH.CD_CC = '010340' THEN SH1.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_BEFORE_SD1_3,
			   (SUM(CASE WHEN SH.CD_CC = '010350' THEN SH1.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_BEFORE_SD1_T,
			   (SUM(CASE WHEN SH.CD_CC = '010420' OR SH.CD_CC = 'SD2-1' THEN SH1.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_BEFORE_SD2_2,
			   (SUM(CASE WHEN SH.CD_CC = '010410' OR SH.CD_CC = 'SD2-2' THEN SH1.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_BEFORE_SD2_1,
			   (SUM(CASE WHEN SH.CD_CC = '010430' OR SH.CD_CC = 'SD2-D' THEN SH1.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_BEFORE_SD2_D    
		FROM (SELECT LEFT(SH.DT_CONTRACT, 6) AS DT_SO,
					 LEFT(CONVERT(CHAR(8), DATEADD(YY, -1, LEFT(SH.DT_CONTRACT, 6) + '01'), 112), 6) AS DT_SO_BEFORE,
			  		 SG.CD_SALEORG,
					 SG.CD_CC,
			  		 ISNULL(SUM(SL.AM_KR_S), 0) AS AM_SO,
					 ISNULL(MAX((CASE SUBSTRING(SH.DT_CONTRACT, 5, 2) WHEN '01' THEN SP.AM_TOT_JAN
					  												  WHEN '03' THEN SP.AM_TOT_MAR
					  												  WHEN '02' THEN SP.AM_TOT_FEB
					  												  WHEN '04' THEN SP.AM_TOT_APR
					  												  WHEN '05' THEN SP.AM_TOT_MAY
					  												  WHEN '06' THEN SP.AM_TOT_JUN
					  												  WHEN '07' THEN SP.AM_TOT_JUL
					  												  WHEN '08' THEN SP.AM_TOT_AUG
					  												  WHEN '09' THEN SP.AM_TOT_SEP
					  												  WHEN '10' THEN SP.AM_TOT_OCT
					  												  WHEN '11' THEN SP.AM_TOT_NOV
					  												  WHEN '12' THEN SP.AM_TOT_DEC END)), 0) AS AM_SO_PLAN 
			  FROM SA_SOH SH
			  LEFT JOIN MA_SALEGRP SG ON SG.CD_COMPANY = SH.CD_COMPANY AND SG.CD_SALEGRP = SH.CD_SALEGRP
			  LEFT JOIN SA_SOL SL ON SL.CD_COMPANY = SH.CD_COMPANY AND SL.NO_SO = SH.NO_SO
			  LEFT JOIN CZ_SA_PTR_PLAN SP ON SP.CD_COMPANY = SH.CD_COMPANY AND SP.TP_PLAN = '0' AND SP.CD_KEY = SG.CD_CC AND SP.YY_PLAN = LEFT(SH.DT_CONTRACT, 4)
			  WHERE SH.CD_COMPANY = @P_CD_COMPANY
			  AND ISNULL(SH.DT_CONTRACT, '') <> ''
			  AND SH.DT_CONTRACT BETWEEN @P_DT_START AND @P_DT_END
			  AND SH.DT_CONTRACT >= '20160101'
			  AND SG.CD_SALEORG IN ('010300', '010400', '010600')
			  GROUP BY LEFT(SH.DT_CONTRACT, 6), SG.CD_SALEORG, SG.CD_CC
			  UNION ALL
			  SELECT BR.DT_BIZ_RESULT AS DT_SO,
					 LEFT(CONVERT(CHAR(8), DATEADD(YY, -1, LEFT(BR.DT_BIZ_RESULT, 6) + '01'), 112), 6) AS DT_SO_BEFORE,
					 BR.CD_DEPT AS CD_SALEORG,
					 BR.CD_DEPT AS CD_CC,
					 ISNULL(BR.AM_BIZ_RESULT, 0) AS AM_SO,
					 0 AS AM_SO_PLAN
			  FROM CZ_SA_BIZ_RESULT BR
			  WHERE BR.CD_COMPANY = @P_CD_COMPANY
			  AND BR.TP_GUBUN = '001'
			  AND BR.DT_BIZ_RESULT BETWEEN LEFT(@P_DT_START, 6) AND LEFT(@P_DT_END, 6)) SH
		LEFT JOIN (SELECT LEFT(SH.DT_CONTRACT, 6) AS DT_SO,
				   		  SG.CD_SALEORG,
				   	      SG.CD_CC,
				   		  ISNULL(SUM(SL.AM_KR_S), 0) AS AM_SO
				   FROM SA_SOH SH
				   LEFT JOIN MA_SALEGRP SG ON SG.CD_COMPANY = SH.CD_COMPANY AND SG.CD_SALEGRP = SH.CD_SALEGRP
				   LEFT JOIN SA_SOL SL ON SL.CD_COMPANY = SH.CD_COMPANY AND SL.NO_SO = SH.NO_SO
				   WHERE SH.CD_COMPANY = @P_CD_COMPANY 
				   AND ISNULL(SH.DT_CONTRACT, '') <> ''
				   AND SH.DT_CONTRACT >= '20160101'
				   AND SG.CD_SALEORG IN ('010300', '010400', '010600')
				   GROUP BY LEFT(SH.DT_CONTRACT, 6), SG.CD_SALEORG, SG.CD_CC
				   UNION ALL
				   SELECT BR.DT_BIZ_RESULT AS DT_SO,
				   		  BR.CD_DEPT AS CD_SALEORG,
				   		  BR.CD_DEPT AS CD_CC,
				   		  ISNULL(BR.AM_BIZ_RESULT, 0) AS AM_SO
				   FROM CZ_SA_BIZ_RESULT BR
				   WHERE BR.CD_COMPANY = @P_CD_COMPANY 
				   AND BR.TP_GUBUN = '001') SH1
		ON SH1.DT_SO = SH.DT_SO_BEFORE AND SH1.CD_SALEORG = SH.CD_SALEORG AND SH1.CD_CC = SH.CD_CC
		GROUP BY SH.DT_SO
		ORDER BY SH.DT_SO
	END
	ELSE IF @P_CD_COMPANY = 'K200'
	BEGIN
		SELECT (SUBSTRING(SH.DT_SO, 3, 2) + '/' + SUBSTRING(SH.DT_SO, 5, 2)) AS DT_SO,
			   (SUM(CASE WHEN SH.CD_SALEORG IN ('020200', 'SD') THEN SH.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_TOTAL,
			   (SUM(CASE WHEN SH.CD_SALEORG IN ('020200', 'SD') THEN SH.AM_SO_PLAN ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_PLAN_TOTAL,
			   (SUM(CASE WHEN SH.CD_SALEORG IN ('020200', 'SD') THEN SH1.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_BEFORE_TOTAL 
		FROM (SELECT LEFT(SH.DT_CONTRACT, 6) AS DT_SO,
					 LEFT(CONVERT(CHAR(8), DATEADD(YY, -1, LEFT(SH.DT_CONTRACT, 6) + '01'), 112), 6) AS DT_SO_BEFORE,
			  		 SG.CD_SALEORG,
					 SG.CD_CC,
			  		 ISNULL(SUM(SL.AM_KR_S), 0) AS AM_SO,
					 ISNULL(MAX((CASE SUBSTRING(SH.DT_CONTRACT, 5, 2) WHEN '01' THEN SP.AM_TOT_JAN
					  												  WHEN '03' THEN SP.AM_TOT_MAR
					  												  WHEN '02' THEN SP.AM_TOT_FEB
					  												  WHEN '04' THEN SP.AM_TOT_APR
					  												  WHEN '05' THEN SP.AM_TOT_MAY
					  												  WHEN '06' THEN SP.AM_TOT_JUN
					  												  WHEN '07' THEN SP.AM_TOT_JUL
					  												  WHEN '08' THEN SP.AM_TOT_AUG
					  												  WHEN '09' THEN SP.AM_TOT_SEP
					  												  WHEN '10' THEN SP.AM_TOT_OCT
					  												  WHEN '11' THEN SP.AM_TOT_NOV
					  												  WHEN '12' THEN SP.AM_TOT_DEC END)), 0) AS AM_SO_PLAN 
			  FROM SA_SOH SH
			  LEFT JOIN MA_SALEGRP SG ON SG.CD_COMPANY = SH.CD_COMPANY AND SG.CD_SALEGRP = SH.CD_SALEGRP
			  LEFT JOIN SA_SOL SL ON SL.CD_COMPANY = SH.CD_COMPANY AND SL.NO_SO = SH.NO_SO
			  LEFT JOIN CZ_SA_PTR_PLAN SP ON SP.CD_COMPANY = SH.CD_COMPANY AND SP.TP_PLAN = '0' AND SP.CD_KEY = SG.CD_CC AND SP.YY_PLAN = LEFT(SH.DT_CONTRACT, 4)
			  WHERE SH.CD_COMPANY = @P_CD_COMPANY
			  AND ISNULL(SH.DT_CONTRACT, '') <> ''
			  AND SH.DT_CONTRACT BETWEEN @P_DT_START AND @P_DT_END
			  AND SH.DT_CONTRACT >= '20160101'
			  AND SG.CD_SALEORG = '020200'
			  GROUP BY LEFT(SH.DT_CONTRACT, 6), SG.CD_SALEORG, SG.CD_CC
			  UNION ALL
			  SELECT BR.DT_BIZ_RESULT AS DT_SO,
					 LEFT(CONVERT(CHAR(8), DATEADD(YY, -1, LEFT(BR.DT_BIZ_RESULT, 6) + '01'), 112), 6) AS DT_SO_BEFORE,
					 BR.CD_DEPT AS CD_SALEORG,
					 BR.CD_DEPT AS CD_CC,
					 ISNULL(BR.AM_BIZ_RESULT, 0) AS AM_SO,
					 0 AS AM_SO_PLAN
			  FROM CZ_SA_BIZ_RESULT BR
			  WHERE BR.CD_COMPANY = @P_CD_COMPANY
			  AND BR.TP_GUBUN = '001'
			  AND BR.DT_BIZ_RESULT BETWEEN LEFT(@P_DT_START, 6) AND LEFT(@P_DT_END, 6)) SH
		LEFT JOIN (SELECT LEFT(SH.DT_CONTRACT, 6) AS DT_SO,
				   		  SG.CD_SALEORG,
				   	      SG.CD_CC,
				   		  ISNULL(SUM(SL.AM_KR_S), 0) AS AM_SO
				   FROM SA_SOH SH
				   LEFT JOIN MA_SALEGRP SG ON SG.CD_COMPANY = SH.CD_COMPANY AND SG.CD_SALEGRP = SH.CD_SALEGRP
				   LEFT JOIN SA_SOL SL ON SL.CD_COMPANY = SH.CD_COMPANY AND SL.NO_SO = SH.NO_SO
				   WHERE SH.CD_COMPANY = @P_CD_COMPANY 
				   AND ISNULL(SH.DT_CONTRACT, '') <> ''
				   AND SH.DT_CONTRACT >= '20160101'
				   AND SG.CD_SALEORG  = '020200'
				   GROUP BY LEFT(SH.DT_CONTRACT, 6), SG.CD_SALEORG, SG.CD_CC
				   UNION ALL
				   SELECT BR.DT_BIZ_RESULT AS DT_SO,
				   		  BR.CD_DEPT AS CD_SALEORG,
				   		  BR.CD_DEPT AS CD_CC,
				   		  ISNULL(BR.AM_BIZ_RESULT, 0) AS AM_SO
				   FROM CZ_SA_BIZ_RESULT BR
				   WHERE BR.CD_COMPANY = @P_CD_COMPANY 
				   AND BR.TP_GUBUN = '001') SH1
		ON SH1.DT_SO = SH.DT_SO_BEFORE AND SH1.CD_SALEORG = SH.CD_SALEORG AND SH1.CD_CC = SH.CD_CC
		GROUP BY SH.DT_SO
		ORDER BY SH.DT_SO
	END
	ELSE IF @P_CD_COMPANY = 'S100'
	BEGIN
		SELECT (SUBSTRING(SH.DT_SO, 3, 2) + '/' + SUBSTRING(SH.DT_SO, 5, 2)) AS DT_SO,
			   (SUM(CASE WHEN SH.CD_SALEORG IN ('030300', 'SD') THEN SH.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_TOTAL,
			   (SUM(CASE WHEN SH.CD_SALEORG IN ('030300', 'SD') THEN SH.AM_SO_PLAN ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_PLAN_TOTAL,
			   (SUM(CASE WHEN SH.CD_SALEORG IN ('030300', 'SD') THEN SH1.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_BEFORE_TOTAL 
		FROM (SELECT LEFT(SH.DT_CONTRACT, 6) AS DT_SO,
					 LEFT(CONVERT(CHAR(8), DATEADD(YY, -1, LEFT(SH.DT_CONTRACT, 6) + '01'), 112), 6) AS DT_SO_BEFORE,
			  		 SG.CD_SALEORG,
					 SG.CD_CC,
			  		 ISNULL(SUM(SL.AM_KR_S), 0) AS AM_SO,
					 ISNULL(MAX((CASE SUBSTRING(SH.DT_CONTRACT, 5, 2) WHEN '01' THEN SP.AM_TOT_JAN
					  												  WHEN '03' THEN SP.AM_TOT_MAR
					  												  WHEN '02' THEN SP.AM_TOT_FEB
					  												  WHEN '04' THEN SP.AM_TOT_APR
					  												  WHEN '05' THEN SP.AM_TOT_MAY
					  												  WHEN '06' THEN SP.AM_TOT_JUN
					  												  WHEN '07' THEN SP.AM_TOT_JUL
					  												  WHEN '08' THEN SP.AM_TOT_AUG
					  												  WHEN '09' THEN SP.AM_TOT_SEP
					  												  WHEN '10' THEN SP.AM_TOT_OCT
					  												  WHEN '11' THEN SP.AM_TOT_NOV
					  												  WHEN '12' THEN SP.AM_TOT_DEC END)), 0) AS AM_SO_PLAN 
			  FROM SA_SOH SH
			  LEFT JOIN MA_SALEGRP SG ON SG.CD_COMPANY = SH.CD_COMPANY AND SG.CD_SALEGRP = SH.CD_SALEGRP
			  LEFT JOIN SA_SOL SL ON SL.CD_COMPANY = SH.CD_COMPANY AND SL.NO_SO = SH.NO_SO
			  LEFT JOIN CZ_SA_PTR_PLAN SP ON SP.CD_COMPANY = SH.CD_COMPANY AND SP.TP_PLAN = '0' AND SP.CD_KEY = SG.CD_CC AND SP.YY_PLAN = LEFT(SH.DT_CONTRACT, 4)
			  WHERE SH.CD_COMPANY = @P_CD_COMPANY
			  AND ISNULL(SH.DT_CONTRACT, '') <> ''
			  AND SH.DT_CONTRACT BETWEEN @P_DT_START AND @P_DT_END
			  AND SH.DT_CONTRACT >= '20160101'
			  AND SG.CD_SALEORG = '030300'
			  GROUP BY LEFT(SH.DT_CONTRACT, 6), SG.CD_SALEORG, SG.CD_CC
			  UNION ALL
			  SELECT BR.DT_BIZ_RESULT AS DT_SO,
					 LEFT(CONVERT(CHAR(8), DATEADD(YY, -1, LEFT(BR.DT_BIZ_RESULT, 6) + '01'), 112), 6) AS DT_SO_BEFORE,
					 BR.CD_DEPT AS CD_SALEORG,
					 BR.CD_DEPT AS CD_CC,
					 ISNULL(BR.AM_BIZ_RESULT, 0) AS AM_SO,
					 0 AS AM_SO_PLAN
			  FROM CZ_SA_BIZ_RESULT BR
			  WHERE BR.CD_COMPANY = @P_CD_COMPANY
			  AND BR.TP_GUBUN = '001'
			  AND BR.DT_BIZ_RESULT BETWEEN LEFT(@P_DT_START, 6) AND LEFT(@P_DT_END, 6)) SH
		LEFT JOIN (SELECT LEFT(SH.DT_CONTRACT, 6) AS DT_SO,
				   		  SG.CD_SALEORG,
				   	      SG.CD_CC,
				   		  ISNULL(SUM(SL.AM_KR_S), 0) AS AM_SO
				   FROM SA_SOH SH
				   LEFT JOIN MA_SALEGRP SG ON SG.CD_COMPANY = SH.CD_COMPANY AND SG.CD_SALEGRP = SH.CD_SALEGRP
				   LEFT JOIN SA_SOL SL ON SL.CD_COMPANY = SH.CD_COMPANY AND SL.NO_SO = SH.NO_SO
				   WHERE SH.CD_COMPANY = @P_CD_COMPANY 
				   AND ISNULL(SH.DT_CONTRACT, '') <> ''
				   AND SH.DT_CONTRACT >= '20160101'
				   AND SG.CD_SALEORG  = '030300'
				   GROUP BY LEFT(SH.DT_CONTRACT, 6), SG.CD_SALEORG, SG.CD_CC
				   UNION ALL
				   SELECT BR.DT_BIZ_RESULT AS DT_SO,
				   		  BR.CD_DEPT AS CD_SALEORG,
				   		  BR.CD_DEPT AS CD_CC,
				   		  ISNULL(BR.AM_BIZ_RESULT, 0) AS AM_SO
				   FROM CZ_SA_BIZ_RESULT BR
				   WHERE BR.CD_COMPANY = @P_CD_COMPANY 
				   AND BR.TP_GUBUN = '001') SH1
		ON SH1.DT_SO = SH.DT_SO_BEFORE AND SH1.CD_SALEORG = SH.CD_SALEORG AND SH1.CD_CC = SH.CD_CC
		GROUP BY SH.DT_SO
		ORDER BY SH.DT_SO
	END
END
ELSE IF @P_TYPE = '001'
BEGIN
	IF @P_CD_COMPANY = 'K100'
	BEGIN
		SELECT (SUBSTRING(SH.DT_SO, 3, 2) + '/' + CONVERT(NVARCHAR, DATEPART(qq, SH.DT_SO + '01')) + 'Q') AS DT_SO,
			   (SUM(CASE WHEN SH.CD_SALEORG = '010300' OR SH.CD_SALEORG = 'SD1' THEN SH.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_SD1,
			   (SUM(CASE WHEN SH.CD_SALEORG = '010400' OR SH.CD_SALEORG = 'SD2' THEN SH.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_SD2,
			   (SUM(CASE WHEN SH.CD_SALEORG = '010600' OR SH.CD_SALEORG = 'TSD' THEN SH.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_TSD,
			   (SUM(CASE WHEN SH.CD_SALEORG IN ('010300', '010400', '010600', 'SD1', 'SD2', 'TSD') THEN SH.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_TOTAL,
			   (SUM(CASE WHEN SH.CD_CC = '010310' THEN SH.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_SD1_1,
			   (SUM(CASE WHEN SH.CD_CC = '010320' THEN SH.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_SD1_2,
			   (SUM(CASE WHEN SH.CD_CC = '010340' THEN SH.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_SD1_3,
			   (SUM(CASE WHEN SH.CD_CC = '010350' THEN SH.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_SD1_T,
			   (SUM(CASE WHEN SH.CD_CC = '010420' OR SH.CD_CC = 'SD2-1' THEN SH.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_SD2_2,
			   (SUM(CASE WHEN SH.CD_CC = '010410' OR SH.CD_CC = 'SD2-2' THEN SH.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_SD2_1,
			   (SUM(CASE WHEN SH.CD_CC = '010430' OR SH.CD_CC = 'SD2-D' THEN SH.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_SD2_D,

			   (SUM(CASE WHEN SH.CD_SALEORG = '010300' OR SH.CD_SALEORG = 'SD1' THEN SH.AM_SO_PLAN ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_PLAN_SD1,
			   (SUM(CASE WHEN SH.CD_SALEORG = '010400' OR SH.CD_SALEORG = 'SD2' THEN SH.AM_SO_PLAN ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_PLAN_SD2,
			   (SUM(CASE WHEN SH.CD_SALEORG = '010600' OR SH.CD_SALEORG = 'TSD' THEN SH.AM_SO_PLAN ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_PLAN_TSD,
			   (SUM(CASE WHEN SH.CD_SALEORG IN ('010300', '010400', '010600', 'SD1', 'SD2', 'TSD') THEN SH.AM_SO_PLAN ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_PLAN_TOTAL,
			   (SUM(CASE WHEN SH.CD_CC = '010310' THEN SH.AM_SO_PLAN ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_PLAN_SD1_1,
			   (SUM(CASE WHEN SH.CD_CC = '010320' THEN SH.AM_SO_PLAN ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_PLAN_SD1_2,
			   (SUM(CASE WHEN SH.CD_CC = '010340' THEN SH.AM_SO_PLAN ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_PLAN_SD1_3,
			   (SUM(CASE WHEN SH.CD_CC = '010350' THEN SH.AM_SO_PLAN ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_PLAN_SD1_T,
			   (SUM(CASE WHEN SH.CD_CC = '010420' OR SH.CD_CC = 'SD2-1' THEN SH.AM_SO_PLAN ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_PLAN_SD2_2,
			   (SUM(CASE WHEN SH.CD_CC = '010410' OR SH.CD_CC = 'SD2-2' THEN SH.AM_SO_PLAN ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_PLAN_SD2_1,
			   (SUM(CASE WHEN SH.CD_CC = '010430' OR SH.CD_CC = 'SD2-D' THEN SH.AM_SO_PLAN ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_PLAN_SD2_D,

			   (SUM(CASE WHEN SH.CD_SALEORG = '010300' OR SH.CD_SALEORG = 'SD1' THEN SH1.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_BEFORE_SD1,
			   (SUM(CASE WHEN SH.CD_SALEORG = '010400' OR SH.CD_SALEORG = 'SD2' THEN SH1.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_BEFORE_SD2,
			   (SUM(CASE WHEN SH.CD_SALEORG = '010600' OR SH.CD_SALEORG = 'TSD' THEN SH1.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_BEFORE_TSD,
			   (SUM(CASE WHEN SH.CD_SALEORG IN ('010300', '010400', '010600', 'SD1', 'SD2', 'TSD') THEN SH1.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_BEFORE_TOTAL,
			   (SUM(CASE WHEN SH.CD_CC = '010310' THEN SH1.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_BEFORE_SD1_1,
			   (SUM(CASE WHEN SH.CD_CC = '010320' THEN SH1.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_BEFORE_SD1_2,
			   (SUM(CASE WHEN SH.CD_CC = '010340' THEN SH1.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_BEFORE_SD1_3,
			   (SUM(CASE WHEN SH.CD_CC = '010350' THEN SH1.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_BEFORE_SD1_T,
			   (SUM(CASE WHEN SH.CD_CC = '010420' OR SH.CD_CC = 'SD2-1' THEN SH1.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_BEFORE_SD2_2,
			   (SUM(CASE WHEN SH.CD_CC = '010410' OR SH.CD_CC = 'SD2-2' THEN SH1.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_BEFORE_SD2_1,
			   (SUM(CASE WHEN SH.CD_CC = '010430' OR SH.CD_CC = 'SD2-D' THEN SH1.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_BEFORE_SD2_D    
		FROM (SELECT LEFT(SH.DT_CONTRACT, 6) AS DT_SO,
					 LEFT(CONVERT(CHAR(8), DATEADD(YY, -1, LEFT(SH.DT_CONTRACT, 6) + '01'), 112), 6) AS DT_SO_BEFORE,
			  		 SG.CD_SALEORG,
					 SG.CD_CC,
			  		 ISNULL(SUM(SL.AM_KR_S), 0) AS AM_SO,
					 ISNULL(MAX((CASE SUBSTRING(SH.DT_CONTRACT, 5, 2) WHEN '01' THEN SP.AM_TOT_JAN
					  												  WHEN '03' THEN SP.AM_TOT_MAR
					  												  WHEN '02' THEN SP.AM_TOT_FEB
					  												  WHEN '04' THEN SP.AM_TOT_APR
					  												  WHEN '05' THEN SP.AM_TOT_MAY
					  												  WHEN '06' THEN SP.AM_TOT_JUN
					  												  WHEN '07' THEN SP.AM_TOT_JUL
					  												  WHEN '08' THEN SP.AM_TOT_AUG
					  												  WHEN '09' THEN SP.AM_TOT_SEP
					  												  WHEN '10' THEN SP.AM_TOT_OCT
					  												  WHEN '11' THEN SP.AM_TOT_NOV
					  												  WHEN '12' THEN SP.AM_TOT_DEC END)), 0) AS AM_SO_PLAN 
			  FROM SA_SOH SH
			  LEFT JOIN MA_SALEGRP SG ON SG.CD_COMPANY = SH.CD_COMPANY AND SG.CD_SALEGRP = SH.CD_SALEGRP
			  LEFT JOIN SA_SOL SL ON SL.CD_COMPANY = SH.CD_COMPANY AND SL.NO_SO = SH.NO_SO
			  LEFT JOIN CZ_SA_PTR_PLAN SP ON SP.CD_COMPANY = SH.CD_COMPANY AND SP.TP_PLAN = '0' AND SP.CD_KEY = SG.CD_CC AND SP.YY_PLAN = LEFT(SH.DT_CONTRACT, 4)
			  WHERE SH.CD_COMPANY = @P_CD_COMPANY
			  AND ISNULL(SH.DT_CONTRACT, '') <> ''
			  AND SH.DT_CONTRACT BETWEEN @P_DT_START AND @P_DT_END
			  AND SH.DT_CONTRACT >= '20160101'
			  AND SG.CD_SALEORG IN ('010300', '010400', '010600')
			  GROUP BY LEFT(SH.DT_CONTRACT, 6), SG.CD_SALEORG, SG.CD_CC
			  UNION ALL
			  SELECT BR.DT_BIZ_RESULT AS DT_SO,
					 LEFT(CONVERT(CHAR(8), DATEADD(YY, -1, LEFT(BR.DT_BIZ_RESULT, 6) + '01'), 112), 6) AS DT_SO_BEFORE,
					 BR.CD_DEPT AS CD_SALEORG,
					 BR.CD_DEPT AS CD_CC,
					 ISNULL(BR.AM_BIZ_RESULT, 0) AS AM_SO,
					 0 AS AM_SO_PLAN
			  FROM CZ_SA_BIZ_RESULT BR
			  WHERE BR.CD_COMPANY = @P_CD_COMPANY
			  AND BR.TP_GUBUN = '001'
			  AND BR.DT_BIZ_RESULT BETWEEN LEFT(@P_DT_START, 6) AND LEFT(@P_DT_END, 6)) SH
		LEFT JOIN (SELECT LEFT(SH.DT_CONTRACT, 6) AS DT_SO,
				   		  SG.CD_SALEORG,
				   	      SG.CD_CC,
				   		  ISNULL(SUM(SL.AM_KR_S), 0) AS AM_SO
				   FROM SA_SOH SH
				   LEFT JOIN MA_SALEGRP SG ON SG.CD_COMPANY = SH.CD_COMPANY AND SG.CD_SALEGRP = SH.CD_SALEGRP
				   LEFT JOIN SA_SOL SL ON SL.CD_COMPANY = SH.CD_COMPANY AND SL.NO_SO = SH.NO_SO
				   WHERE SH.CD_COMPANY = @P_CD_COMPANY 
				   AND ISNULL(SH.DT_CONTRACT, '') <> ''
				   AND SH.DT_CONTRACT >= '20160101'
				   AND SG.CD_SALEORG IN ('010300', '010400', '010600')
				   GROUP BY LEFT(SH.DT_CONTRACT, 6), SG.CD_SALEORG, SG.CD_CC
				   UNION ALL
				   SELECT BR.DT_BIZ_RESULT AS DT_SO,
				   		  BR.CD_DEPT AS CD_SALEORG,
				   		  BR.CD_DEPT AS CD_CC,
				   		  ISNULL(BR.AM_BIZ_RESULT, 0) AS AM_SO
				   FROM CZ_SA_BIZ_RESULT BR
				   WHERE BR.CD_COMPANY = @P_CD_COMPANY 
				   AND BR.TP_GUBUN = '001') SH1
		ON SH1.DT_SO = SH.DT_SO_BEFORE AND SH1.CD_SALEORG = SH.CD_SALEORG AND SH1.CD_CC = SH.CD_CC
		GROUP BY (SUBSTRING(SH.DT_SO, 3, 2) + '/' + CONVERT(NVARCHAR, DATEPART(qq, SH.DT_SO + '01')) + 'Q')
		ORDER BY (SUBSTRING(SH.DT_SO, 3, 2) + '/' + CONVERT(NVARCHAR, DATEPART(qq, SH.DT_SO + '01')) + 'Q')
	END
	ELSE IF @P_CD_COMPANY = 'K200'
	BEGIN
		SELECT (SUBSTRING(SH.DT_SO, 3, 2) + '/' + CONVERT(NVARCHAR, DATEPART(qq, SH.DT_SO + '01')) + 'Q') AS DT_SO,
			   (SUM(CASE WHEN SH.CD_SALEORG IN ('020200', 'SD') THEN SH.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_TOTAL,
			   (SUM(CASE WHEN SH.CD_SALEORG IN ('020200', 'SD') THEN SH.AM_SO_PLAN ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_PLAN_TOTAL,
			   (SUM(CASE WHEN SH.CD_SALEORG IN ('020200', 'SD') THEN SH1.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_BEFORE_TOTAL 
		FROM (SELECT LEFT(SH.DT_CONTRACT, 6) AS DT_SO,
					 LEFT(CONVERT(CHAR(8), DATEADD(YY, -1, LEFT(SH.DT_CONTRACT, 6) + '01'), 112), 6) AS DT_SO_BEFORE,
			  		 SG.CD_SALEORG,
					 SG.CD_CC,
			  		 ISNULL(SUM(SL.AM_KR_S), 0) AS AM_SO,
					 ISNULL(MAX((CASE SUBSTRING(SH.DT_CONTRACT, 5, 2) WHEN '01' THEN SP.AM_TOT_JAN
					  												  WHEN '03' THEN SP.AM_TOT_MAR
					  												  WHEN '02' THEN SP.AM_TOT_FEB
					  												  WHEN '04' THEN SP.AM_TOT_APR
					  												  WHEN '05' THEN SP.AM_TOT_MAY
					  												  WHEN '06' THEN SP.AM_TOT_JUN
					  												  WHEN '07' THEN SP.AM_TOT_JUL
					  												  WHEN '08' THEN SP.AM_TOT_AUG
					  												  WHEN '09' THEN SP.AM_TOT_SEP
					  												  WHEN '10' THEN SP.AM_TOT_OCT
					  												  WHEN '11' THEN SP.AM_TOT_NOV
					  												  WHEN '12' THEN SP.AM_TOT_DEC END)), 0) AS AM_SO_PLAN 
			  FROM SA_SOH SH
			  LEFT JOIN MA_SALEGRP SG ON SG.CD_COMPANY = SH.CD_COMPANY AND SG.CD_SALEGRP = SH.CD_SALEGRP
			  LEFT JOIN SA_SOL SL ON SL.CD_COMPANY = SH.CD_COMPANY AND SL.NO_SO = SH.NO_SO
			  LEFT JOIN CZ_SA_PTR_PLAN SP ON SP.CD_COMPANY = SH.CD_COMPANY AND SP.TP_PLAN = '0' AND SP.CD_KEY = SG.CD_CC AND SP.YY_PLAN = LEFT(SH.DT_CONTRACT, 4)
			  WHERE SH.CD_COMPANY = @P_CD_COMPANY
			  AND ISNULL(SH.DT_CONTRACT, '') <> ''
			  AND SH.DT_CONTRACT BETWEEN @P_DT_START AND @P_DT_END
			  AND SH.DT_CONTRACT >= '20160101'
			  AND SG.CD_SALEORG = '020200'
			  GROUP BY LEFT(SH.DT_CONTRACT, 6), SG.CD_SALEORG, SG.CD_CC
			  UNION ALL
			  SELECT BR.DT_BIZ_RESULT AS DT_SO,
					 LEFT(CONVERT(CHAR(8), DATEADD(YY, -1, LEFT(BR.DT_BIZ_RESULT, 6) + '01'), 112), 6) AS DT_SO_BEFORE,
					 BR.CD_DEPT AS CD_SALEORG,
					 BR.CD_DEPT AS CD_CC,
					 ISNULL(BR.AM_BIZ_RESULT, 0) AS AM_SO,
					 0 AS AM_SO_PLAN
			  FROM CZ_SA_BIZ_RESULT BR
			  WHERE BR.CD_COMPANY = @P_CD_COMPANY
			  AND BR.TP_GUBUN = '001'
			  AND BR.DT_BIZ_RESULT BETWEEN LEFT(@P_DT_START, 6) AND LEFT(@P_DT_END, 6)) SH
		LEFT JOIN (SELECT LEFT(SH.DT_CONTRACT, 6) AS DT_SO,
				   		  SG.CD_SALEORG,
				   	      SG.CD_CC,
				   		  ISNULL(SUM(SL.AM_KR_S), 0) AS AM_SO
				   FROM SA_SOH SH
				   LEFT JOIN MA_SALEGRP SG ON SG.CD_COMPANY = SH.CD_COMPANY AND SG.CD_SALEGRP = SH.CD_SALEGRP
				   LEFT JOIN SA_SOL SL ON SL.CD_COMPANY = SH.CD_COMPANY AND SL.NO_SO = SH.NO_SO
				   WHERE SH.CD_COMPANY = @P_CD_COMPANY 
				   AND ISNULL(SH.DT_CONTRACT, '') <> ''
				   AND SH.DT_CONTRACT >= '20160101'
				   AND SG.CD_SALEORG  = '020200'
				   GROUP BY LEFT(SH.DT_CONTRACT, 6), SG.CD_SALEORG, SG.CD_CC
				   UNION ALL
				   SELECT BR.DT_BIZ_RESULT AS DT_SO,
				   		  BR.CD_DEPT AS CD_SALEORG,
				   		  BR.CD_DEPT AS CD_CC,
				   		  ISNULL(BR.AM_BIZ_RESULT, 0) AS AM_SO
				   FROM CZ_SA_BIZ_RESULT BR
				   WHERE BR.CD_COMPANY = @P_CD_COMPANY 
				   AND BR.TP_GUBUN = '001') SH1
		ON SH1.DT_SO = SH.DT_SO_BEFORE AND SH1.CD_SALEORG = SH.CD_SALEORG AND SH1.CD_CC = SH.CD_CC
		GROUP BY (SUBSTRING(SH.DT_SO, 3, 2) + '/' + CONVERT(NVARCHAR, DATEPART(qq, SH.DT_SO + '01')) + 'Q')
		ORDER BY (SUBSTRING(SH.DT_SO, 3, 2) + '/' + CONVERT(NVARCHAR, DATEPART(qq, SH.DT_SO + '01')) + 'Q')
	END
	ELSE IF @P_CD_COMPANY = 'S100'
	BEGIN
		SELECT (SUBSTRING(SH.DT_SO, 3, 2) + '/' + CONVERT(NVARCHAR, DATEPART(qq, SH.DT_SO + '01')) + 'Q') AS DT_SO,
			   (SUM(CASE WHEN SH.CD_SALEORG IN ('030300', 'SD') THEN SH.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_TOTAL,
			   (SUM(CASE WHEN SH.CD_SALEORG IN ('030300', 'SD') THEN SH.AM_SO_PLAN ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_PLAN_TOTAL,
			   (SUM(CASE WHEN SH.CD_SALEORG IN ('030300', 'SD') THEN SH1.AM_SO ELSE 0 END) / @V_NUM_UNIT) AS AM_SO_BEFORE_TOTAL 
		FROM (SELECT LEFT(SH.DT_CONTRACT, 6) AS DT_SO,
					 LEFT(CONVERT(CHAR(8), DATEADD(YY, -1, LEFT(SH.DT_CONTRACT, 6) + '01'), 112), 6) AS DT_SO_BEFORE,
			  		 SG.CD_SALEORG,
					 SG.CD_CC,
			  		 ISNULL(SUM(SL.AM_KR_S), 0) AS AM_SO,
					 ISNULL(MAX((CASE SUBSTRING(SH.DT_CONTRACT, 5, 2) WHEN '01' THEN SP.AM_TOT_JAN
					  												  WHEN '03' THEN SP.AM_TOT_MAR
					  												  WHEN '02' THEN SP.AM_TOT_FEB
					  												  WHEN '04' THEN SP.AM_TOT_APR
					  												  WHEN '05' THEN SP.AM_TOT_MAY
					  												  WHEN '06' THEN SP.AM_TOT_JUN
					  												  WHEN '07' THEN SP.AM_TOT_JUL
					  												  WHEN '08' THEN SP.AM_TOT_AUG
					  												  WHEN '09' THEN SP.AM_TOT_SEP
					  												  WHEN '10' THEN SP.AM_TOT_OCT
					  												  WHEN '11' THEN SP.AM_TOT_NOV
					  												  WHEN '12' THEN SP.AM_TOT_DEC END)), 0) AS AM_SO_PLAN 
			  FROM SA_SOH SH
			  LEFT JOIN MA_SALEGRP SG ON SG.CD_COMPANY = SH.CD_COMPANY AND SG.CD_SALEGRP = SH.CD_SALEGRP
			  LEFT JOIN SA_SOL SL ON SL.CD_COMPANY = SH.CD_COMPANY AND SL.NO_SO = SH.NO_SO
			  LEFT JOIN CZ_SA_PTR_PLAN SP ON SP.CD_COMPANY = SH.CD_COMPANY AND SP.TP_PLAN = '0' AND SP.CD_KEY = SG.CD_CC AND SP.YY_PLAN = LEFT(SH.DT_CONTRACT, 4)
			  WHERE SH.CD_COMPANY = @P_CD_COMPANY
			  AND ISNULL(SH.DT_CONTRACT, '') <> ''
			  AND SH.DT_CONTRACT BETWEEN @P_DT_START AND @P_DT_END
			  AND SH.DT_CONTRACT >= '20160101'
			  AND SG.CD_SALEORG = '030300'
			  GROUP BY LEFT(SH.DT_CONTRACT, 6), SG.CD_SALEORG, SG.CD_CC
			  UNION ALL
			  SELECT BR.DT_BIZ_RESULT AS DT_SO,
					 LEFT(CONVERT(CHAR(8), DATEADD(YY, -1, LEFT(BR.DT_BIZ_RESULT, 6) + '01'), 112), 6) AS DT_SO_BEFORE,
					 BR.CD_DEPT AS CD_SALEORG,
					 BR.CD_DEPT AS CD_CC,
					 ISNULL(BR.AM_BIZ_RESULT, 0) AS AM_SO,
					 0 AS AM_SO_PLAN
			  FROM CZ_SA_BIZ_RESULT BR
			  WHERE BR.CD_COMPANY = @P_CD_COMPANY
			  AND BR.TP_GUBUN = '001'
			  AND BR.DT_BIZ_RESULT BETWEEN LEFT(@P_DT_START, 6) AND LEFT(@P_DT_END, 6)) SH
		LEFT JOIN (SELECT LEFT(SH.DT_CONTRACT, 6) AS DT_SO,
				   		  SG.CD_SALEORG,
				   	      SG.CD_CC,
				   		  ISNULL(SUM(SL.AM_KR_S), 0) AS AM_SO
				   FROM SA_SOH SH
				   LEFT JOIN MA_SALEGRP SG ON SG.CD_COMPANY = SH.CD_COMPANY AND SG.CD_SALEGRP = SH.CD_SALEGRP
				   LEFT JOIN SA_SOL SL ON SL.CD_COMPANY = SH.CD_COMPANY AND SL.NO_SO = SH.NO_SO
				   WHERE SH.CD_COMPANY = @P_CD_COMPANY 
				   AND ISNULL(SH.DT_CONTRACT, '') <> ''
				   AND SH.DT_CONTRACT >= '20160101'
				   AND SG.CD_SALEORG  = '030300'
				   GROUP BY LEFT(SH.DT_CONTRACT, 6), SG.CD_SALEORG, SG.CD_CC
				   UNION ALL
				   SELECT BR.DT_BIZ_RESULT AS DT_SO,
				   		  BR.CD_DEPT AS CD_SALEORG,
				   		  BR.CD_DEPT AS CD_CC,
				   		  ISNULL(BR.AM_BIZ_RESULT, 0) AS AM_SO
				   FROM CZ_SA_BIZ_RESULT BR
				   WHERE BR.CD_COMPANY = @P_CD_COMPANY 
				   AND BR.TP_GUBUN = '001') SH1
		ON SH1.DT_SO = SH.DT_SO_BEFORE AND SH1.CD_SALEORG = SH.CD_SALEORG AND SH1.CD_CC = SH.CD_CC
		GROUP BY (SUBSTRING(SH.DT_SO, 3, 2) + '/' + CONVERT(NVARCHAR, DATEPART(qq, SH.DT_SO + '01')) + 'Q')
		ORDER BY (SUBSTRING(SH.DT_SO, 3, 2) + '/' + CONVERT(NVARCHAR, DATEPART(qq, SH.DT_SO + '01')) + 'Q')
	END
END
ELSE IF @P_TYPE = '002'
BEGIN
	SELECT (SUBSTRING(IH.DT_PROCESS, 3, 2) + '/' + CONVERT(NVARCHAR, DATEPART(qq, IH.DT_PROCESS)) + 'Q') AS DT_IV,
		   (SUM(IH.AM_K) / @V_NUM_UNIT) AS AM_IV
	FROM SA_IVH IH
	WHERE IH.CD_COMPANY = @P_CD_COMPANY
	AND IH.DT_PROCESS BETWEEN @P_DT_START AND @P_DT_END
	AND IH.DT_PROCESS >= '20160101'
	GROUP BY (SUBSTRING(IH.DT_PROCESS, 3, 2) + '/' + CONVERT(NVARCHAR, DATEPART(qq, IH.DT_PROCESS)) + 'Q')
	UNION ALL
	SELECT (SUBSTRING(BR.DT_BIZ_RESULT, 3, 2) + '/' + SUBSTRING(BR.DT_BIZ_RESULT, 6, 1) + 'Q') AS DT_IV,
		   (SUM(BR.AM_BIZ_RESULT) / @V_NUM_UNIT) AS AM_IV
	FROM CZ_SA_BIZ_RESULT BR
	WHERE BR.CD_COMPANY = @P_CD_COMPANY
	AND BR.DT_BIZ_RESULT BETWEEN LEFT(@P_DT_START, 6) AND LEFT(@P_DT_END, 6)
	AND BR.TP_GUBUN = '002'
	GROUP BY (SUBSTRING(BR.DT_BIZ_RESULT, 3, 2) + '/' + SUBSTRING(BR.DT_BIZ_RESULT, 6, 1) + 'Q')
	ORDER BY (SUBSTRING(IH.DT_PROCESS, 3, 2) + '/' + CONVERT(NVARCHAR, DATEPART(qq, IH.DT_PROCESS)) + 'Q')
END
ELSE IF @P_TYPE = '003'
BEGIN
	SELECT (SUBSTRING(BR.DT_BIZ_RESULT, 3, 2) + '/' + SUBSTRING(BR.DT_BIZ_RESULT, 6, 1) + 'Q') AS DT_ACCT,
		   (SUM(BR.AM_BIZ_RESULT) / @V_NUM_UNIT) AS AM_ACCT
	FROM CZ_SA_BIZ_RESULT BR
	WHERE BR.CD_COMPANY = @P_CD_COMPANY
	AND BR.DT_BIZ_RESULT BETWEEN LEFT(@P_DT_START, 6) AND LEFT(@P_DT_END, 6)
	AND BR.TP_GUBUN = '003'
	AND BR.CD_DEPT = 'OLD'
	GROUP BY (SUBSTRING(BR.DT_BIZ_RESULT, 3, 2) + '/' + SUBSTRING(BR.DT_BIZ_RESULT, 6, 1) + 'Q')
	UNION ALL
	SELECT (SUBSTRING(BR.DT_BIZ_RESULT, 3, 2) + '/' + CONVERT(NVARCHAR, DATEPART(qq, BR.DT_BIZ_RESULT + '01')) + 'Q') AS DT_ACCT,
		   (SUM(BR.AM_BIZ_RESULT) / @V_NUM_UNIT) AS AM_ACCT
	FROM CZ_SA_BIZ_RESULT BR
	WHERE BR.CD_COMPANY = @P_CD_COMPANY
	AND BR.DT_BIZ_RESULT BETWEEN LEFT(@P_DT_START, 6) AND LEFT(@P_DT_END, 6)
	AND BR.DT_BIZ_RESULT >= '20160101'
	AND BR.TP_GUBUN = '003'
	AND BR.CD_DEPT = 'NEW'
	GROUP BY (SUBSTRING(BR.DT_BIZ_RESULT, 3, 2) + '/' + CONVERT(NVARCHAR, DATEPART(qq, BR.DT_BIZ_RESULT + '01')) + 'Q')
	ORDER BY (SUBSTRING(BR.DT_BIZ_RESULT, 3, 2) + '/' + SUBSTRING(BR.DT_BIZ_RESULT, 6, 1) + 'Q')
END
ELSE IF @P_TYPE = '004'
BEGIN
	IF @P_CD_COMPANY = 'K100'
	BEGIN
		SELECT A.DT_SO,
			   SUM(A.AM_SO) AS AM_SO,
			   SUM(A.AM_IV) AS AM_IV,
			   SUM(A.AM_ACCT) AS AM_ACCT
		FROM (SELECT (SUBSTRING(SH.DT_CONTRACT, 3, 2) + '/' + CONVERT(NVARCHAR, DATEPART(qq, SH.DT_CONTRACT)) + 'Q') AS DT_SO,
			  		 (SUM(CASE WHEN SG.CD_SALEORG IN ('010300', '010400', '010600') THEN SL.AM_KR_S ELSE 0 END) / @V_NUM_UNIT) AS AM_SO,
					 0 AS AM_IV,
					 0 AS AM_ACCT
			  FROM SA_SOH SH
			  LEFT JOIN SA_SOL SL ON SL.CD_COMPANY = SH.CD_COMPANY AND SL.NO_SO = SH.NO_SO
			  LEFT JOIN MA_SALEGRP SG ON SG.CD_COMPANY = SH.CD_COMPANY AND SG.CD_SALEGRP = SH.CD_SALEGRP
			  WHERE SH.CD_COMPANY = @P_CD_COMPANY
			  AND ISNULL(SH.DT_CONTRACT, '') <> ''
			  AND SH.DT_CONTRACT BETWEEN @P_DT_START AND @P_DT_END
			  AND SH.DT_CONTRACT >= '20160101'
			  AND SG.CD_SALEORG IN ('010300', '010400', '010600')
			  GROUP BY (SUBSTRING(SH.DT_CONTRACT, 3, 2) + '/' + CONVERT(NVARCHAR, DATEPART(qq, SH.DT_CONTRACT)) + 'Q')
			  UNION ALL
			  SELECT (SUBSTRING(BR.DT_BIZ_RESULT, 3, 2) + '/' + CONVERT(NVARCHAR, DATEPART(qq, BR.DT_BIZ_RESULT + '01')) + 'Q') AS DT_SO,
			  		 (SUM(CASE WHEN BR.CD_DEPT IN ('SD1', 'SD2', 'TSD') THEN BR.AM_BIZ_RESULT ELSE 0 END) / @V_NUM_UNIT) AS AM_SO,
					 0 AS AM_IV,
					 0 AS AM_ACCT
			  FROM CZ_SA_BIZ_RESULT BR
			  WHERE BR.CD_COMPANY = @P_CD_COMPANY
			  AND BR.DT_BIZ_RESULT BETWEEN LEFT(@P_DT_START, 6) AND LEFT(@P_DT_END, 6)
			  AND BR.TP_GUBUN = '001'
			  AND BR.CD_DEPT IN ('SD1', 'SD2', 'TSD')
			  GROUP BY (SUBSTRING(BR.DT_BIZ_RESULT, 3, 2) + '/' + CONVERT(NVARCHAR, DATEPART(qq, BR.DT_BIZ_RESULT + '01')) + 'Q')
			  UNION ALL
			  SELECT (SUBSTRING(IH.DT_PROCESS, 3, 2) + '/' + CONVERT(NVARCHAR, DATEPART(qq, IH.DT_PROCESS)) + 'Q') AS DT_IV,
					 0 AS AM_SO,
			  		 (SUM(IH.AM_K) / @V_NUM_UNIT) AS AM_IV,
					 0 AS AM_ACCT
			  FROM SA_IVH IH
			  WHERE IH.CD_COMPANY = @P_CD_COMPANY
			  AND IH.DT_PROCESS BETWEEN @P_DT_START AND @P_DT_END
			  AND IH.DT_PROCESS >= '20160101'
			  GROUP BY (SUBSTRING(IH.DT_PROCESS, 3, 2) + '/' + CONVERT(NVARCHAR, DATEPART(qq, IH.DT_PROCESS)) + 'Q')
			  UNION ALL
			  SELECT (SUBSTRING(BR.DT_BIZ_RESULT, 3, 2) + '/' + SUBSTRING(BR.DT_BIZ_RESULT, 6, 1) + 'Q') AS DT_IV,
					 0 AS AM_SO,
			  	     (SUM(BR.AM_BIZ_RESULT) / @V_NUM_UNIT) AS AM_IV,
					 0 AS AM_ACCT
			  FROM CZ_SA_BIZ_RESULT BR
			  WHERE BR.CD_COMPANY = @P_CD_COMPANY
			  AND BR.DT_BIZ_RESULT BETWEEN LEFT(@P_DT_START, 6) AND LEFT(@P_DT_END, 6)
			  AND BR.TP_GUBUN = '002'
			  GROUP BY (SUBSTRING(BR.DT_BIZ_RESULT, 3, 2) + '/' + SUBSTRING(BR.DT_BIZ_RESULT, 6, 1) + 'Q')
			  UNION ALL
			  SELECT (SUBSTRING(BR.DT_BIZ_RESULT, 3, 2) + '/' + SUBSTRING(BR.DT_BIZ_RESULT, 6, 1) + 'Q') AS DT_ACCT,
					 0 AS AM_SO,
					 0 AS AM_IV,
			  		 (SUM(BR.AM_BIZ_RESULT) / @V_NUM_UNIT) AS AM_ACCT
			  FROM CZ_SA_BIZ_RESULT BR
			  WHERE BR.CD_COMPANY = @P_CD_COMPANY
			  AND BR.DT_BIZ_RESULT BETWEEN LEFT(@P_DT_START, 6) AND LEFT(@P_DT_END, 6)
			  AND BR.TP_GUBUN = '003'
			  AND BR.CD_DEPT = 'OLD'
			  GROUP BY (SUBSTRING(BR.DT_BIZ_RESULT, 3, 2) + '/' + SUBSTRING(BR.DT_BIZ_RESULT, 6, 1) + 'Q')
			  UNION ALL
			  SELECT (SUBSTRING(BR.DT_BIZ_RESULT, 3, 2) + '/' + CONVERT(NVARCHAR, DATEPART(qq, BR.DT_BIZ_RESULT + '01')) + 'Q') AS DT_ACCT,
					 0 AS AM_SO,
					 0 AS AM_IV,
			  		 (SUM(BR.AM_BIZ_RESULT) / @V_NUM_UNIT) AS AM_ACCT
			  FROM CZ_SA_BIZ_RESULT BR
			  WHERE BR.CD_COMPANY = @P_CD_COMPANY
			  AND BR.DT_BIZ_RESULT BETWEEN LEFT(@P_DT_START, 6) AND LEFT(@P_DT_END, 6)
			  AND BR.DT_BIZ_RESULT >= '20160101'
			  AND BR.TP_GUBUN = '003'
			  AND BR.CD_DEPT = 'NEW'
			  GROUP BY (SUBSTRING(BR.DT_BIZ_RESULT, 3, 2) + '/' + CONVERT(NVARCHAR, DATEPART(qq, BR.DT_BIZ_RESULT + '01')) + 'Q')) A
		GROUP BY A.DT_SO
		ORDER BY A.DT_SO
	END
	ELSE IF @P_CD_COMPANY = 'K200'
	BEGIN
		SELECT A.DT_SO,
			   SUM(A.AM_SO) AS AM_SO,
			   SUM(A.AM_IV) AS AM_IV,
			   SUM(A.AM_ACCT) AS AM_ACCT
		FROM (SELECT (SUBSTRING(SH.DT_CONTRACT, 3, 2) + '/' + CONVERT(NVARCHAR, DATEPART(qq, SH.DT_CONTRACT)) + 'Q') AS DT_SO,
			  		 (SUM(SL.AM_KR_S) / @V_NUM_UNIT) AS AM_SO,
					 0 AS AM_IV,
					 0 AS AM_ACCT
			  FROM SA_SOH SH
			  LEFT JOIN SA_SOL SL ON SL.CD_COMPANY = SH.CD_COMPANY AND SL.NO_SO = SH.NO_SO
			  LEFT JOIN MA_SALEGRP SG ON SG.CD_COMPANY = SH.CD_COMPANY AND SG.CD_SALEGRP = SH.CD_SALEGRP
			  WHERE SH.CD_COMPANY = @P_CD_COMPANY
			  AND ISNULL(SH.DT_CONTRACT, '') <> ''
			  AND SH.DT_CONTRACT BETWEEN @P_DT_START AND @P_DT_END
			  AND SH.DT_CONTRACT >= '20160101'
			  AND SG.CD_SALEORG = '020200'
			  GROUP BY (SUBSTRING(SH.DT_CONTRACT, 3, 2) + '/' + CONVERT(NVARCHAR, DATEPART(qq, SH.DT_CONTRACT)) + 'Q')
			  UNION ALL
			  SELECT (SUBSTRING(BR.DT_BIZ_RESULT, 3, 2) + '/' + CONVERT(NVARCHAR, DATEPART(qq, BR.DT_BIZ_RESULT + '01')) + 'Q') AS DT_SO,
			  		 (SUM(BR.AM_BIZ_RESULT) / @V_NUM_UNIT) AS AM_SO,
					 0 AS AM_IV,
					 0 AS AM_ACCT
			  FROM CZ_SA_BIZ_RESULT BR
			  WHERE BR.CD_COMPANY = @P_CD_COMPANY
			  AND BR.DT_BIZ_RESULT BETWEEN LEFT(@P_DT_START, 6) AND LEFT(@P_DT_END, 6)
			  AND BR.TP_GUBUN = '001'
			  AND BR.CD_DEPT = 'SD'
			  GROUP BY (SUBSTRING(BR.DT_BIZ_RESULT, 3, 2) + '/' + CONVERT(NVARCHAR, DATEPART(qq, BR.DT_BIZ_RESULT + '01')) + 'Q')
			  UNION ALL
			  SELECT (SUBSTRING(IH.DT_PROCESS, 3, 2) + '/' + CONVERT(NVARCHAR, DATEPART(qq, IH.DT_PROCESS)) + 'Q') AS DT_IV,
					 0 AS AM_SO,
			  		 (SUM(IH.AM_K) / @V_NUM_UNIT) AS AM_IV,
					 0 AS AM_ACCT
			  FROM SA_IVH IH
			  WHERE IH.CD_COMPANY = @P_CD_COMPANY
			  AND IH.DT_PROCESS BETWEEN @P_DT_START AND @P_DT_END
			  AND IH.DT_PROCESS >= '20160101'
			  GROUP BY (SUBSTRING(IH.DT_PROCESS, 3, 2) + '/' + CONVERT(NVARCHAR, DATEPART(qq, IH.DT_PROCESS)) + 'Q')
			  UNION ALL
			  SELECT (SUBSTRING(BR.DT_BIZ_RESULT, 3, 2) + '/' + SUBSTRING(BR.DT_BIZ_RESULT, 6, 1) + 'Q') AS DT_IV,
					 0 AS AM_SO,
			  	     (SUM(BR.AM_BIZ_RESULT) / @V_NUM_UNIT) AS AM_IV,
					 0 AS AM_ACCT
			  FROM CZ_SA_BIZ_RESULT BR
			  WHERE BR.CD_COMPANY = @P_CD_COMPANY
			  AND BR.DT_BIZ_RESULT BETWEEN LEFT(@P_DT_START, 6) AND LEFT(@P_DT_END, 6)
			  AND BR.TP_GUBUN = '002'
			  GROUP BY (SUBSTRING(BR.DT_BIZ_RESULT, 3, 2) + '/' + SUBSTRING(BR.DT_BIZ_RESULT, 6, 1) + 'Q')
			  UNION ALL
			  SELECT (SUBSTRING(BR.DT_BIZ_RESULT, 3, 2) + '/' + SUBSTRING(BR.DT_BIZ_RESULT, 6, 1) + 'Q') AS DT_ACCT,
					 0 AS AM_SO,
					 0 AS AM_IV,
			  		 (SUM(BR.AM_BIZ_RESULT) / @V_NUM_UNIT) AS AM_ACCT
			  FROM CZ_SA_BIZ_RESULT BR
			  WHERE BR.CD_COMPANY = @P_CD_COMPANY
			  AND BR.DT_BIZ_RESULT BETWEEN LEFT(@P_DT_START, 6) AND LEFT(@P_DT_END, 6)
			  AND BR.TP_GUBUN = '003'
			  AND BR.CD_DEPT = 'OLD'
			  GROUP BY (SUBSTRING(BR.DT_BIZ_RESULT, 3, 2) + '/' + SUBSTRING(BR.DT_BIZ_RESULT, 6, 1) + 'Q')
			  UNION ALL
			  SELECT (SUBSTRING(BR.DT_BIZ_RESULT, 3, 2) + '/' + CONVERT(NVARCHAR, DATEPART(qq, BR.DT_BIZ_RESULT + '01')) + 'Q') AS DT_ACCT,
					 0 AS AM_SO,
					 0 AS AM_IV,
			  		 (SUM(BR.AM_BIZ_RESULT) / @V_NUM_UNIT) AS AM_ACCT
			  FROM CZ_SA_BIZ_RESULT BR
			  WHERE BR.CD_COMPANY = @P_CD_COMPANY
			  AND BR.DT_BIZ_RESULT BETWEEN LEFT(@P_DT_START, 6) AND LEFT(@P_DT_END, 6)
			  AND BR.DT_BIZ_RESULT >= '20160101'
			  AND BR.TP_GUBUN = '003'
			  AND BR.CD_DEPT = 'NEW'
			  GROUP BY (SUBSTRING(BR.DT_BIZ_RESULT, 3, 2) + '/' + CONVERT(NVARCHAR, DATEPART(qq, BR.DT_BIZ_RESULT + '01')) + 'Q')) A
		GROUP BY A.DT_SO
		ORDER BY A.DT_SO
	END
	ELSE IF @P_CD_COMPANY = 'S100'
	BEGIN
		SELECT A.DT_SO,
			   SUM(A.AM_SO) AS AM_SO,
			   SUM(A.AM_IV) AS AM_IV,
			   SUM(A.AM_ACCT) AS AM_ACCT
		FROM (SELECT (SUBSTRING(SH.DT_CONTRACT, 3, 2) + '/' + CONVERT(NVARCHAR, DATEPART(qq, SH.DT_CONTRACT)) + 'Q') AS DT_SO,
			  		 (SUM(SL.AM_KR_S) / @V_NUM_UNIT) AS AM_SO,
					 0 AS AM_IV,
					 0 AS AM_ACCT
			  FROM SA_SOH SH
			  LEFT JOIN SA_SOL SL ON SL.CD_COMPANY = SH.CD_COMPANY AND SL.NO_SO = SH.NO_SO
			  LEFT JOIN MA_SALEGRP SG ON SG.CD_COMPANY = SH.CD_COMPANY AND SG.CD_SALEGRP = SH.CD_SALEGRP
			  WHERE SH.CD_COMPANY = @P_CD_COMPANY
			  AND ISNULL(SH.DT_CONTRACT, '') <> ''
			  AND SH.DT_CONTRACT BETWEEN @P_DT_START AND @P_DT_END
			  AND SH.DT_CONTRACT >= '20160101'
			  AND SG.CD_SALEORG = '030300'
			  GROUP BY (SUBSTRING(SH.DT_CONTRACT, 3, 2) + '/' + CONVERT(NVARCHAR, DATEPART(qq, SH.DT_CONTRACT)) + 'Q')
			  UNION ALL
			  SELECT (SUBSTRING(BR.DT_BIZ_RESULT, 3, 2) + '/' + CONVERT(NVARCHAR, DATEPART(qq, BR.DT_BIZ_RESULT + '01')) + 'Q') AS DT_SO,
			  		 (SUM(BR.AM_BIZ_RESULT) / @V_NUM_UNIT) AS AM_SO,
					 0 AS AM_IV,
					 0 AS AM_ACCT
			  FROM CZ_SA_BIZ_RESULT BR
			  WHERE BR.CD_COMPANY = @P_CD_COMPANY
			  AND BR.DT_BIZ_RESULT BETWEEN LEFT(@P_DT_START, 6) AND LEFT(@P_DT_END, 6)
			  AND BR.TP_GUBUN = '001'
			  AND BR.CD_DEPT = 'SD'
			  GROUP BY (SUBSTRING(BR.DT_BIZ_RESULT, 3, 2) + '/' + CONVERT(NVARCHAR, DATEPART(qq, BR.DT_BIZ_RESULT + '01')) + 'Q')
			  UNION ALL
			  SELECT (SUBSTRING(IH.DT_PROCESS, 3, 2) + '/' + CONVERT(NVARCHAR, DATEPART(qq, IH.DT_PROCESS)) + 'Q') AS DT_IV,
					 0 AS AM_SO,
			  		 (SUM(IH.AM_K) / @V_NUM_UNIT) AS AM_IV,
					 0 AS AM_ACCT
			  FROM SA_IVH IH
			  WHERE IH.CD_COMPANY = @P_CD_COMPANY
			  AND IH.DT_PROCESS BETWEEN @P_DT_START AND @P_DT_END
			  AND IH.DT_PROCESS >= '20160101'
			  GROUP BY (SUBSTRING(IH.DT_PROCESS, 3, 2) + '/' + CONVERT(NVARCHAR, DATEPART(qq, IH.DT_PROCESS)) + 'Q')
			  UNION ALL
			  SELECT (SUBSTRING(BR.DT_BIZ_RESULT, 3, 2) + '/' + SUBSTRING(BR.DT_BIZ_RESULT, 6, 1) + 'Q') AS DT_IV,
					 0 AS AM_SO,
			  	     (SUM(BR.AM_BIZ_RESULT) / @V_NUM_UNIT) AS AM_IV,
					 0 AS AM_ACCT
			  FROM CZ_SA_BIZ_RESULT BR
			  WHERE BR.CD_COMPANY = @P_CD_COMPANY
			  AND BR.DT_BIZ_RESULT BETWEEN LEFT(@P_DT_START, 6) AND LEFT(@P_DT_END, 6)
			  AND BR.TP_GUBUN = '002'
			  GROUP BY (SUBSTRING(BR.DT_BIZ_RESULT, 3, 2) + '/' + SUBSTRING(BR.DT_BIZ_RESULT, 6, 1) + 'Q')
			  UNION ALL
			  SELECT (SUBSTRING(BR.DT_BIZ_RESULT, 3, 2) + '/' + SUBSTRING(BR.DT_BIZ_RESULT, 6, 1) + 'Q') AS DT_ACCT,
					 0 AS AM_SO,
					 0 AS AM_IV,
			  		 (SUM(BR.AM_BIZ_RESULT) / @V_NUM_UNIT) AS AM_ACCT
			  FROM CZ_SA_BIZ_RESULT BR
			  WHERE BR.CD_COMPANY = @P_CD_COMPANY
			  AND BR.DT_BIZ_RESULT BETWEEN LEFT(@P_DT_START, 6) AND LEFT(@P_DT_END, 6)
			  AND BR.TP_GUBUN = '003'
			  AND BR.CD_DEPT = 'OLD'
			  GROUP BY (SUBSTRING(BR.DT_BIZ_RESULT, 3, 2) + '/' + SUBSTRING(BR.DT_BIZ_RESULT, 6, 1) + 'Q')
			  UNION ALL
			  SELECT (SUBSTRING(BR.DT_BIZ_RESULT, 3, 2) + '/' + CONVERT(NVARCHAR, DATEPART(qq, BR.DT_BIZ_RESULT + '01')) + 'Q') AS DT_ACCT,
					 0 AS AM_SO,
					 0 AS AM_IV,
			  		 (SUM(BR.AM_BIZ_RESULT) / @V_NUM_UNIT) AS AM_ACCT
			  FROM CZ_SA_BIZ_RESULT BR
			  WHERE BR.CD_COMPANY = @P_CD_COMPANY
			  AND BR.DT_BIZ_RESULT BETWEEN LEFT(@P_DT_START, 6) AND LEFT(@P_DT_END, 6)
			  AND BR.DT_BIZ_RESULT >= '20160101'
			  AND BR.TP_GUBUN = '003'
			  AND BR.CD_DEPT = 'NEW'
			  GROUP BY (SUBSTRING(BR.DT_BIZ_RESULT, 3, 2) + '/' + CONVERT(NVARCHAR, DATEPART(qq, BR.DT_BIZ_RESULT + '01')) + 'Q')) A
		GROUP BY A.DT_SO
		ORDER BY A.DT_SO
	END
END

