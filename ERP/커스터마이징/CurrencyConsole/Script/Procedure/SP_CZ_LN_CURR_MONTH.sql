USE [NEOE]
GO

/****** Object:  StoredProcedure [NEOE].[SP_CZ_LN_CURR_MONTH]    Script Date: 2019-06-07 오후 4:50:03 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO




ALTER PROCEDURE [NEOE].[SP_CZ_LN_CURR_MONTH]
(
	@P_MONTH		NVARCHAR(8),
	@P_CURR_BAL		NVARCHAR(50),
	@P_CAPIT_BAL	NVARCHAR(50),
	@P_KOSPI		NVARCHAR(50),
	@P_DOW_JONES	NVARCHAR(50),
	@P_NASDAQ		NVARCHAR(50),
	@P_CUS_PR_K		NVARCHAR(50),
	@P_CUS_PR_US	NVARCHAR(50),
	@P_PROD_PR_K	NVARCHAR(50),
	@P_PROD_PR_US	NVARCHAR(50),
	@P_INDUST_K		NVARCHAR(50),
	@P_INDUST_US	NVARCHAR(50),
	@P_WTI			NVARCHAR(50),
	@P_US_FED_R		NVARCHAR(50)
)
AS

SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED

IF EXISTS (SELECT 1 
		   FROM CZ_LN_CURR_MONTH
		   WHERE MONTH = @P_MONTH)
BEGIN
	UPDATE CZ_LN_CURR_MONTH
	SET CURR_BAL = ISNULL(@P_CURR_BAL, CURR_BAL),
		CAPIT_BAL = ISNULL(@P_CAPIT_BAL, CAPIT_BAL),
		KOSPI = ISNULL(@P_KOSPI, KOSPI),
		DOW_JONES = ISNULL(@P_DOW_JONES, DOW_JONES),
		NASDAQ = ISNULL(@P_NASDAQ, NASDAQ),
	    CUS_PR_K = ISNULL(@P_CUS_PR_K, CUS_PR_K),
		CUS_PR_US = ISNULL(@P_CUS_PR_US, CUS_PR_US),
		PROD_PR_K = ISNULL(@P_PROD_PR_K, PROD_PR_K),
		PROD_PR_US = ISNULL(@P_PROD_PR_US, PROD_PR_US),
		INDUST_K = ISNULL(@P_INDUST_K, INDUST_K),
		INDUST_US = ISNULL(@P_INDUST_US, INDUST_US),
		WTI = ISNULL(@P_WTI, WTI),
	    US_FED_R = ISNULL(@P_US_FED_R, US_FED_R),
		DTS_UPDATE = NEOE.SF_SYSDATE(GETDATE())
	WHERE MONTH = @P_MONTH
END
ELSE
BEGIN
	INSERT INTO CZ_LN_CURR_MONTH
	(
		MONTH,
		CURR_BAL, 
		CAPIT_BAL, 
		KOSPI, 
		DOW_JONES, 
		NASDAQ, 
	    CUS_PR_K, 
		CUS_PR_US, 
		PROD_PR_K, 
		PROD_PR_US, 
		INDUST_K, 
		INDUST_US, 
		WTI, 
	    US_FED_R,
		DTS_INSERT
	)
	VALUES
	(
		@P_MONTH,
		@P_CURR_BAL, 
		@P_CAPIT_BAL, 
		@P_KOSPI, 
		@P_DOW_JONES, 
		@P_NASDAQ, 
	    @P_CUS_PR_K, 
		@P_CUS_PR_US, 
		@P_PROD_PR_K, 
		@P_PROD_PR_US, 
		@P_INDUST_K, 
		@P_INDUST_US, 
		@P_WTI, 
	    @P_US_FED_R,
		NEOE.SF_SYSDATE(GETDATE())
	)
END

GO

