USE [NEOE]
GO

/****** Object:  StoredProcedure [NEOE].[SP_CZ_SA_WEEKLY_RPT_H_S]    Script Date: 2018-11-26 오후 3:09:09 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

ALTER PROCEDURE [NEOE].[SP_CZ_SA_WEEKLY_RPT_H_S]
(
    @P_CD_COMPANY	NVARCHAR(7),
    @P_DT_FROM      NVARCHAR(8),
    @P_DT_TO        NVARCHAR(8),
    @P_CD_CC        NVARCHAR(12),
    @P_NO_EMP       NVARCHAR(10),
    @P_NO_EMP_CURR  NVARCHAR(10),
    @P_YN_TEAM      NVARCHAR(1)
)
AS

SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED

SELECT 'N' AS S,
       MC1.NM_SYSDEF AS NM_ST_STAT,
       RH.NO_EMP,
       ME.NM_KOR AS NM_EMP,
       ME.CD_CC,
       MC.NM_CC,
       RH.DT_YEAR,
       RH.QT_WEEK,
       RH.DT_FROM,
       RH.DT_TO,
       RH.YN_POST,
       RH.YN_CONFIRM
FROM CZ_SA_WEEKLY_RPT_H RH
LEFT JOIN MA_EMP ME ON ME.CD_COMPANY = RH.CD_COMPANY AND ME.NO_EMP = RH.NO_EMP
LEFT JOIN MA_CC MC ON MC.CD_COMPANY = ME.CD_COMPANY AND MC.CD_CC = ME.CD_CC
LEFT JOIN FI_GWDOCU GW ON GW.CD_COMPANY = 'K100' AND GW.CD_PC = '010000' AND GW.NO_DOCU = RH.CD_COMPANY + '_' + ME.CD_CC + '_' + RH.DT_YEAR + '_' + CONVERT(NVARCHAR, RH.QT_WEEK)
LEFT JOIN MA_CODEDTL MC1 ON MC1.CD_COMPANY = GW.CD_COMPANY AND MC1.CD_FIELD = 'PU_C000065' AND MC1.CD_SYSDEF = GW.ST_STAT
WHERE RH.CD_COMPANY = @P_CD_COMPANY
AND LEFT(RH.DTS_INSERT, 8) BETWEEN @P_DT_FROM AND @P_DT_TO
AND (ISNULL(@P_CD_CC, '') = '' OR ME.CD_CC = @P_CD_CC)
AND (ISNULL(@P_NO_EMP, '') = '' OR RH.NO_EMP = @P_NO_EMP)
AND (@P_YN_TEAM = 'N' OR ISNULL(RH.YN_CONFIRM, 'N') = 'Y' OR RH.NO_EMP = @P_NO_EMP_CURR)

GO