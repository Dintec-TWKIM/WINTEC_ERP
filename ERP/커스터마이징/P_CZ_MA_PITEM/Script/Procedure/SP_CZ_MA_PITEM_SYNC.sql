USE [NEOE]
GO

/****** Object:  StoredProcedure [NEOE].[SP_CZ_MA_PITEM_S]    Script Date: 2016-06-27 오후 5:01:58 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

ALTER PROCEDURE [NEOE].[SP_CZ_MA_PITEM_SYNC]
(
	@P_CD_COMPANY			NVARCHAR(7),
	@P_CD_PLANT				NVARCHAR(20),
	@P_CLS_L				NVARCHAR(4),
	@P_CLS_M				NVARCHAR(4),
	@P_CLS_S				NVARCHAR(4),
	@P_CD_TO_COMPANY		NVARCHAR(7),
	@P_CD_TO_PLANT			NVARCHAR(20)
)
AS  

SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED

INSERT INTO MA_PITEM
(
	CD_COMPANY,
	CD_ITEM,
	CD_PLANT,
	NM_ITEM,
	EN_ITEM,
	CLS_ITEM,
	TP_PROC,
	TP_ITEM,
	UNIT_IM,
	UNIT_SO,
	UNIT_PO,
	UNIT_MO,
	GRP_ITEM,
	MAT_ITEM,
	STND_ITEM,
	NO_HS,
	UNIT_HS,
	WEIGHT,
	UNIT_WEIGHT,
	URL_ITEM,
	TP_PART,
	BARCODE,
	DT_VALID,
	NO_DESIGN,
	YN_USE,
	CD_PURGRP,
	CD_SL,
	CD_GISL,
	LT_GI,
	FG_ABC,
	QT_SSTOCK,
	LT_SAFE,
	DY_IMCLY,
	DT_IMMNG,
	QT_ROP,
	FG_BF,
	DY_VALID,
	NO_MODEL,
	FG_GIR,
	CLS_L,
	CLS_M,
	CLS_S,
	TP_MANU,
	YN_PHANTOM,
	TP_BOM,
	FG_LONG,
	QT_MIN,
	QT_MAX,
	RT_QM,
	PARTNER,
	CD_PARTNER1,
	CD_PARTNER2,
	FG_TRACKING,
	RT_MINUS,
	RT_PLUS,
	LT_ITEM,
	TP_PO,
	CLS_PO,
	QT_FOQ,
	FG_FOQ,
	DY_POQ,
	PATN_ROUT,
	FG_LOTNO,
	LOTSIZE,
	FG_SERNO,
	STAND_PRC,
	UPD,
	UPH,
	LT_QC,
	NO_STND,
	FG_PQC,
	FG_SQC,
	FG_OQC,
	CD_BIZAREA,
	UNIT_SO_FACT,
	UNIT_PO_FACT,
	GRP_MFG,
	UNIT_GI,
	UNIT_GI_FACT,
	CD_ZONE,
	FILE_PATH_MNG,
	FG_TAX_PU,
	NO_MANAGER1,
	NO_MANAGER2,
	FG_MODEL,
	FG_TAX_SA,
	FG_IQC,
	STND_DETAIL_ITEM,
	YN_ATP,
	CUR_ATP_DAY,
	NM_MAKER,
	NM_USERDEF1,
	NM_USERDEF2,
	NM_USERDEF3,
	NM_USERDEF4,
	NM_USERDEF5,
	CD_USERDEF1,
	CD_USERDEF2,
	CD_USERDEF3,
	CD_USERDEF4,
	CD_USERDEF5,
	CD_USERDEF6,
	CD_USERDEF7,
	CD_USERDEF8,
	CD_USERDEF9,
	CD_USERDEF10,
	NUM_USERDEF1,
	NUM_USERDEF2,
	NUM_USERDEF3,
	NUM_USERDEF4,
	NUM_USERDEF5,
	NUM_USERDEF6,
	STND_ST,
	DT_STAND_CO,
	IMAGE1,
	IMAGE2,
	IMAGE3,
	IMAGE4,
	IMAGE5,
	IMAGE6,
	DC_IMAGE1,
	DC_IMAGE2,
	DC_IMAGE3,
	DC_IMAGE4,
	DC_IMAGE5,
	DC_IMAGE6,
	FG_OPQC,
	QT_WIDTH,
	QT_LENGTH,
	CD_CORE,
	CD_TP,
	NUM_USERDEF7,
	NUM_USERDEF8,
	NUM_USERDEF9,
	NUM_USERDEF10,
	DC_BOM_RMK,
	CD_USERDEF11,
	CD_USERDEF12,
	CD_USERDEF13,
	CD_USERDEF14,
	CD_USERDEF15,
	CD_USERDEF16,
	CD_USERDEF17,
	FG_SLQC,
	DC_RMK,
	CD_USERDEF18,
	CD_USERDEF19,
	CD_USERDEF20,
	FG_IQCL,
	BOTH_SERLOT,
	DT_ST,
	CD_CC,
	UM_ROYALTY,
	CD_ITEM_RELATION,
	CD_STND_ITEM_1,
	CD_STND_ITEM_2,
	CD_STND_ITEM_3,
	CD_STND_ITEM_4,
	CD_STND_ITEM_5,
	NUM_STND_ITEM_1,
	NUM_STND_ITEM_2,
	NUM_STND_ITEM_3,
	NUM_STND_ITEM_4,
	NUM_STND_ITEM_5,
	CD_USERDEF21,
	CD_USERDEF22,
	UNIT_SU,
	UNIT_SU_FACT,
	CD_ITEM_PARTNER,
	NM_ITEM_PARTNER,
	FG_PQCB,
	NM_ITEM_L1,
	NM_ITEM_L2,
	NM_ITEM_L3,
	NM_ITEM_L4,
	NM_ITEM_L5,
	DC_OFFER,
	DC_RMK1,
	DC_RMK2,
	CD_USERDEF23,
	CD_USERDEF24,
	DC_KEYWORD,
	DC_KEYWORD_WE,
	DC_KEYWORD_CO,
	DC_KEYWORD_EX1,
	DC_KEYWORD_EX2,
	DC_MODEL,
	UCODE2,
	KCODE2,
	YN_MGMT,
	DC_RMK3,
	ID_INSERT,
	DTS_INSERT
)
SELECT @P_CD_TO_COMPANY AS CD_COMPANY,
	   (CASE WHEN @P_CD_COMPANY = 'K100' AND @P_CD_TO_COMPANY = 'K200' AND MI.CD_ITEM LIKE 'DYES%' THEN MI.CD_ITEM + '-DB' ELSE MI.CD_ITEM END) AS CD_ITEM,
	   @P_CD_TO_PLANT AS CD_PLANT,
	   MI.NM_ITEM,
	   MI.EN_ITEM,
	   MI.CLS_ITEM,
	   MI.TP_PROC,
	   MI.TP_ITEM,
	   MI.UNIT_IM,
	   MI.UNIT_SO,
	   MI.UNIT_PO,
	   MI.UNIT_MO,
	   MI.GRP_ITEM,
	   MI.MAT_ITEM,
	   MI.STND_ITEM,
	   MI.NO_HS,
	   MI.UNIT_HS,
	   MI.WEIGHT,
	   MI.UNIT_WEIGHT,
	   MI.URL_ITEM,
	   MI.TP_PART,
	   MI.BARCODE,
	   MI.DT_VALID,
	   MI.NO_DESIGN,
	   MI.YN_USE,
	   MI.CD_PURGRP,
	   MI.CD_SL,
	   MI.CD_GISL,
	   MI.LT_GI,
	   MI.FG_ABC,
	   MI.QT_SSTOCK,
	   MI.LT_SAFE,
	   MI.DY_IMCLY,
	   MI.DT_IMMNG,
	   MI.QT_ROP,
	   MI.FG_BF,
	   MI.DY_VALID,
	   MI.NO_MODEL,
	   MI.FG_GIR,
	   MI.CLS_L,
	   MI.CLS_M,
	   MI.CLS_S,
	   MI.TP_MANU,
	   MI.YN_PHANTOM,
	   MI.TP_BOM,
	   MI.FG_LONG,
	   MI.QT_MIN,
	   MI.QT_MAX,
	   MI.RT_QM,
	   MI.PARTNER,
	   MI.CD_PARTNER1,
	   MI.CD_PARTNER2,
	   MI.FG_TRACKING,
	   MI.RT_MINUS,
	   MI.RT_PLUS,
	   MI.LT_ITEM,
	   MI.TP_PO,
	   MI.CLS_PO,
	   MI.QT_FOQ,
	   MI.FG_FOQ,
	   MI.DY_POQ,
	   MI.PATN_ROUT,
	   MI.FG_LOTNO,
	   MI.LOTSIZE,
	   MI.FG_SERNO,
	   0 AS STAND_PRC, -- 재고평균단가
	   MI.UPD,
	   MI.UPH,
	   MI.LT_QC,
	   MI.NO_STND,
	   MI.FG_PQC,
	   MI.FG_SQC,
	   MI.FG_OQC,
	   MI.CD_BIZAREA,
	   MI.UNIT_SO_FACT,
	   MI.UNIT_PO_FACT,
	   MI.GRP_MFG,
	   MI.UNIT_GI,
	   MI.UNIT_GI_FACT,
	   MI.CD_ZONE,
	   MI.FILE_PATH_MNG,
	   MI.FG_TAX_PU,
	   MI.NO_MANAGER1,
	   MI.NO_MANAGER2,
	   MI.FG_MODEL,
	   MI.FG_TAX_SA,
	   MI.FG_IQC,
	   MI.STND_DETAIL_ITEM,
	   MI.YN_ATP,
	   MI.CUR_ATP_DAY,
	   MI.NM_MAKER,
	   MI.NM_USERDEF1,
	   MI.NM_USERDEF2,
	   MI.NM_USERDEF3,
	   MI.NM_USERDEF4,
	   MI.NM_USERDEF5,
	   MI.CD_USERDEF1,
	   MI.CD_USERDEF2,
	   MI.CD_USERDEF3,
	   MI.CD_USERDEF4,
	   MI.CD_USERDEF5,
	   MI.CD_USERDEF6,
	   MI.CD_USERDEF7,
	   MI.CD_USERDEF8,
	   MI.CD_USERDEF9,
	   MI.CD_USERDEF10,
	   MI.NUM_USERDEF1,
	   MI.NUM_USERDEF2,
	   0 AS NUM_USERDEF3, -- 매입기준단가
	   MI.NUM_USERDEF4,
	   MI.NUM_USERDEF5,
	   MI.NUM_USERDEF6,
	   MI.STND_ST,
	   MI.DT_STAND_CO,
	   MI.IMAGE1,
	   MI.IMAGE2,
	   MI.IMAGE3,
	   MI.IMAGE4,
	   MI.IMAGE5,
	   MI.IMAGE6,
	   MI.DC_IMAGE1,
	   MI.DC_IMAGE2,
	   MI.DC_IMAGE3,
	   MI.DC_IMAGE4,
	   MI.DC_IMAGE5,
	   MI.DC_IMAGE6,
	   MI.FG_OPQC,
	   MI.QT_WIDTH,
	   MI.QT_LENGTH,
	   MI.CD_CORE,
	   MI.CD_TP,
	   MI.NUM_USERDEF7,
	   MI.NUM_USERDEF8,
	   MI.NUM_USERDEF9,
	   MI.NUM_USERDEF10,
	   MI.DC_BOM_RMK,
	   MI.CD_USERDEF11,
	   MI.CD_USERDEF12,
	   MI.CD_USERDEF13,
	   MI.CD_USERDEF14,
	   MI.CD_USERDEF15,
	   MI.CD_USERDEF16,
	   MI.CD_USERDEF17,
	   MI.FG_SLQC,
	   MI.DC_RMK,
	   MI.CD_USERDEF18,
	   MI.CD_USERDEF19,
	   MI.CD_USERDEF20,
	   MI.FG_IQCL,
	   MI.BOTH_SERLOT,
	   MI.DT_ST,
	   MI.CD_CC,
	   MI.UM_ROYALTY,
	   MI.CD_ITEM_RELATION,
	   MI.CD_STND_ITEM_1,
	   MI.CD_STND_ITEM_2,
	   MI.CD_STND_ITEM_3,
	   MI.CD_STND_ITEM_4,
	   MI.CD_STND_ITEM_5,
	   MI.NUM_STND_ITEM_1,
	   MI.NUM_STND_ITEM_2,
	   MI.NUM_STND_ITEM_3,
	   MI.NUM_STND_ITEM_4,
	   MI.NUM_STND_ITEM_5,
	   MI.CD_USERDEF21,
	   MI.CD_USERDEF22,
	   MI.UNIT_SU,
	   MI.UNIT_SU_FACT,
	   MI.CD_ITEM_PARTNER,
	   MI.NM_ITEM_PARTNER,
	   MI.FG_PQCB,
	   MI.NM_ITEM_L1,
	   MI.NM_ITEM_L2,
	   MI.NM_ITEM_L3,
	   MI.NM_ITEM_L4,
	   MI.NM_ITEM_L5,
	   MI.DC_OFFER,
	   MI.DC_RMK1,
	   MI.DC_RMK2,
	   MI.CD_USERDEF23,
	   MI.CD_USERDEF24,
	   MI.DC_KEYWORD,
	   MI.DC_KEYWORD_WE,
	   MI.DC_KEYWORD_CO,
	   MI.DC_KEYWORD_EX1,
	   MI.DC_KEYWORD_EX2,
	   MI.DC_MODEL,
	   MI.UCODE2,
	   MI.KCODE2,
	   MI.YN_MGMT,
	   MI.DC_RMK3,
	   'SYNC',
	   NEOE.SF_SYSDATE(GETDATE())
FROM MA_PITEM MI
WHERE CD_COMPANY = @P_CD_COMPANY
AND CD_PLANT = @P_CD_PLANT
AND CLS_L = @P_CLS_L
AND (ISNULL(@P_CLS_M, '') = '' OR CLS_M = @P_CLS_M)
AND (ISNULL(@P_CLS_S, '') = '' OR CLS_S = @P_CLS_S)
AND NOT EXISTS (SELECT 1 
			    FROM MA_PITEM
				WHERE CD_COMPANY = @P_CD_TO_COMPANY
				AND CD_PLANT = @P_CD_TO_PLANT
				AND CD_ITEM = (CASE WHEN @P_CD_COMPANY = 'K100' AND @P_CD_TO_COMPANY = 'K200' AND MI.CD_ITEM LIKE 'DYES%' THEN MI.CD_ITEM + '-DB' ELSE MI.CD_ITEM END));

MERGE INTO MA_PITEM AS T
USING (SELECT *
	   FROM MA_PITEM
	   WHERE CD_COMPANY = @P_CD_COMPANY
	   AND CD_PLANT = @P_CD_PLANT
	   AND CLS_L = @P_CLS_L
	   AND (ISNULL(@P_CLS_M, '') = '' OR CLS_M = @P_CLS_M)
	   AND (ISNULL(@P_CLS_S, '') = '' OR CLS_S = @P_CLS_S)) AS F
ON T.CD_COMPANY = @P_CD_TO_COMPANY
AND T.CD_PLANT = @P_CD_TO_PLANT
AND T.CD_ITEM = (CASE WHEN @P_CD_COMPANY = 'K100' AND @P_CD_TO_COMPANY = 'K200' AND F.CD_ITEM LIKE 'DYES%' THEN F.CD_ITEM + '-DB' ELSE F.CD_ITEM END)
WHEN MATCHED THEN
UPDATE SET T.NM_ITEM = F.NM_ITEM,
		   T.EN_ITEM = F.EN_ITEM,
		   T.CLS_ITEM = F.CLS_ITEM,
		   T.TP_PROC = F.TP_PROC,
		   T.TP_ITEM = F.TP_ITEM,
		   T.UNIT_IM = F.UNIT_IM,
		   T.UNIT_SO = F.UNIT_SO,
		   T.UNIT_PO = F.UNIT_PO,
		   T.UNIT_MO = F.UNIT_MO,
		   T.GRP_ITEM = F.GRP_ITEM,
		   T.MAT_ITEM = F.MAT_ITEM,
		   T.STND_ITEM = F.STND_ITEM,
		   T.NO_HS = F.NO_HS,
		   T.UNIT_HS = F.UNIT_HS,
		   T.WEIGHT = F.WEIGHT,
		   T.UNIT_WEIGHT = F.UNIT_WEIGHT,
		   T.URL_ITEM = F.URL_ITEM,
		   T.TP_PART = F.TP_PART,
		   T.BARCODE = F.BARCODE,
		   T.DT_VALID = F.DT_VALID,
		   T.NO_DESIGN = F.NO_DESIGN,
		   T.YN_USE = F.YN_USE,
		   T.CD_PURGRP = F.CD_PURGRP,
		   T.CD_SL = F.CD_SL,
		   T.CD_GISL = F.CD_GISL,
		   T.LT_GI = F.LT_GI,
		   T.FG_ABC = F.FG_ABC,
		   T.QT_SSTOCK = F.QT_SSTOCK,
		   T.LT_SAFE = F.LT_SAFE,
		   T.DY_IMCLY = F.DY_IMCLY,
		   T.DT_IMMNG = F.DT_IMMNG,
		   T.QT_ROP = F.QT_ROP,
		   T.FG_BF = F.FG_BF,
		   T.DY_VALID = F.DY_VALID,
		   T.NO_MODEL = F.NO_MODEL,
		   T.FG_GIR = F.FG_GIR,
		   T.CLS_L = F.CLS_L,
		   T.CLS_M = F.CLS_M,
		   T.CLS_S = F.CLS_S,
		   T.TP_MANU = F.TP_MANU,
		   T.YN_PHANTOM = F.YN_PHANTOM,
		   T.TP_BOM = F.TP_BOM,
		   T.FG_LONG = F.FG_LONG,
		   T.QT_MIN = F.QT_MIN,
		   T.QT_MAX = F.QT_MAX,
		   T.RT_QM = F.RT_QM,
		   T.PARTNER = F.PARTNER,
		   T.CD_PARTNER1 = F.CD_PARTNER1,
		   T.CD_PARTNER2 = F.CD_PARTNER2,
		   T.FG_TRACKING = F.FG_TRACKING,
		   T.RT_MINUS = F.RT_MINUS,
		   T.RT_PLUS = F.RT_PLUS,
		   T.LT_ITEM = F.LT_ITEM,
		   T.TP_PO = F.TP_PO,
		   T.CLS_PO = F.CLS_PO,
		   T.QT_FOQ = F.QT_FOQ,
		   T.FG_FOQ = F.FG_FOQ,
		   T.DY_POQ = F.DY_POQ,
		   T.PATN_ROUT = F.PATN_ROUT,
		   T.FG_LOTNO = F.FG_LOTNO,
		   T.LOTSIZE = F.LOTSIZE,
		   T.FG_SERNO = F.FG_SERNO,
		   T.UPD = F.UPD,
		   T.UPH = F.UPH,
		   T.LT_QC = F.LT_QC,
		   T.NO_STND = F.NO_STND,
		   T.FG_PQC = F.FG_PQC,
		   T.FG_SQC = F.FG_SQC,
		   T.FG_OQC = F.FG_OQC,
		   T.CD_BIZAREA = F.CD_BIZAREA,
		   T.UNIT_SO_FACT = F.UNIT_SO_FACT,
		   T.UNIT_PO_FACT = F.UNIT_PO_FACT,
		   T.GRP_MFG = F.GRP_MFG,
		   T.UNIT_GI = F.UNIT_GI,
		   T.UNIT_GI_FACT = F.UNIT_GI_FACT,
		   T.CD_ZONE = F.CD_ZONE,
		   T.FILE_PATH_MNG = F.FILE_PATH_MNG,
		   T.FG_TAX_PU = F.FG_TAX_PU,
		   T.NO_MANAGER1 = F.NO_MANAGER1,
		   T.NO_MANAGER2 = F.NO_MANAGER2,
		   T.FG_MODEL = F.FG_MODEL,
		   T.FG_TAX_SA = F.FG_TAX_SA,
		   T.FG_IQC = F.FG_IQC,
		   T.STND_DETAIL_ITEM = F.STND_DETAIL_ITEM,
		   T.YN_ATP = F.YN_ATP,
		   T.CUR_ATP_DAY = F.CUR_ATP_DAY,
		   T.NM_MAKER = F.NM_MAKER,
		   T.NM_USERDEF1 = F.NM_USERDEF1,
		   T.NM_USERDEF2 = F.NM_USERDEF2,
		   T.NM_USERDEF3 = F.NM_USERDEF3,
		   T.NM_USERDEF4 = F.NM_USERDEF4,
		   T.NM_USERDEF5 = F.NM_USERDEF5,
		   T.CD_USERDEF1 = F.CD_USERDEF1,
		   T.CD_USERDEF2 = F.CD_USERDEF2,
		   T.CD_USERDEF3 = F.CD_USERDEF3,
		   T.CD_USERDEF4 = F.CD_USERDEF4,
		   T.CD_USERDEF5 = F.CD_USERDEF5,
		   T.CD_USERDEF6 = F.CD_USERDEF6,
		   T.CD_USERDEF7 = F.CD_USERDEF7,
		   T.CD_USERDEF8 = F.CD_USERDEF8,
		   T.CD_USERDEF9 = F.CD_USERDEF9,
		   T.CD_USERDEF10 = F.CD_USERDEF10,
		   T.NUM_USERDEF1 = F.NUM_USERDEF1,
		   T.NUM_USERDEF2 = F.NUM_USERDEF2,
		   T.NUM_USERDEF4 = F.NUM_USERDEF4,
		   T.NUM_USERDEF5 = F.NUM_USERDEF5,
		   T.NUM_USERDEF6 = F.NUM_USERDEF6,
		   T.STND_ST = F.STND_ST,
		   T.DT_STAND_CO = F.DT_STAND_CO,
		   T.IMAGE1 = F.IMAGE1,
		   T.IMAGE2 = F.IMAGE2,
		   T.IMAGE3 = F.IMAGE3,
		   T.IMAGE4 = F.IMAGE4,
		   T.IMAGE5 = F.IMAGE5,
		   T.IMAGE6 = F.IMAGE6,
		   T.DC_IMAGE1 = F.DC_IMAGE1,
		   T.DC_IMAGE2 = F.DC_IMAGE2,
		   T.DC_IMAGE3 = F.DC_IMAGE3,
		   T.DC_IMAGE4 = F.DC_IMAGE4,
		   T.DC_IMAGE5 = F.DC_IMAGE5,
		   T.DC_IMAGE6 = F.DC_IMAGE6,
		   T.FG_OPQC = F.FG_OPQC,
		   T.QT_WIDTH = F.QT_WIDTH,
		   T.QT_LENGTH = F.QT_LENGTH,
		   T.CD_CORE = F.CD_CORE,
		   T.CD_TP = F.CD_TP,
		   T.NUM_USERDEF7 = F.NUM_USERDEF7,
		   T.NUM_USERDEF8 = F.NUM_USERDEF8,
		   T.NUM_USERDEF9 = F.NUM_USERDEF9,
		   T.NUM_USERDEF10 = F.NUM_USERDEF10,
		   T.DC_BOM_RMK = F.DC_BOM_RMK,
		   T.CD_USERDEF11 = F.CD_USERDEF11,
		   T.CD_USERDEF12 = F.CD_USERDEF12,
		   T.CD_USERDEF13 = F.CD_USERDEF13,
		   T.CD_USERDEF14 = F.CD_USERDEF14,
		   T.CD_USERDEF15 = F.CD_USERDEF15,
		   T.CD_USERDEF16 = F.CD_USERDEF16,
		   T.CD_USERDEF17 = F.CD_USERDEF17,
		   T.FG_SLQC = F.FG_SLQC,
		   T.DC_RMK = F.DC_RMK,
		   T.CD_USERDEF18 = F.CD_USERDEF18,
		   T.CD_USERDEF19 = F.CD_USERDEF19,
		   T.CD_USERDEF20 = F.CD_USERDEF20,
		   T.FG_IQCL = F.FG_IQCL,
		   T.BOTH_SERLOT = F.BOTH_SERLOT,
		   T.DT_ST = F.DT_ST,
		   T.CD_CC = F.CD_CC,
		   T.UM_ROYALTY = F.UM_ROYALTY,
		   T.CD_ITEM_RELATION = F.CD_ITEM_RELATION,
		   T.CD_STND_ITEM_1 = F.CD_STND_ITEM_1,
		   T.CD_STND_ITEM_2 = F.CD_STND_ITEM_2,
		   T.CD_STND_ITEM_3 = F.CD_STND_ITEM_3,
		   T.CD_STND_ITEM_4 = F.CD_STND_ITEM_4,
		   T.CD_STND_ITEM_5 = F.CD_STND_ITEM_5,
		   T.NUM_STND_ITEM_1 = F.NUM_STND_ITEM_1,
		   T.NUM_STND_ITEM_2 = F.NUM_STND_ITEM_2,
		   T.NUM_STND_ITEM_3 = F.NUM_STND_ITEM_3,
		   T.NUM_STND_ITEM_4 = F.NUM_STND_ITEM_4,
		   T.NUM_STND_ITEM_5 = F.NUM_STND_ITEM_5,
		   T.CD_USERDEF21 = F.CD_USERDEF21,
		   T.CD_USERDEF22 = F.CD_USERDEF22,
		   T.UNIT_SU = F.UNIT_SU,
		   T.UNIT_SU_FACT = F.UNIT_SU_FACT,
		   T.CD_ITEM_PARTNER = F.CD_ITEM_PARTNER,
		   T.NM_ITEM_PARTNER = F.NM_ITEM_PARTNER,
		   T.FG_PQCB = F.FG_PQCB,
		   T.NM_ITEM_L1 = F.NM_ITEM_L1,
		   T.NM_ITEM_L2 = F.NM_ITEM_L2,
		   T.NM_ITEM_L3 = F.NM_ITEM_L3, 
		   T.NM_ITEM_L4 = F.NM_ITEM_L4,
		   T.NM_ITEM_L5 = F.NM_ITEM_L5,
		   T.DC_OFFER = F.DC_OFFER,
		   T.DC_RMK1 = F.DC_RMK1,
		   T.DC_RMK2 = F.DC_RMK2,
		   T.CD_USERDEF23 = F.CD_USERDEF23,
		   T.CD_USERDEF24 = F.CD_USERDEF24,
		   T.DC_KEYWORD = F.DC_KEYWORD,
		   T.DC_KEYWORD_WE = F.DC_KEYWORD_WE,
		   T.DC_KEYWORD_CO = F.DC_KEYWORD_CO,
		   T.DC_KEYWORD_EX1 = F.DC_KEYWORD_EX1,
		   T.DC_KEYWORD_EX2 = F.DC_KEYWORD_EX2,
		   T.DC_MODEL = F.DC_MODEL,
		   T.UCODE2 = F.UCODE2,
		   T.KCODE2 = F.KCODE2,
		   T.YN_MGMT = F.YN_MGMT,
		   T.DC_RMK3 = F.DC_RMK3,
		   T.ID_UPDATE = 'SYNC',
		   T.DTS_UPDATE = NEOE.SF_SYSDATE(GETDATE());

MERGE INTO CZ_MA_PITEM_FILE AS T
	  USING (SELECT @P_CD_TO_COMPANY AS CD_COMPANY,
			 	    (CASE WHEN @P_CD_COMPANY = 'K100' AND @P_CD_TO_COMPANY = 'K200' AND MI.CD_ITEM LIKE 'DYES%' THEN MI.CD_ITEM + '-DB' ELSE MI.CD_ITEM END) AS CD_ITEM,
			 		@P_CD_TO_PLANT AS CD_PLANT,
			 		MF.IMAGE1,
			 		MF.IMAGE2,
			 		MF.IMAGE3,
			 		MF.IMAGE4,
			 		MF.IMAGE5,
			 		MF.IMAGE6,
					MF.IMAGE7,
			 		MF.DC_IMAGE1,
			 		MF.DC_IMAGE2,
			 		MF.DC_IMAGE3,
			 		MF.DC_IMAGE4,
			 		MF.DC_IMAGE5,
			 		MF.DC_IMAGE6,
					MF.DC_IMAGE7
			 FROM MA_PITEM MI
			 JOIN CZ_MA_PITEM_FILE MF ON MF.CD_COMPANY = MI.CD_COMPANY AND MF.CD_PLANT = MI.CD_PLANT AND MF.CD_ITEM = MI.CD_ITEM
			 WHERE MI.CD_COMPANY = @P_CD_COMPANY
			 AND MI.CD_PLANT = @P_CD_PLANT
			 AND MI.CLS_L = @P_CLS_L
			 AND (ISNULL(@P_CLS_M, '') = '' OR MI.CLS_M = @P_CLS_M)
			 AND (ISNULL(@P_CLS_S, '') = '' OR MI.CLS_S = @P_CLS_S)) AS S
	  ON T.CD_COMPANY = S.CD_COMPANY
	  AND T.CD_PLANT = S.CD_PLANT
	  AND T.CD_ITEM = S.CD_ITEM
	  WHEN MATCHED THEN
		UPDATE SET T.IMAGE1 = S.IMAGE1,
				   T.IMAGE2 = S.IMAGE2,
				   T.IMAGE3 = S.IMAGE3,
				   T.IMAGE4 = S.IMAGE4,
				   T.IMAGE5 = S.IMAGE5,
				   T.IMAGE6 = S.IMAGE6,
				   T.IMAGE7 = S.IMAGE7,
				   T.DC_IMAGE1 = S.DC_IMAGE1,
				   T.DC_IMAGE2 = S.DC_IMAGE2,
				   T.DC_IMAGE3 = S.DC_IMAGE3,
				   T.DC_IMAGE4 = S.DC_IMAGE4,
				   T.DC_IMAGE5 = S.DC_IMAGE5,
				   T.DC_IMAGE6 = S.DC_IMAGE6,
				   T.DC_IMAGE7 = S.DC_IMAGE7,
				   T.ID_UPDATE = 'SYNC',
				   T.DTS_UPDATE = NEOE.SF_SYSDATE(GETDATE())
	  WHEN NOT MATCHED THEN
		INSERT (CD_COMPANY,
				CD_PLANT,
				CD_ITEM,
				IMAGE1,
				IMAGE2,
				IMAGE3,
				IMAGE4,
				IMAGE5,
				IMAGE6,
				IMAGE7,
				DC_IMAGE1,
				DC_IMAGE2,
				DC_IMAGE3,
				DC_IMAGE4,
				DC_IMAGE5,
				DC_IMAGE6,
				DC_IMAGE7,
				ID_INSERT,
				DTS_INSERT) 
		VALUES (S.CD_COMPANY,
				S.CD_PLANT,
				S.CD_ITEM,
				S.IMAGE1,
				S.IMAGE2,
				S.IMAGE3,
				S.IMAGE4,
				S.IMAGE5,
				S.IMAGE6,
				S.IMAGE7,
				S.DC_IMAGE1,
				S.DC_IMAGE2,
				S.DC_IMAGE3,
				S.DC_IMAGE4,
				S.DC_IMAGE5,
				S.DC_IMAGE6,
				S.DC_IMAGE7,
				'SYNC',
				NEOE.SF_SYSDATE(GETDATE()));

GO

