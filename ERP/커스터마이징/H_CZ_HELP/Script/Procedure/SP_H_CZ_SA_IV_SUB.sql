USE [NEOE]
GO
/****** Object:  StoredProcedure [NEOE].[SP_CZ_H_SA_IV_SUB]    Script Date: 2015-07-01 오후 5:57:03 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

ALTER PROCEDURE [NEOE].[SP_H_CZ_SA_IV_SUB]
(
	@P_CD_COMPANY       NVARCHAR(7),
	@P_LANGUAGE			NVARCHAR(5) = 'KR',
	@P_NO_IV			NVARCHAR(20)
) 
AS 

SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED

BEGIN
	SELECT IV.NO_IV,
		   IV.DT_PROCESS,
		   IV.FG_TRANS,
		   (SELECT (CASE @P_LANGUAGE WHEN 'KR' THEN NM_SYSDEF
									 WHEN 'US' THEN NM_SYSDEF_E
									 WHEN 'JP' THEN NM_SYSDEF_JP
									 WHEN 'CH' THEN NM_SYSDEF_CH END)
			FROM MA_CODEDTL
			WHERE CD_COMPANY = IV.CD_COMPANY
			AND CD_FIELD = 'PU_C000016'
			AND CD_SYSDEF = IV.FG_TRANS) AS NM_TRANS,
		   IV.CD_EXCH,
		   (SELECT (CASE @P_LANGUAGE WHEN 'KR' THEN NM_SYSDEF
									 WHEN 'US' THEN NM_SYSDEF_E
									 WHEN 'JP' THEN NM_SYSDEF_JP
									 WHEN 'CH' THEN NM_SYSDEF_CH END)
			FROM MA_CODEDTL
			WHERE CD_COMPANY = IV.CD_COMPANY
			AND CD_FIELD = 'MA_B000005'
			AND CD_SYSDEF = IV.CD_EXCH) AS NM_EXCH,
		   IV.CD_PARTNER,
		   MP.LN_PARTNER,
		   IV.BILL_PARTNER AS CD_BILL_PARTNER,
		   MP2.LN_PARTNER AS LN_BILL_PARTNER
	FROM SA_IVH IV
    LEFT JOIN MA_PARTNER MP ON MP.CD_COMPANY = IV.CD_COMPANY AND MP.CD_PARTNER = IV.CD_PARTNER
    LEFT JOIN MA_PARTNER MP2 ON MP2.CD_COMPANY = IV.CD_COMPANY AND MP2.CD_PARTNER = IV.BILL_PARTNER
	WHERE IV.CD_COMPANY = @P_CD_COMPANY
	AND (IV.NO_IV LIKE '%' + @P_NO_IV + '%' OR ISNULL(@P_NO_IV, '') = '') 
END

GO