USE NEOE
GO

/****** Object:  StoredProcedure NEOE.SP_CZ_MA_PARTNER_COPY_I    Script Date: 2016-07-04 오후 4:52:36 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

ALTER PROCEDURE [NEOE].[SP_CZ_MA_PARTNER_COPY_I]
(
	@P_CD_PARTNER		NVARCHAR(20),
	@P_CD_COMPANY_FROM 	NVARCHAR(7),
	@P_CD_COMPANY_TO	NVARCHAR(1000),
	@P_ID_INSERT		NVARCHAR(15)
)
AS
/*******************************************
**  System		: 시스템관리
**  Sub System	: 거래처정보
**  Page		: 거래처 정보 등록 페이지
**  Desc		:다른 회사에 거래처 정보 복사
**  
**  Return Values
**
**  작    성    자 	    : 박태호
**  작    성    일		: 2007.11.08
**  수    정    자		: 
**  수    정    내   용	: 
*********************************************
** Change History
*********************************************
*********************************************/

DECLARE @V_ERRMSG   VARCHAR(255)   -- ERROR 메시지   

BEGIN TRAN SP_CZ_MA_PARTNER_COPY_I
BEGIN TRY

INSERT INTO MA_PARTNER
(
	CD_PARTNER,
	CD_COMPANY,
	LN_PARTNER,
	DT_OPEN,
	AM_CAP,
	MANU_EMP,
	MANA_EMP,
	SD_PARTNER,
	USE_YN,
	LT_TRANS,
	SN_PARTNER,
	EN_PARTNER,
	TP_PARTNER,
	FG_PARTNER,
	NM_CEO,
	NO_COMPANY,
	NO_RES,
	TP_JOB,
	CLS_JOB,
	URL_PARTNER,
	CLS_PARTNER,
	NM_PTR,
	CD_NATION,
	STA_CREDIT,
	E_MAIL,
	NO_TEL,
	NO_FAX,
	NO_POST1,
	DC_ADS1_H,
	DC_ADS1_D,
	NO_TEL1,
	NO_FAX1,
	NO_POST2,
	DC_ADS2_H,
	DC_ADS2_D,
	NO_TEL2,
	NO_FAX2,
	NO_POST3,
	DC_ADS3_H,
	DC_ADS3_D,
	NO_TEL3,
	NO_FAX3,
	ID_INSERT,
	DTS_INSERT,
	FG_CREDIT,
	TP_TAX,
	NO_MERCHANT,
	NO_DEPOSIT,
	CD_BANK,
	ID_COMPANY,
	PW_COMPANY,
	CD_PARTNER_GRP,
	CD_EMP_SALE,
	CD_EMP_PARTNER,
	NO_HPEMP_PARTNER,
	CD_AREA,
	NM_DEPOSIT,
	DT_RCP_PREARRANGED,
	E_MAIL_PARTNER,
	CD_PARTNER_GRP_2,
	FG_BILL,
	CD_AREA_SD,
	DY_CRD,
	FG_TRADE,
	FG_GRD_M,
	FG_GRD_U,
	FG_LIMIT,
	SETTLE,
	CD_WHAN,
	AR_GUBUN,
	DC_RMK,
	AM_CRD_1,
	AM_CRD_2,
	FG_CUST_SD,
	FG_PAYBILL,
	DT_PAY_PREARRANGED,
	CD_CON,
	YN_JEONJATAX,
	DT_CLOSE,
	TP_BUSINESS,
	FG_CON_SELECT,
	ID_CON_SELECT,
	DTS_CON_SELECT,
	CD_PARTDEPT,
	DT_TRADEND,
	NM_ENDRESON,
	NM_NOTE,
	YN_MIS,
	YN_BIZTAX,
	NO_BIZTAX,
	YN_JEONJA,
	TP_DEFER,
	TP_RCP_DD,
	DT_RCP_DD,
	TP_PAY_DD,
	DT_PAY_DD,
	NUM_USERDEF1,
	CHAN_AMT,
	FG_CORP,
	NM_CURE_AGENCY,
	NO_CUER_AGENCY,
	NM_TEXT,
	TP_NATION,
	NM_DCDEPOSIT,
	FG_CORPCODE,
	DT_RCP_PRETOLERANCE,
	CONTRACT,
	NO_COR,
	CD_DEPT,
	CD_CC,
	YN_RMCUSTOMER,
	YN_RMSUPPLIER,
	TP_DT_RCP_PREARRANGED,
	TP_DT_PAY_PREARRANGED,
	TP_PALCOHOLIC,
	GW_INSERT_TIME,
	GW_UPDATE_TIME,
	LN_PARTNER_L1,
	LN_PARTNER_L2,
	LN_PARTNER_L3,
	LN_PARTNER_L4,
	LN_PARTNER_L5,
	SN_PARTNER_L1,
	SN_PARTNER_L2,
	SN_PARTNER_L3,
	SN_PARTNER_L4,
	SN_PARTNER_L5,
	NM_CEO_L1,
	NM_CEO_L2,
	NM_CEO_L3,
	NM_CEO_L4,
	NM_CEO_L5,
	DC_ADS1_H_L1,
	DC_ADS1_H_L2,
	DC_ADS1_H_L3,
	DC_ADS1_H_L4,
	DC_ADS1_H_L5,
	DC_ADS1_D_L1,
	DC_ADS1_D_L2,
	DC_ADS1_D_L3,
	DC_ADS1_D_L4,
	DC_ADS1_D_L5
)
SELECT MP.CD_PARTNER,
	   MC.CD_COMPANY,
	   MP.LN_PARTNER,
	   MP.DT_OPEN,
	   MP.AM_CAP,
	   MP.MANU_EMP,
	   MP.MANA_EMP,
	   MP.SD_PARTNER,
	   MP.USE_YN,
	   MP.LT_TRANS,
	   MP.SN_PARTNER,
	   MP.EN_PARTNER,
	   MP.TP_PARTNER,
	   MP.FG_PARTNER,
	   MP.NM_CEO,
	   MP.NO_COMPANY,
	   MP.NO_RES,
	   MP.TP_JOB,
	   MP.CLS_JOB,
	   MP.URL_PARTNER,
	   MP.CLS_PARTNER,
	   MP.NM_PTR,
	   MP.CD_NATION,
	   MP.STA_CREDIT,
	   MP.E_MAIL,
	   MP.NO_TEL,
	   MP.NO_FAX,
	   MP.NO_POST1,
	   MP.DC_ADS1_H,
	   MP.DC_ADS1_D,
	   MP.NO_TEL1,
	   MP.NO_FAX1,
	   MP.NO_POST2,
	   MP.DC_ADS2_H,
	   MP.DC_ADS2_D,
	   MP.NO_TEL2,
	   MP.NO_FAX2,
	   MP.NO_POST3,
	   MP.DC_ADS3_H,
	   MP.DC_ADS3_D,
	   MP.NO_TEL3,
	   MP.NO_FAX3,
	   @P_ID_INSERT,
	   NEOE.SF_SYSDATE(GETDATE()),
	   MP.FG_CREDIT,
	   MP.TP_TAX,
	   MP.NO_MERCHANT,
	   MP.NO_DEPOSIT,
	   MP.CD_BANK,
	   MP.ID_COMPANY,
	   MP.PW_COMPANY,
	   MP.CD_PARTNER_GRP,
	   MP.CD_EMP_SALE,
	   MP.CD_EMP_PARTNER,
	   MP.NO_HPEMP_PARTNER,
	   MP.CD_AREA,
	   MP.NM_DEPOSIT,
	   MP.DT_RCP_PREARRANGED,
	   MP.E_MAIL_PARTNER,
	   MP.CD_PARTNER_GRP_2,
	   MP.FG_BILL,
	   MP.CD_AREA_SD,
	   MP.DY_CRD,
	   MP.FG_TRADE,
	   MP.FG_GRD_M,
	   MP.FG_GRD_U,
	   MP.FG_LIMIT,
	   MP.SETTLE,
	   MP.CD_WHAN,
	   MP.AR_GUBUN,
	   MP.DC_RMK,
	   MP.AM_CRD_1,
	   MP.AM_CRD_2,
	   MP.FG_CUST_SD,
	   MP.FG_PAYBILL,
	   MP.DT_PAY_PREARRANGED,
	   MP.CD_CON,
	   MP.YN_JEONJATAX,
	   MP.DT_CLOSE,
	   MP.TP_BUSINESS,
	   MP.FG_CON_SELECT,
	   MP.ID_CON_SELECT,
	   MP.DTS_CON_SELECT,
	   MP.CD_PARTDEPT,
	   MP.DT_TRADEND,
	   MP.NM_ENDRESON,
	   MP.NM_NOTE,
	   MP.YN_MIS,
	   MP.YN_BIZTAX,
	   MP.NO_BIZTAX,
	   MP.YN_JEONJA,
	   MP.TP_DEFER,
	   MP.TP_RCP_DD,
	   MP.DT_RCP_DD,
	   MP.TP_PAY_DD,
	   MP.DT_PAY_DD,
	   MP.NUM_USERDEF1,
	   MP.CHAN_AMT,
	   MP.FG_CORP,
	   MP.NM_CURE_AGENCY,
	   MP.NO_CUER_AGENCY,
	   MP.NM_TEXT,
	   MP.TP_NATION,
	   MP.NM_DCDEPOSIT,
	   MP.FG_CORPCODE,
	   MP.DT_RCP_PRETOLERANCE,
	   MP.CONTRACT,
	   MP.NO_COR,
	   MP.CD_DEPT,
	   MP.CD_CC,
	   MP.YN_RMCUSTOMER,
	   MP.YN_RMSUPPLIER,
	   MP.TP_DT_RCP_PREARRANGED,
	   MP.TP_DT_PAY_PREARRANGED,
	   MP.TP_PALCOHOLIC,
	   MP.GW_INSERT_TIME,
	   MP.GW_UPDATE_TIME,
	   MP.LN_PARTNER_L1,
	   MP.LN_PARTNER_L2,
	   MP.LN_PARTNER_L3,
	   MP.LN_PARTNER_L4,
	   MP.LN_PARTNER_L5,
	   MP.SN_PARTNER_L1,
	   MP.SN_PARTNER_L2,
	   MP.SN_PARTNER_L3,
	   MP.SN_PARTNER_L4,
	   MP.SN_PARTNER_L5,
	   MP.NM_CEO_L1,
	   MP.NM_CEO_L2,
	   MP.NM_CEO_L3,
	   MP.NM_CEO_L4,
	   MP.NM_CEO_L5,
	   MP.DC_ADS1_H_L1,
	   MP.DC_ADS1_H_L2,
	   MP.DC_ADS1_H_L3,
	   MP.DC_ADS1_H_L4,
	   MP.DC_ADS1_H_L5,
	   MP.DC_ADS1_D_L1,
	   MP.DC_ADS1_D_L2,
	   MP.DC_ADS1_D_L3,
	   MP.DC_ADS1_D_L4,
	   MP.DC_ADS1_D_L5
FROM MA_PARTNER MP
LEFT JOIN MA_COMPANY MC ON 1=1
WHERE MP.CD_COMPANY = @P_CD_COMPANY_FROM
AND MP.CD_PARTNER = @P_CD_PARTNER
AND (MC.CD_COMPANY <> @P_CD_COMPANY_FROM AND MC.CD_COMPANY IN (SELECT CD_STR FROM GETTABLEFROMSPLIT(@P_CD_COMPANY_TO)))

IF @P_CD_COMPANY_FROM <> 'W100' AND @P_CD_COMPANY_TO LIKE '%W100%'
BEGIN
	UPDATE MA_PARTNER
	SET USE_YN = 'N'
	WHERE CD_COMPANY = 'W100'
	AND CD_PARTNER = @P_CD_PARTNER
END

INSERT INTO CZ_MA_PARTNER
(
	CD_COMPANY,
    CD_PARTNER,
    LN_PARTNER,
    CD_EXCH1,
    TP_SO,
    TP_VAT,
    FG_BILL1,
    FG_BILL2,
    TP_COND_PRICE,
    CD_SALEGRP,
    TXT_USERDEF2,
    TXT_USERDEF3,
    CD_EXCH2,
    AM_EXCH,
    CD_TPPO,
    FG_PAYMENT,
    FG_TAX,
    TP_UM_TAX,
	TP_INQ_PO,
	TP_PO,
    TP_INQ,
    TP_QTN,
    TP_DELIVERY_CONDITION,
    TP_TERMS_PAYMENT,
    RT_COMMISSION,
    DC_COMMISSION,
    RT_SALES_PROFIT,
    RT_SALES_DC,
    RT_PURCHASE_DC,
    DC_PURCHASE_MAIL,
    DC_CEO_E_MAIL,
    CD_PARTNER_RELATION,
	DC_PHOTO,
	YN_CERT,
	CD_ORIGIN,
	TP_PRINT,
	TP_ATTACH_EMAIL,
	YN_USE_GIR,
	YN_GR_LABEL,
	NO_VAT,
	TP_PRICE_SENS,
	SHIPSERV_TNID,
    ID_INSERT,
    DTS_INSERT
)
SELECT MC.CD_COMPANY,
	   MP.CD_PARTNER,
	   MP.LN_PARTNER,
	   MP.CD_EXCH1,
	   MP.TP_SO,
	   MP.TP_VAT,
	   MP.FG_BILL1,
	   MP.FG_BILL2,
	   MP.TP_COND_PRICE,
	   MP.CD_SALEGRP,
	   MP.TXT_USERDEF2,
	   MP.TXT_USERDEF3,
	   MP.CD_EXCH2,
	   MP.AM_EXCH,
	   MP.CD_TPPO,
	   MP.FG_PAYMENT,
	   MP.FG_TAX,
	   MP.TP_UM_TAX,
	   MP.TP_INQ_PO,
	   MP.TP_PO,
	   MP.TP_INQ,
	   MP.TP_QTN,
	   MP.TP_DELIVERY_CONDITION,
	   MP.TP_TERMS_PAYMENT,
	   MP.RT_COMMISSION,
	   MP.DC_COMMISSION,
	   MP.RT_SALES_PROFIT,
	   MP.RT_SALES_DC,
	   MP.RT_PURCHASE_DC,
	   MP.DC_PURCHASE_MAIL,
	   MP.DC_CEO_E_MAIL,
	   MP.CD_PARTNER_RELATION,
	   MP.DC_PHOTO,
	   MP.YN_CERT,
	   MP.CD_ORIGIN,
	   MP.TP_PRINT,
	   MP.TP_ATTACH_EMAIL,
	   MP.YN_USE_GIR,
	   MP.YN_GR_LABEL,
	   MP.NO_VAT,
	   MP.TP_PRICE_SENS,
	   MP.SHIPSERV_TNID,
	   @P_ID_INSERT,
	   NEOE.SF_SYSDATE(GETDATE())
FROM CZ_MA_PARTNER MP
LEFT JOIN MA_COMPANY MC ON 1=1
WHERE MP.CD_COMPANY = @P_CD_COMPANY_FROM
AND MP.CD_PARTNER = @P_CD_PARTNER
AND (MC.CD_COMPANY <> @P_CD_COMPANY_FROM AND MC.CD_COMPANY IN (SELECT CD_STR FROM GETTABLEFROMSPLIT(@P_CD_COMPANY_TO)))

INSERT INTO CZ_SRM_PARTNER
(
	CD_COMPANY,
	CD_PARTNER,
	PASSWORD,
	ID_INSERT,
	DTS_INSERT
)
SELECT MC.CD_COMPANY,
	   MP.CD_PARTNER,
	   '1234',
	   @P_ID_INSERT,
	   NEOE.SF_SYSDATE(GETDATE())
FROM CZ_MA_PARTNER MP
LEFT JOIN MA_COMPANY MC ON 1=1
WHERE MP.CD_COMPANY = @P_CD_COMPANY_FROM
AND MP.CD_PARTNER = @P_CD_PARTNER
AND (MC.CD_COMPANY <> @P_CD_COMPANY_FROM AND MC.CD_COMPANY IN (SELECT CD_STR FROM GETTABLEFROMSPLIT(@P_CD_COMPANY_TO)))

INSERT INTO FI_PARTNERPTR
(
	CD_COMPANY,
    CD_PARTNER,
    SEQ,
	TP_PTR,
    NM_PTR,
    NM_EMAIL,
    NO_HP,
    NO_TEL,
    CLIENT_NOTE,
    ID_INSERT,
    DTS_INSERT,
    USE_YN,
    NO_FAX,
    NM_DEPT,
    NM_DUTY_RESP,
    EN_DUTY_RESP,
    EN_PTR
)
SELECT MC.CD_COMPANY,
	   MP.CD_PARTNER,
	   MP.SEQ,
	   MP.TP_PTR,
	   MP.NM_PTR,
	   MP.NM_EMAIL,
	   MP.NO_HP,
	   MP.NO_TEL,
	   MP.CLIENT_NOTE,
	   @P_ID_INSERT,
	   NEOE.SF_SYSDATE(GETDATE()),
	   MP.USE_YN,
	   MP.NO_FAX,
	   MP.NM_DEPT,
	   MP.NM_DUTY_RESP,
	   MP.EN_DUTY_RESP,
	   MP.EN_PTR
FROM FI_PARTNERPTR MP
LEFT JOIN MA_COMPANY MC ON 1=1
WHERE MP.CD_COMPANY = @P_CD_COMPANY_FROM
AND MP.CD_PARTNER = @P_CD_PARTNER
AND (MC.CD_COMPANY <> @P_CD_COMPANY_FROM AND MC.CD_COMPANY IN (SELECT CD_STR FROM GETTABLEFROMSPLIT(@P_CD_COMPANY_TO)))

--INSERT INTO MA_PARTNER_DEPOSIT
--(
--	CD_COMPANY,
--	CD_PARTNER,
--	NO_DEPOSIT,
--	CD_BANK,
--	USE_YN,
--	NM_DEPOSIT,
--	ID_INSERT,
--	DT_INSERT,
--	ID_UPDATE,
--	DT_UPDATE,
--	HELP_USE,
--	CD_DEPOSIT,
--	CD_DEPOSITNO,
--	DC_RMK,
--	DTS_INSERT,
--	DTS_UPDATE
--)
--SELECT MC.CD_COMPANY,
--	   MP.CD_PARTNER,
--	   MP.NO_DEPOSIT,
--	   MP.CD_BANK,
--	   MP.USE_YN,
--	   MP.NM_DEPOSIT,
--	   @P_ID_INSERT,
--	   NEOE.SF_SYSDATE(GETDATE()),
--	   NULL,
--	   NULL,
--	   MP.HELP_USE,
--	   MP.CD_DEPOSIT,
--	   MP.CD_DEPOSITNO,
--	   MP.DC_RMK,
--	   NEOE.SF_SYSDATE(GETDATE()),
--	   NULL
--FROM MA_PARTNER_DEPOSIT MP
--LEFT JOIN MA_COMPANY MC ON 1=1
--WHERE MP.CD_COMPANY = @P_CD_COMPANY_FROM
--AND MP.CD_PARTNER = @P_CD_PARTNER
--AND (MC.CD_COMPANY <> @P_CD_COMPANY_FROM AND MC.CD_COMPANY IN (SELECT CD_STR FROM GETTABLEFROMSPLIT(@P_CD_COMPANY_TO)))

INSERT INTO CZ_MA_PARTNER_DEPOSIT
(
	CD_COMPANY,
	CD_PARTNER,
	NO_DEPOSIT,
	YN_USE,
	CD_DEPOSIT,
	CD_BANK,
	NM_BANK,
	CD_BANK_NATION,
	NO_SORT,
	NO_SWIFT,
	NM_DEPOSIT,
	DC_DEPOSIT_TEL,
	CD_DEPOSIT_NATION,
	DC_DEPOSIT_ADDRESS,
	NO_BANK_BIC,
	DC_RMK,
	ID_INSERT,
	DTS_INSERT
)
SELECT MC.CD_COMPANY,
	   PD.CD_PARTNER,
	   PD.NO_DEPOSIT,
	   PD.YN_USE,
	   PD.CD_DEPOSIT,
	   PD.CD_BANK,
	   PD.NM_BANK,
	   PD.CD_BANK_NATION,
	   PD.NO_SORT,
	   PD.NO_SWIFT,
	   PD.NM_DEPOSIT,
	   PD.DC_DEPOSIT_TEL,
	   PD.CD_DEPOSIT_NATION,
	   PD.DC_DEPOSIT_ADDRESS,
	   PD.NO_BANK_BIC,
	   PD.DC_RMK,
	   @P_ID_INSERT,
	   NEOE.SF_SYSDATE(GETDATE())
FROM CZ_MA_PARTNER_DEPOSIT PD
LEFT JOIN MA_COMPANY MC ON 1=1
WHERE PD.CD_COMPANY = @P_CD_COMPANY_FROM
AND PD.CD_PARTNER = @P_CD_PARTNER
AND (MC.CD_COMPANY <> @P_CD_COMPANY_FROM AND MC.CD_COMPANY IN (SELECT CD_STR FROM GETTABLEFROMSPLIT(@P_CD_COMPANY_TO)))

INSERT INTO MA_FILEINFO
(
	CD_COMPANY,
    CD_MODULE,
    ID_MENU,
    CD_FILE,
    NO_SEQ,
    FILE_NAME,
    FILE_PATH,
    FILE_EXT,
    FILE_DATE,
    FILE_TIME,
    FILE_SIZE,
    ID_INSERT,
    DTS_INSERT,
    FILE_BYTE,
    DC_RMK,
    FG_FILE
)
SELECT MC.CD_COMPANY,
	   FI.CD_MODULE,
	   FI.ID_MENU,
	   FI.CD_FILE,
	   FI.NO_SEQ,
	   FI.FILE_NAME,
	   FI.FILE_PATH,
	   FI.FILE_EXT,
	   FI.FILE_DATE,
	   FI.FILE_TIME,
	   FI.FILE_SIZE,
	   @P_ID_INSERT,
	   GETDATE(),
	   FI.FILE_BYTE,
	   FI.DC_RMK,
	   FI.FG_FILE
FROM MA_FILEINFO FI
LEFT JOIN MA_COMPANY MC ON 1=1
WHERE FI.CD_COMPANY = @P_CD_COMPANY_FROM
AND FI.CD_MODULE = 'MA'
AND FI.ID_MENU = 'P_CZ_MA_PARTNER'
AND FI.CD_FILE = @P_CD_PARTNER
AND (MC.CD_COMPANY <> @P_CD_COMPANY_FROM AND MC.CD_COMPANY IN (SELECT CD_STR FROM GETTABLEFROMSPLIT(@P_CD_COMPANY_TO)))

COMMIT TRAN SP_CZ_MA_PARTNER_COPY_I

END TRY
BEGIN CATCH
	SELECT @V_ERRMSG = ERROR_MESSAGE()
	GOTO ERROR
END CATCH

RETURN
ERROR: 
RAISERROR(@V_ERRMSG, 16, 1)
ROLLBACK TRAN SP_CZ_MA_PARTNER_COPY_I

GO