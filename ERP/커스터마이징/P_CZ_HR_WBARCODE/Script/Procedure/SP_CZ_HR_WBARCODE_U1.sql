USE [NEOE]
GO

/****** Object:  StoredProcedure [NEOE].[SP_CZ_HR_WBARCODE_U1]    Script Date: 2020-03-12 오후 2:33:40 ******/
SET ANSI_NULLS OFF
GO

SET QUOTED_IDENTIFIER OFF
GO


ALTER PROCEDURE [NEOE].[SP_CZ_HR_WBARCODE_U1]
(
	@P_CD_COMPANY  	NVARCHAR(7),
	@P_NO_CARD  	NVARCHAR(40),
	@P_DT_WORK  	NVARCHAR(8),
	@P_TM_001		NVARCHAR(6) = '',
	@P_TM_002		NVARCHAR(6) = '',
	@P_TM_003		NVARCHAR(6) = '',
	@P_TM_004		NVARCHAR(6) = '',
	@P_TM_001_OLD	NVARCHAR(6) = '',
	@P_TM_002_OLD	NVARCHAR(6) = '',
	@P_TM_003_OLD	NVARCHAR(6) = '',
	@P_TM_004_OLD	NVARCHAR(6) = '',
	@P_ID_UPDATE  	NVARCHAR(15)
)
AS

IF @P_TM_001 <> @P_TM_001_OLD
BEGIN
	IF EXISTS (SELECT 1 
		       FROM CZ_HR_WBARCODE BC
		       WHERE BC.CD_COMPANY = @P_CD_COMPANY
		       AND BC.NO_CARD = @P_NO_CARD
		       AND BC.DT_WORK = @P_DT_WORK
			   AND BC.CD_WCODE = '001')
	BEGIN
		UPDATE CZ_HR_WBARCODE  
		SET	TM_CARD	= @P_TM_001,
			ID_UPDATE = @P_ID_UPDATE,
			DTS_UPDATE = NEOE.SF_SYSDATE(GETDATE())
		WHERE CD_COMPANY = @P_CD_COMPANY   	
		AND	NO_CARD = @P_NO_CARD   	
		AND	DT_WORK = @P_DT_WORK   	
		AND	CD_WCODE = '001'
	END
	ELSE
	BEGIN
		INSERT INTO CZ_HR_WBARCODE
		(
			CD_COMPANY,
			NO_CARD,
			DT_WORK,
			TM_CARD,
			CD_WCODE,
			ID_INSERT,
			DTS_INSERT
		)
		VALUES
		(
			@P_CD_COMPANY,
			@P_NO_CARD,
			@P_DT_WORK,
			@P_TM_001,
			'001',
			@P_ID_UPDATE,
			NEOE.SF_SYSDATE(GETDATE())
		)
	END
END

IF @P_TM_002 <> @P_TM_002_OLD
BEGIN
	IF EXISTS (SELECT 1 
		       FROM CZ_HR_WBARCODE BC
		       WHERE BC.CD_COMPANY = @P_CD_COMPANY
		       AND BC.NO_CARD = @P_NO_CARD
		       AND BC.DT_WORK = @P_DT_WORK
			   AND BC.CD_WCODE = '002')
	BEGIN
		UPDATE CZ_HR_WBARCODE  
		SET	TM_CARD	= @P_TM_002,
			ID_UPDATE = @P_ID_UPDATE,
			DTS_UPDATE = NEOE.SF_SYSDATE(GETDATE())
		WHERE CD_COMPANY = @P_CD_COMPANY   	
		AND	NO_CARD = @P_NO_CARD   	
		AND	DT_WORK = @P_DT_WORK   	
		AND	CD_WCODE = '002'
	END
	ELSE
	BEGIN
		INSERT INTO CZ_HR_WBARCODE
		(
			CD_COMPANY,
			NO_CARD,
			DT_WORK,
			TM_CARD,
			CD_WCODE,
			ID_INSERT,
			DTS_INSERT
		)
		VALUES
		(
			@P_CD_COMPANY,
			@P_NO_CARD,
			@P_DT_WORK,
			@P_TM_002,
			'002',
			@P_ID_UPDATE,
			NEOE.SF_SYSDATE(GETDATE())
		)
	END
END

IF @P_TM_003 <> @P_TM_003_OLD
BEGIN
	IF EXISTS (SELECT 1 
		       FROM CZ_HR_WBARCODE BC
		       WHERE BC.CD_COMPANY = @P_CD_COMPANY
		       AND BC.NO_CARD = @P_NO_CARD
		       AND BC.DT_WORK = @P_DT_WORK
			   AND BC.CD_WCODE = '003')
	BEGIN
		UPDATE CZ_HR_WBARCODE  
		SET	TM_CARD	= @P_TM_003,
			ID_UPDATE = @P_ID_UPDATE,
			DTS_UPDATE = NEOE.SF_SYSDATE(GETDATE())
		WHERE CD_COMPANY = @P_CD_COMPANY   	
		AND	NO_CARD = @P_NO_CARD   	
		AND	DT_WORK = @P_DT_WORK   	
		AND	CD_WCODE = '003'
	END
	ELSE
	BEGIN
		INSERT INTO CZ_HR_WBARCODE
		(
			CD_COMPANY,
			NO_CARD,
			DT_WORK,
			TM_CARD,
			CD_WCODE,
			ID_INSERT,
			DTS_INSERT
		)
		VALUES
		(
			@P_CD_COMPANY,
			@P_NO_CARD,
			@P_DT_WORK,
			@P_TM_003,
			'003',
			@P_ID_UPDATE,
			NEOE.SF_SYSDATE(GETDATE())
		)
	END
END

IF @P_TM_004 <> @P_TM_004_OLD
BEGIN
	IF EXISTS (SELECT 1 
		       FROM CZ_HR_WBARCODE BC
		       WHERE BC.CD_COMPANY = @P_CD_COMPANY
		       AND BC.NO_CARD = @P_NO_CARD
		       AND BC.DT_WORK = @P_DT_WORK
			   AND BC.CD_WCODE = '004')
	BEGIN
		UPDATE CZ_HR_WBARCODE  
		SET	TM_CARD	= @P_TM_004,
			ID_UPDATE = @P_ID_UPDATE,
			DTS_UPDATE = NEOE.SF_SYSDATE(GETDATE())
		WHERE CD_COMPANY = @P_CD_COMPANY   	
		AND	NO_CARD = @P_NO_CARD   	
		AND	DT_WORK = @P_DT_WORK   	
		AND	CD_WCODE = '004'
	END
	ELSE
	BEGIN
		INSERT INTO CZ_HR_WBARCODE
		(
			CD_COMPANY,
			NO_CARD,
			DT_WORK,
			TM_CARD,
			CD_WCODE,
			ID_INSERT,
			DTS_INSERT
		)
		VALUES
		(
			@P_CD_COMPANY,
			@P_NO_CARD,
			@P_DT_WORK,
			@P_TM_004,
			'004',
			@P_ID_UPDATE,
			NEOE.SF_SYSDATE(GETDATE())
		)
	END
END

GO