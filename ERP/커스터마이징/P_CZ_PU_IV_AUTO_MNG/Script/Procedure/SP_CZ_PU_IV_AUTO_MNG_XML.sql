USE [NEOE]
GO

/****** Object:  StoredProcedure [NEOE].[SP_CZ_PU_IV_AUTO_MNG_XML]    Script Date: 2015-10-26 오후 7:48:35 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO



ALTER PROCEDURE [NEOE].[SP_CZ_PU_IV_AUTO_MNG_XML] 
(
	@P_XML			XML, 
	@P_ID_USER		NVARCHAR(10), 
    @DOC			INT = NULL
) 
AS 

SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED

EXEC SP_XML_PREPAREDOCUMENT @DOC OUTPUT, @P_XML 

-- ================================================== UPDATE    
UPDATE A 
   SET A.NO_FILE_SEND = B.NO_FILE_SEND, 
	   A.ID_UPDATE = @P_ID_USER, 
	   A.DTS_UPDATE = NEOE.SF_SYSDATE(GETDATE())
  FROM CZ_PU_ETAXH A 
  JOIN OPENXML (@DOC, '/XML/U', 2) 
          WITH (CD_COMPANY	 NVARCHAR(7),
			    NO_ETAX		 NVARCHAR(30),
			    NO_FILE_SEND NVARCHAR(4000)) B 
  ON A.CD_COMPANY = B.CD_COMPANY
  AND A.NO_ETAX = B.NO_ETAX

EXEC SP_XML_REMOVEDOCUMENT @DOC 

GO