USE [NEOE]
GO

/****** Object:  StoredProcedure [NEOE].[SP_CZ_MA_EXCHANGE_U]    Script Date: 2015-06-18 오후 1:52:41 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO


ALTER PROCEDURE [NEOE].[SP_CZ_MA_EXCHANGE_U]
(
	@P_CD_COMPANY		NVARCHAR(7), 
	@P_YYMMDD			NVARCHAR(8),
	@P_NO_SEQ			NUMERIC(2, 0),
	@P_QUOTATION_TIME	NVARCHAR(6),
	@P_CURR_SOUR		NVARCHAR(3), 
	@P_CURR_DEST		NVARCHAR(3), 
	@P_RATE_BASE		NUMERIC(11,4), 
	@P_RATE_SALE		NUMERIC(11,4), 
	@P_RATE_BUY			NUMERIC(11,4), 
	@P_RATE_PURCHASE	NUMERIC(11,4),
	@P_RATE_SALES		NUMERIC(11,4),
	@P_ID_UPDATE		NVARCHAR(15)
) AS

SET NOCOUNT ON

IF NOT EXISTS(SELECT 1 FROM	MA_EXCHANGE 
			  WHERE CD_COMPANY = @P_CD_COMPANY 
				AND YYMMDD = @P_YYMMDD 
				AND NO_SEQ = @P_NO_SEQ 
				AND CURR_SOUR = @P_CURR_SOUR 
				AND CURR_DEST = @P_CURR_DEST)
BEGIN
	INSERT INTO MA_EXCHANGE
	(
		CD_COMPANY, YYMMDD, NO_SEQ, QUOTATION_TIME, CURR_SOUR, CURR_DEST,
		RATE_BASE, RATE_SALE, RATE_BUY, ID_INSERT, DTS_INSERT
	)
	VALUES
	(
		@P_CD_COMPANY, @P_YYMMDD, @P_NO_SEQ, @P_QUOTATION_TIME, @P_CURR_SOUR, @P_CURR_DEST,
		@P_RATE_BASE, @P_RATE_SALE, @P_RATE_BUY, @P_ID_UPDATE, NEOE.SF_SYSDATE(GETDATE())
	)
END
ELSE
BEGIN
	UPDATE MA_EXCHANGE 
	SET	YYMMDD = @P_YYMMDD,
		NO_SEQ = @P_NO_SEQ,
		QUOTATION_TIME = @P_QUOTATION_TIME,
		CURR_SOUR = @P_CURR_SOUR, 
		CURR_DEST = @P_CURR_DEST, 
		RATE_BASE = @P_RATE_BASE, 
		RATE_SALE = @P_RATE_SALE, 
		RATE_BUY = @P_RATE_BUY, 
		ID_UPDATE = @P_ID_UPDATE, 
		DTS_UPDATE = NEOE.SF_SYSDATE(GETDATE())
	WHERE CD_COMPANY = @P_CD_COMPANY	
	AND	YYMMDD = @P_YYMMDD	
	AND	NO_SEQ = @P_NO_SEQ
	AND	CURR_SOUR = @P_CURR_SOUR	
	AND	CURR_DEST = @P_CURR_DEST
END

IF NOT EXISTS(SELECT 1 FROM CZ_MA_EXCHANGE 
			   WHERE CD_COMPANY = @P_CD_COMPANY 
			    AND YYMMDD = @P_YYMMDD 
			    AND NO_SEQ = @P_NO_SEQ 
			    AND CURR_SOUR = @P_CURR_SOUR 
			    AND CURR_DEST = @P_CURR_DEST)
BEGIN
	INSERT INTO CZ_MA_EXCHANGE
	(
		CD_COMPANY, YYMMDD, NO_SEQ, CURR_SOUR, CURR_DEST,
		RATE_PURCHASE, RATE_SALES, ID_INSERT, DTS_INSERT
	)
	VALUES
	(
		@P_CD_COMPANY, @P_YYMMDD, @P_NO_SEQ, @P_CURR_SOUR, @P_CURR_DEST,
		@P_RATE_PURCHASE, @P_RATE_SALES, @P_ID_UPDATE, NEOE.SF_SYSDATE(GETDATE())
	)
END
ELSE
BEGIN
	UPDATE CZ_MA_EXCHANGE 
	SET	YYMMDD = @P_YYMMDD,
		NO_SEQ = @P_NO_SEQ,
		CURR_SOUR = @P_CURR_SOUR, 
		CURR_DEST = @P_CURR_DEST, 
		RATE_PURCHASE = @P_RATE_PURCHASE, 
		RATE_SALES = @P_RATE_SALES, 
		ID_UPDATE = @P_ID_UPDATE, 
		DTS_UPDATE = NEOE.SF_SYSDATE(GETDATE())
	WHERE CD_COMPANY = @P_CD_COMPANY	
	AND	YYMMDD = @P_YYMMDD	
	AND	NO_SEQ = @P_NO_SEQ
	AND	CURR_SOUR = @P_CURR_SOUR	
	AND	CURR_DEST = @P_CURR_DEST
END
		
SET NOCOUNT OFF
GO

