USE [NEOE]
GO

/****** Object:  StoredProcedure [NEOE].[SP_CZ_SA_CUST_REL_MNG_PIC_COMMENT_S]    Script Date: 2017-06-08 오후 7:52:31 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO




ALTER PROCEDURE [NEOE].[SP_CZ_SA_BUSINESS_TRIP_S]
(
	@P_CD_COMPANY	NVARCHAR(7),
	@P_DT_START		NVARCHAR(8),
	@P_DT_END		NVARCHAR(8),
	@P_ID_INSERT	NVARCHAR(15)
) 
AS
 
SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED

SELECT BT.CD_COMPANY,
	   GW.ST_STAT AS CD_GW_STAT,
	   MC.NM_SYSDEF AS NM_GW_STAT,
	   GW.APP_DOC_ID AS ID_GW_DOCU,
	   BT.NO_BIZ_TRIP,
	   BT.DT_START,
	   BT.DT_END,
	   BT.DC_DATE,
	   BT.DC_LOCATION,
	   BT.DC_PURPOSE,
	   BT.DC_START,
	   BT.DC_END,
	   GW.ID_WRITE,
	   BT.ID_INSERT,
	   MU.NM_USER AS NM_INSERT
FROM CZ_SA_BUSINESS_TRIP BT
LEFT JOIN FI_GWDOCU GW ON GW.CD_COMPANY = 'K100' AND GW.CD_PC = '010000' AND GW.NO_DOCU = BT.CD_COMPANY + '-' + BT.NO_BIZ_TRIP
LEFT JOIN MA_CODEDTL MC ON MC.CD_COMPANY = GW.CD_COMPANY AND MC.CD_FIELD = 'PU_C000065' AND MC.CD_SYSDEF = GW.ST_STAT
LEFT JOIN MA_USER MU ON MU.CD_COMPANY = BT.CD_COMPANY AND MU.ID_USER = BT.ID_INSERT
WHERE BT.CD_COMPANY = @P_CD_COMPANY
AND ((BT.DT_START BETWEEN @P_DT_START AND @P_DT_END) OR (BT.DT_END BETWEEN @P_DT_START AND @P_DT_END))
AND (ISNULL(@P_ID_INSERT, '') = '' OR BT.ID_INSERT = @P_ID_INSERT)

GO