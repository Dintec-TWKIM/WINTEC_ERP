USE [NEOE]
GO

/****** Object:  Trigger [NEOE].[TI_CZ_MA_PITEM_LOG]    Script Date: 2021-02-25 오후 1:42:30 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO


ALTER TRIGGER [NEOE].[TI_CZ_MA_PITEM_LOG] ON [NEOE].[MA_PITEM_LOG] 
INSTEAD OF INSERT
AS 

BEGIN
	SELECT * INTO #MA_PITEM_LOG 
	FROM INSERTED I

	UPDATE I
	SET I.DTS_MODIFY = CONVERT(NVARCHAR(14), ISNULL(CONVERT(BIGINT, A.DTS_MODIFY) + 1, I.DTS_MODIFY))
	FROM #MA_PITEM_LOG I
	LEFT JOIN (SELECT CD_COMPANY, CD_PLANT, CD_ITEM,
					  MAX(DTS_MODIFY) AS DTS_MODIFY 
		       FROM MA_PITEM_LOG
		       GROUP BY CD_COMPANY, CD_PLANT, CD_ITEM) A
	ON A.CD_COMPANY = I.CD_COMPANY AND A.CD_PLANT = I.CD_PLANT AND A.CD_ITEM = I.CD_ITEM

	INSERT INTO MA_PITEM_LOG
	SELECT *
	FROM #MA_PITEM_LOG

	DROP TABLE #MA_PITEM_LOG
END

GO

