USE [NEOE]
GO

/****** Object:  StoredProcedure [NEOE].[SP_CZ_SA_VSSL_ETRYNDH1]    Script Date: 2018-11-26 오후 3:09:09 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO



ALTER PROCEDURE [NEOE].[SP_CZ_SA_VSSL_ETRYNDH1]
(
    @P_CD_PRTAG		NVARCHAR(500),
	@P_DT_START		NVARCHAR(8),
	@P_DT_END		NVARCHAR(8),
	@P_NO_IMO		NVARCHAR(1000),
	@P_NM_VSSL		NVARCHAR(20),
	@P_CALL_SIGN	NVARCHAR(20)
)
AS

SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED

SELECT VH.CD_PRTAG, 
	   VH.NM_PRTAG, 
	   VH.DT_ETRYPT_YEAR, 
	   VH.CNT_ETRYPT, 
	   VH.CLSGN, 
	   VH.NM_VSSL,
	   VH.CD_VSSL_NLTY, 
	   VH.NM_VSSL_NLTY, 
	   VH.NM_VSSL_KND, 
	   VH.CD_ETRYPT_PURPS, 
	   VH.NM_ETRYPT_PURPS, 
       VH.CD_FRST_DPMPRT_NAT_PRT, 
	   VH.NM_FRST_DPMPRT_PRT, 
	   VH.CD_PRVS_DPMPRT_NAT_PRT, 
	   VH.NM_PRVS_DPMPRT_PRT, 
	   VH.CD_NX_INPT_NAT_PRT, 
	   VH.NM_NX_INPT_PRT,
	   VH.CD_DSTN_NAT_PRT, 
       VH.NM_DSTN_PRT,
	   VH.DTS_ETRYPT,
	   VH.DTS_TKOFF
FROM CZ_SA_VSSL_ETRYNDH VH
WHERE (VH.DTS_ETRYPT BETWEEN @P_DT_START + '000000' AND @P_DT_END + '999999')
AND (ISNULL(@P_NM_VSSL, '') = '' OR VH.NM_VSSL LIKE @P_NM_VSSL + '%')
AND (ISNULL(@P_CALL_SIGN, '') = '' OR VH.CALL_SIGN = @P_CALL_SIGN)
AND (ISNULL(@P_CD_PRTAG, '') = '' OR VH.CD_PRTAG IN (SELECT CD_STR FROM GETTABLEFROMSPLIT(@P_CD_PRTAG)))
AND (ISNULL(@P_NO_IMO, '') = '' OR VH.CALL_SIGN IN (SELECT MH.CALL_SIGN 
													FROM GETTABLEFROMSPLIT(@P_NO_IMO)
													JOIN CZ_MA_HULL MH ON MH.NO_IMO = CD_STR))
ORDER BY VH.DTS_ETRYPT DESC


GO

