USE [NEOE]
GO

/****** Object:  StoredProcedure [NEOE].[SP_CZ_SA_LOG_PLAN_MNG_REV_COPY]    Script Date: 2016-02-12 오후 1:40:06 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

ALTER PROCEDURE [NEOE].[SP_CZ_SA_LOG_PLAN_MNG_REV_COPY]  
(
    @P_CD_COMPANY       NVARCHAR(7),
	@P_NO_REV			INT,
	@P_ID_USER			NVARCHAR(15)
)
AS

SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED

DECLARE @V_NO_REV	INT
DECLARE @V_DT_WORK	NVARCHAR(8)

SET @V_DT_WORK = CONVERT(CHAR(8), GETDATE(), 112)

SELECT @V_NO_REV = ISNULL(MAX(NO_REV), 0) + 1  
FROM CZ_SA_LOG_PLAN_REV

INSERT INTO CZ_SA_LOG_PLAN_REV
(
	CD_COMPANY,
	NO_REV,
	DT_WORK,
	ID_INSERT,
	DTS_INSERT
)
VALUES
(
	@P_CD_COMPANY,
	@V_NO_REV,
	@V_DT_WORK,
	@P_ID_USER,
	NEOE.SF_SYSDATE(GETDATE())
)

INSERT INTO CZ_SA_LOG_PLAN_SHIP
(
    CD_COMPANY,
	NO_REV,
	NO_IDX,
	NO_GIR,
	DT_COMPLETE,
	DC_ITEM,
	DC_ETC,
	ID_INSERT,
	DTS_INSERT
)
SELECT CD_COMPANY,
	   @V_NO_REV AS NO_REV,
	   NO_IDX,
	   NO_GIR,
	   DT_COMPLETE,
	   DC_ITEM,
	   DC_ETC,
	   @P_ID_USER AS ID_INSERT,
	   NEOE.SF_SYSDATE(GETDATE()) AS DTS_INSERT
FROM CZ_SA_LOG_PLAN_SHIP
WHERE NO_REV = @P_NO_REV

INSERT INTO CZ_SA_LOG_PLAN_VESSEL
(
    CD_COMPANY,
	NO_REV,
	NO_IDX,
	NM_VESSEL,
	NO_IMO,
	DC_LOCATION,
	DC_PORT,
	DC_EMP,
	DC_ETB,
	DC_ETD,
	DT_COMPLETE,
	DC_CAR,
	DC_ITEM,
	DC_TEL,
	DC_ETC,
	NO_GIR,
	ID_INSERT,
	DTS_INSERT
)
SELECT CD_COMPANY,
	   @V_NO_REV AS NO_REV,
	   NO_IDX,
	   NM_VESSEL,
	   NO_IMO,
	   DC_LOCATION,
	   DC_PORT,
	   DC_EMP,
	   DC_ETB,
	   DC_ETD,
	   DT_COMPLETE,
	   DC_CAR,
	   DC_ITEM,
	   DC_TEL,
	   DC_ETC,
	   NO_GIR,
	   @P_ID_USER AS ID_INSERT,
	   NEOE.SF_SYSDATE(GETDATE()) AS DTS_INSERT
FROM CZ_SA_LOG_PLAN_VESSEL
WHERE NO_REV = @P_NO_REV

INSERT INTO CZ_SA_LOG_PLAN_DELIVERY
(
    CD_COMPANY,
	NO_REV,
	NO_IDX,
	NO_GIR,
	DC_LOCATION,
	DC_TASK,
	CD_PARTNER,
	NO_EMP,
	QT_ITEM,
	NO_IMO,
	DT_COMPLETE,
	NO_SO_PRE,
	DC_UPDATE,
	DC_LIMIT,
	DC_ETC,
	ID_INSERT,
	DTS_INSERT
)
SELECT CD_COMPANY,
	   @V_NO_REV AS NO_REV,
	   NO_IDX,
	   NO_GIR,
	   DC_LOCATION,
	   DC_TASK,
	   CD_PARTNER,
	   NO_EMP,
	   QT_ITEM,
	   NO_IMO,
	   DT_COMPLETE,
	   NO_SO_PRE,
	   DC_UPDATE,
	   DC_LIMIT,
	   DC_ETC,
	   @P_ID_USER AS ID_INSERT,
	   NEOE.SF_SYSDATE(GETDATE()) AS DTS_INSERT
FROM CZ_SA_LOG_PLAN_DELIVERY
WHERE NO_REV = @P_NO_REV

GO