USE [NEOE]
GO

/****** Object:  StoredProcedure [NEOE].[SP_CZ_SA_PACK_MNGL_S]    Script Date: 2015-09-14 오후 3:58:53 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

ALTER PROCEDURE [NEOE].[SP_CZ_SA_PACK_MNGL_S]
(
	@P_CD_COMPANY			NVARCHAR(7),
	@P_NO_GIR				NVARCHAR(20),
	@P_NO_PACK				NVARCHAR(20)
)
AS

SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED

SELECT PL.CD_COMPANY,
	   PL.NO_GIR,
	   PL.NO_PACK,
	   (PL.NO_GIR + '_' + CONVERT(NVARCHAR(5), PL.NO_PACK)) AS NO_KEY,
	   PL.SEQ_GIR,
	   PL.NO_FILE,
	   SL.NO_PO_PARTNER,
	   QL.NO_LINE AS NO_QTLINE,
	   QL.NO_DSP,
	   PL.CD_ITEM,
	   MP.NM_ITEM,
	   QL.CD_ITEM_PARTNER,
	   QL.NM_ITEM_PARTNER,
	   QL.YN_DSP_RMK,
	   QL.DC_RMK,
	   PL.QT_PACK,
	   QL.NM_SUBJECT,
	   SL.UNIT_IM,
	   SL.UM_EX_Q,
	   (ISNULL(SL.UM_EX_Q, 0) * ISNULL(PL.QT_PACK, 0)) AS AM_EX_Q,
	   SL.RT_DC,
	   -((ISNULL(SL.UM_EX_Q, 0) - ISNULL(SL.UM_EX_S, 0)) * ISNULL(PL.QT_PACK, 0)) AS AM_DC,
	   (ISNULL(SL.UM_EX_S, 0) * ISNULL(PL.QT_PACK, 0)) AS AM_GIR,
	   SH.CD_EXCH,
	   CD.NM_SYSDEF AS NM_EXCH
FROM CZ_SA_PACKL PL
LEFT JOIN CZ_SA_QTNL QL ON QL.CD_COMPANY = PL.CD_COMPANY AND QL.NO_FILE = PL.NO_FILE AND QL.NO_LINE = PL.NO_QTLINE
LEFT JOIN SA_SOL SL ON SL.CD_COMPANY = PL.CD_COMPANY AND SL.NO_SO = PL.NO_FILE AND SL.SEQ_SO = PL.NO_QTLINE
LEFT JOIN SA_SOH SH ON SH.CD_COMPANY = SL.CD_COMPANY AND SH.NO_SO = SL.NO_SO
LEFT JOIN MA_PITEM MP ON MP.CD_COMPANY = PL.CD_COMPANY AND MP.CD_ITEM = PL.CD_ITEM
LEFT JOIN MA_CODEDTL CD ON CD.CD_COMPANY = SH.CD_COMPANY AND CD.CD_FIELD = 'MA_B000005' AND CD.CD_SYSDEF = SH.CD_EXCH
WHERE PL.CD_COMPANY = @P_CD_COMPANY
AND PL.NO_GIR = @P_NO_GIR
AND (@P_NO_PACK = 0 OR PL.NO_PACK = @P_NO_PACK)
ORDER BY PL.NO_GIR, PL.NO_PACK, PL.NO_FILE, QL.NO_DSP

GO