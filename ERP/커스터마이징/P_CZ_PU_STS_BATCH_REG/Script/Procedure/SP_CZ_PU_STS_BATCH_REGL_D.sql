USE [NEOE]
GO

/****** Object:  StoredProcedure [NEOE].[SP_CZ_PU_STS_BATCH_REGL_D]    Script Date: 2017-02-14 오후 6:58:07 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO


ALTER PROCEDURE [NEOE].[SP_CZ_PU_STS_BATCH_REGL_D]        
(
	@P_CD_COMPANY   NVARCHAR(7),
	@P_NO_GIREQ     NVARCHAR(20),
	@P_NO_LINE		NUMERIC(5, 0),
	@P_ID_DELETE	NVARCHAR(15)
)        
AS

INSERT INTO MM_GIREQL_BACK
(
	NO_GIREQ,
	NO_LINE,
	CD_PLANT,
	CD_COMPANY,
	CD_ITEM,
	DT_DELIVERY,
	CD_SL,
	QT_GIREQ,
	QT_GI,
	ID_INSERT,
	DTS_INSERT,
	ID_UPDATE,
	DTS_UPDATE,
	CD_GRSL,
	NO_PO,
	NO_PO_LINE,
	NO_PO_MAL_LINE,
	YN_APPEND,
	NO_WO,
	NO_WO_LINE,
	CD_WC,
	CD_WCOP,
	QT_PO_MM,
	CD_WORKITEM,
	QT_WORK,
	CD_PJT,
	DC_RMK,
	QT_REQ,
	QT_RES,
	QT_REM,
	QT_ASS,
	QT_USE,
	QT_WEIGHT,
	UNIT_WEIGHT,
	UM_EX_PSO,
	UM_EX,
	UM,
	AM_EX,
	AM,
	CD_EXCH,
	RT_EXCH,
	DT_REC,
	YN_CLOSE,
	NO_SO,
	SEQ_SO,
	SEQ_MGMT,
	SEQ_PROJECT,
	NO_WBS,
	NO_CBS,
	NO_LOT_DISP,
	CD_USERDEF1,
	CD_USERDEF2,
	CD_USERDEF3,
	NO_LINE_PJTBOM,
	QT_MGREQ,
	YN_CONFIRM,
	FG_POST,
	DT_CONFIRM,
	NO_INTPO,
	SEQ_INTPO,
	QT_DLV,
	FG_GUBUN,
	NO_LINK,
	NO_LINE_LINK,
	YN_PICKING,
	CD_CENTER,
	NO_AS,
	NO_ASLINE,
	CD_USERDEF5,
	CD_USERDEF6,
	TXT_USERDEF1,
	CD_ITEM_REF,
	GI_PARTNER,
	CD_CC,
	SETPOS_NO,
	ID_MEMO,
	CD_WBS,
	NO_SHARE,
	NO_ISSUE,
	NM_USERDEF1,
	NM_USERDEF2,
	DATE_USERDEF1,
	NUM_USERDEF1,
	NUM_USERDEF2,
	NUM_USERDEF3,
	YN_SEND_LEGACY,
    ID_DELETE,
	DTS_DELETE
)
SELECT NO_GIREQ,
	   NO_LINE,
	   CD_PLANT,
	   CD_COMPANY,
	   CD_ITEM,
	   DT_DELIVERY,
	   CD_SL,
	   QT_GIREQ,
	   QT_GI,
	   ID_INSERT,
	   DTS_INSERT,
	   ID_UPDATE,
	   DTS_UPDATE,
	   CD_GRSL,
	   NO_PO,
	   NO_PO_LINE,
	   NO_PO_MAL_LINE,
	   YN_APPEND,
	   NO_WO,
	   NO_WO_LINE,
	   CD_WC,
	   CD_WCOP,
	   QT_PO_MM,
	   CD_WORKITEM,
	   QT_WORK,
	   CD_PJT,
	   DC_RMK,
	   QT_REQ,
	   QT_RES,
	   QT_REM,
	   QT_ASS,
	   QT_USE,
	   QT_WEIGHT,
	   UNIT_WEIGHT,
	   UM_EX_PSO,
	   UM_EX,
	   UM,
	   AM_EX,
	   AM,
	   CD_EXCH,
	   RT_EXCH,
	   DT_REC,
	   YN_CLOSE,
	   NO_SO,
	   SEQ_SO,
	   SEQ_MGMT,
	   SEQ_PROJECT,
	   NO_WBS,
	   NO_CBS,
	   NO_LOT_DISP,
	   CD_USERDEF1,
	   CD_USERDEF2,
	   CD_USERDEF3,
	   NO_LINE_PJTBOM,
	   QT_MGREQ,
	   YN_CONFIRM,
	   FG_POST,
	   DT_CONFIRM,
	   NO_INTPO,
	   SEQ_INTPO,
	   QT_DLV,
	   FG_GUBUN,
	   NO_LINK,
	   NO_LINE_LINK,
	   YN_PICKING,
	   CD_CENTER,
	   NO_AS,
	   NO_ASLINE,
	   CD_USERDEF5,
	   CD_USERDEF6,
	   TXT_USERDEF1,
	   CD_ITEM_REF,
	   GI_PARTNER,
	   CD_CC,
	   SETPOS_NO,
	   ID_MEMO,
	   CD_WBS,
	   NO_SHARE,
	   NO_ISSUE,
	   NM_USERDEF1,
	   NM_USERDEF2,
	   DATE_USERDEF1,
	   NUM_USERDEF1,
	   NUM_USERDEF2,
	   NUM_USERDEF3,
	   YN_SEND_LEGACY,
	   @P_ID_DELETE AS ID_DELETE,
	   NEOE.SF_SYSDATE(GETDATE()) AS DTS_DELETE 
FROM MM_GIREQL
WHERE CD_COMPANY = @P_CD_COMPANY
AND NO_GIREQ = @P_NO_GIREQ
AND NO_LINE = @P_NO_LINE

DELETE FROM MM_GIREQL
WHERE CD_COMPANY = @P_CD_COMPANY
AND NO_GIREQ = @P_NO_GIREQ
AND NO_LINE = @P_NO_LINE

IF NOT EXISTS (SELECT 1 
			   FROM MM_GIREQL
			   WHERE CD_COMPANY = @P_CD_COMPANY
			   AND NO_GIREQ = @P_NO_GIREQ)
BEGIN
	INSERT INTO MM_GIREQH_BACK
	(
		NO_GIREQ,
		CD_PLANT,
		CD_COMPANY,
		DT_GIREQ,
		FG_GIREQ,
		FG_GI,
		CD_DEPT,
		NO_EMP,
		DC50_PO,
		CD_SL,
		NO_PR_PACK,
		CD_GRPLANT,
		CD_PARTNER,
		FG_MODULE,
		CD_PJT,
		CD_CAR,
		DC_RMK2,
		YN_APP,
		ST_STAT,
		GI_PARTNER,
		CNT_PRINT,
		LAST_PRINT_ID,
		DATE_USERDEF1,
		ID_DELETE,
		DTS_DELETE
	)
	SELECT NO_GIREQ,
		   CD_PLANT,
		   CD_COMPANY,
		   DT_GIREQ,
		   FG_GIREQ,
		   FG_GI,
		   CD_DEPT,
		   NO_EMP,
		   DC50_PO,
		   CD_SL,
		   NO_PR_PACK,
		   CD_GRPLANT,
		   CD_PARTNER,
		   FG_MODULE,
		   CD_PJT,
		   CD_CAR,
		   DC_RMK2,
		   YN_APP,
		   ST_STAT,
		   GI_PARTNER,
		   CNT_PRINT,
		   LAST_PRINT_ID,
		   DATE_USERDEF1,
		   @P_ID_DELETE AS ID_DELETE,
		   NEOE.SF_SYSDATE(GETDATE()) AS DTS_DELETE 
	FROM MM_GIREQH
	WHERE CD_COMPANY = @P_CD_COMPANY
	AND NO_GIREQ = @P_NO_GIREQ
	
	DELETE FROM MM_GIREQH
	WHERE CD_COMPANY = @P_CD_COMPANY
	AND NO_GIREQ = @P_NO_GIREQ	
END

GO