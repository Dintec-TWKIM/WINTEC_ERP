USE [NEOE]
GO

/****** Object:  StoredProcedure [NEOE].[UP_PU_PO_SUB2_SELECT_L]    Script Date: 2019-07-08 오후 4:47:32 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

ALTER PROCEDURE [NEOE].[SP_CZ_PU_PO_REG2_SUBL]
(
	@P_CD_COMPANY 		NVARCHAR(7),
	@P_NO_PO 			NVARCHAR(20)
)
AS

SELECT PL.NO_PO, 
	   PL.NO_LINE, 
	   PL.CD_ITEM, 
	   MI.NM_ITEM, 
	   MI.STND_ITEM, 
	   MI.UNIT_IM,
	   PL.CD_UNIT_MM, 
	   PL.QT_PO_MM, 
	   PL.UM_EX_PO, 
	   PL.AM_EX, 
	   PL.AM_EX, 
	   PL.AM, 
	   PL.VAT, 
	   PL.QT_PO, 
	   PL.CD_PJT,
	   PL.DC1, 
	   PL.DC2,
	   PL.DC3,
	   MI.CLS_ITEM,
	   (SELECT NM_SYSDEF 
		FROM MA_CODEDTL MC 
		WHERE MC.CD_COMPANY = @P_CD_COMPANY 
		AND MC.CD_FIELD = 'MA_B000010' 
		AND MC.CD_SYSDEF = MI.CLS_ITEM) AS NM_CLS_ITEM ,
	   PL.DT_LIMIT,
	   (CASE WHEN LEN(PL.CD_PJT) > 0 THEN (SELECT TOP 1 PJ.NM_PROJECT 
										   FROM SA_PROJECTH PJ 
										   WHERE PJ.CD_COMPANY = PL.CD_COMPANY 
										   AND PJ.NO_PROJECT = PL.CD_PJT 
										   ORDER BY NO_SEQ DESC) ELSE '' END) AS NM_PJT,
	   PL.UM_EX,
	   MI.STND_DETAIL_ITEM	 
FROM PU_POL PL
LEFT JOIN MA_PITEM MI ON PL.CD_COMPANY = MI.CD_COMPANY AND PL.CD_PLANT = MI.CD_PLANT AND PL.CD_ITEM = MI.CD_ITEM
WHERE  PL.CD_COMPANY =@P_CD_COMPANY 
AND PL.NO_PO = @P_NO_PO
ORDER BY PL.NO_LINE

GO

