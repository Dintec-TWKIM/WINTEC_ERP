USE [NEOE]
GO

/****** Object:  StoredProcedure [NEOE].[SP_CZ_SA_EALRY_WARNING_SYSTEM_SUB_CONFIRM]    Script Date: 2019-05-31 오후 2:52:04 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO


ALTER PROCEDURE [NEOE].[SP_CZ_SA_EALRY_WARNING_SYSTEM_SUB_CONFIRM]
(
	@P_CD_COMPANY NVARCHAR(7)
) 
AS
 
SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED

INSERT INTO CZ_SA_EWS_CONDITION_BACKUP
(
	CD_COMPANY, 
	DT_BACKUP, 
	YN_SIMULATION, 
	TP_GUBUN, 
	CD_EWS, 
	DC_EWS, 
	DC_EWS1, 
	DC_EWS2, 
	DC_EWS3, 
	YN_USE, 
	ID_INSERT, 
	DTS_INSERT, 
	ID_UPDATE, 
	DTS_UPDATE
)
SELECT CD_COMPANY, 
	   CONVERT(CHAR(8), GETDATE(), 112) DT_BACKUP, 
	   YN_SIMULATION, 
	   TP_GUBUN, 
	   CD_EWS, 
	   DC_EWS, 
	   DC_EWS1, 
	   DC_EWS2, 
	   DC_EWS3, 
	   YN_USE, 
	   ID_INSERT, 
	   DTS_INSERT, 
	   ID_UPDATE, 
	   DTS_UPDATE 
FROM CZ_SA_EWS_CONDITION
WHERE CD_COMPANY = @P_CD_COMPANY

DELETE 
FROM CZ_SA_EWS_CONDITION
WHERE CD_COMPANY = @P_CD_COMPANY
AND YN_SIMULATION = 'N'

INSERT INTO CZ_SA_EWS_CONDITION
(
	CD_COMPANY, 
	YN_SIMULATION, 
	TP_GUBUN, 
	CD_EWS, 
	DC_EWS, 
	DC_EWS1, 
	DC_EWS2, 
	DC_EWS3, 
	YN_USE, 
	ID_INSERT, 
	DTS_INSERT, 
	ID_UPDATE, 
	DTS_UPDATE
)
SELECT CD_COMPANY,
	   'N' AS YN_SIMULATION, 
	   TP_GUBUN, 
	   CD_EWS, 
	   DC_EWS, 
	   DC_EWS1, 
	   DC_EWS2, 
	   DC_EWS3, 
	   YN_USE, 
	   ID_INSERT, 
	   DTS_INSERT, 
	   ID_UPDATE, 
	   DTS_UPDATE 
FROM CZ_SA_EWS_CONDITION
WHERE CD_COMPANY = @P_CD_COMPANY
AND YN_SIMULATION = 'Y'

GO

