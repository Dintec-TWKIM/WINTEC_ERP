USE [NEOE]
GO

/****** Object:  StoredProcedure [NEOE].[SP_CZ_MA_WORKFLOWH_U]    Script Date: 2015-11-25 오전 11:13:54 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO


ALTER PROCEDURE [NEOE].[SP_CZ_MA_WORKFLOWH_U]  
(
	@P_CD_COMPANY			NVARCHAR(7),
	@P_STEP					NVARCHAR(2),
	@P_NO_KEY				NVARCHAR(20),
	@P_ID_USER				NVARCHAR(15),
	@P_CD_RMK				NVARCHAR(MAX),
	@P_DC_RMK				NVARCHAR(MAX),
	@P_DT_BILL				NVARCHAR(8)
)
AS

IF @P_STEP = '12'
BEGIN
	IF EXISTS (SELECT 1 FROM CZ_SA_CONTRACT_RPTH WHERE CD_COMPANY = @P_CD_COMPANY AND NO_SO = @P_NO_KEY)
	BEGIN
		UPDATE CZ_SA_CONTRACT_RPTH
		SET DC_COMMENT_FIRST = @P_CD_RMK,
			DC_COMMENT_SECOND = @P_DC_RMK,
			ID_UPDATE = @P_ID_USER,
			DTS_UPDATE = NEOE.SF_SYSDATE(GETDATE())
		WHERE CD_COMPANY = @P_CD_COMPANY
		AND NO_SO = @P_NO_KEY
	END
	ELSE
	BEGIN
		INSERT INTO CZ_SA_CONTRACT_RPTH
		(
			CD_COMPANY,
			NO_SO,
			DC_COMMENT_FIRST,
			DC_COMMENT_SECOND,
			ID_INSERT,
			DTS_INSERT
		)
		VALUES
		(
			@P_CD_COMPANY,
			@P_NO_KEY,
			@P_CD_RMK,
			@P_DC_RMK,
			@P_ID_USER,
			NEOE.SF_SYSDATE(GETDATE())
		)
	END
END
ELSE IF @P_STEP = '13'
BEGIN
	UPDATE SA_SOH
	SET DC_RMK_TEXT2 = @P_DC_RMK,
		ID_UPDATE = @P_ID_USER,
		DTS_UPDATE = NEOE.SF_SYSDATE(GETDATE())
	WHERE CD_COMPANY = @P_CD_COMPANY
	AND NO_SO = @P_NO_KEY
END
ELSE IF @P_STEP = '17'
BEGIN
	IF NOT EXISTS (SELECT 1 
				   FROM CZ_SA_GIRH_WORK_DETAIL
				   WHERE CD_COMPANY = @P_CD_COMPANY
				   AND NO_GIR = @P_NO_KEY)
	BEGIN
		INSERT INTO CZ_SA_GIRH_WORK_DETAIL
		(
			CD_COMPANY,
			NO_GIR,
			DC_RMK2,
			ID_INSERT,
			DTS_INSERT
		)
		VALUES
		(
			@P_CD_COMPANY,
			@P_NO_KEY,
			@P_DC_RMK,
			@P_ID_USER,
			NEOE.SF_SYSDATE(GETDATE())
		)
	END
	ELSE
	BEGIN
		UPDATE CZ_SA_GIRH_WORK_DETAIL
		SET DC_RMK2 = @P_DC_RMK,
			ID_UPDATE = @P_ID_USER,
			DTS_UPDATE = NEOE.SF_SYSDATE(GETDATE())
		WHERE CD_COMPANY = @P_CD_COMPANY
		AND NO_GIR = @P_NO_KEY	
	END
END
ELSE IF @P_STEP = '18'
BEGIN
	IF NOT EXISTS (SELECT 1 
				   FROM CZ_SA_GIRH_WORK_DETAIL
				   WHERE CD_COMPANY = @P_CD_COMPANY
				   AND NO_GIR = @P_NO_KEY)
	BEGIN
		INSERT INTO CZ_SA_GIRH_WORK_DETAIL
		(
			CD_COMPANY,
			NO_GIR,
			DC_RMK2,
			DT_BILL,
			ID_INSERT,
			DTS_INSERT
		)
		VALUES
		(
			@P_CD_COMPANY,
			@P_NO_KEY,
			@P_DC_RMK,
			@P_DT_BILL,
			@P_ID_USER,
			NEOE.SF_SYSDATE(GETDATE())
		)
	END
	ELSE
	BEGIN
		UPDATE CZ_SA_GIRH_WORK_DETAIL
		SET DC_RMK2 = @P_DC_RMK,
			DT_BILL = @P_DT_BILL,
			ID_UPDATE = @P_ID_USER,
			DTS_UPDATE = NEOE.SF_SYSDATE(GETDATE())
		WHERE CD_COMPANY = @P_CD_COMPANY
		AND NO_GIR = @P_NO_KEY	
	END
END
ELSE IF @P_STEP = '19'
BEGIN
	IF NOT EXISTS (SELECT 1 FROM CZ_MA_WORKFLOWH WHERE CD_COMPANY = @P_CD_COMPANY AND NO_KEY = @P_NO_KEY AND TP_STEP = '19')
		INSERT CZ_MA_WORKFLOWH
		(
			CD_COMPANY,
			NO_KEY,
			TP_STEP,
			CD_RMK,
			DC_RMK,
			INSERT_HIST,
			ID_INSERT,
			DTS_INSERT
		)
		VALUES
		(
			@P_CD_COMPANY,
			@P_NO_KEY,
			'19',
			@P_CD_RMK,
			@P_DC_RMK,
			'SP_CZ_MA_WORKFLOWH_U',
			@P_ID_USER,
			NEOE.SF_SYSDATE(GETDATE())
		)
	ELSE
		UPDATE CZ_MA_WORKFLOWH
		SET CD_RMK = @P_CD_RMK,
			DC_RMK = @P_DC_RMK,
			UPDATE_HIST = 'SP_CZ_MA_WORKFLOWH_U',
			ID_UPDATE = @P_ID_USER,
			DTS_UPDATE = NEOE.SF_SYSDATE(GETDATE())
		WHERE CD_COMPANY = @P_CD_COMPANY
		AND NO_KEY = @P_NO_KEY	
		AND TP_STEP = '19'
END
ELSE IF @P_STEP = '20'
BEGIN
	UPDATE CZ_SA_CLAIMH
	SET DC_RMK = @P_DC_RMK,
		ID_UPDATE = @P_ID_USER,
		DTS_UPDATE = NEOE.SF_SYSDATE(GETDATE())
	WHERE CD_COMPANY = @P_CD_COMPANY
	AND NO_CLAIM = @P_NO_KEY
END
ELSE IF @P_STEP = '22'
BEGIN
	IF NOT EXISTS (SELECT 1 
				   FROM CZ_SA_GIRH_WORK_DETAIL
				   WHERE CD_COMPANY = @P_CD_COMPANY
				   AND NO_GIR = @P_NO_KEY)
	BEGIN
		INSERT INTO CZ_SA_GIRH_WORK_DETAIL
		(
			CD_COMPANY,
			NO_GIR,
			DC_RMK2,
			DT_BILL,
			ID_INSERT,
			DTS_INSERT
		)
		VALUES
		(
			@P_CD_COMPANY,
			@P_NO_KEY,
			@P_DC_RMK,
			@P_DT_BILL,
			@P_ID_USER,
			NEOE.SF_SYSDATE(GETDATE())
		)
	END
	ELSE
	BEGIN
		UPDATE CZ_SA_GIRH_WORK_DETAIL
		SET DC_RMK2 = @P_DC_RMK,
			DT_BILL = @P_DT_BILL,
			ID_UPDATE = @P_ID_USER,
			DTS_UPDATE = NEOE.SF_SYSDATE(GETDATE())
		WHERE CD_COMPANY = @P_CD_COMPANY
		AND NO_GIR = @P_NO_KEY	
	END
END
ELSE IF @P_STEP = '23'
BEGIN
	UPDATE CZ_PU_IV_CONFIRM
	SET DC_RMK_WF = REPLACE(@P_DC_RMK, CHAR(10), CHAR(13) + CHAR(10)),
	    ID_UPDATE = @P_ID_USER,
	    DTS_UPDATE = NEOE.SF_SYSDATE(GETDATE())
	WHERE CD_COMPANY = @P_CD_COMPANY
	AND SEQ = @P_NO_KEY
END
ELSE
BEGIN
	UPDATE CZ_MA_WORKFLOWH
	SET DC_RMK = @P_DC_RMK,
		UPDATE_HIST = 'SP_CZ_MA_WORKFLOWH_U',
	    ID_UPDATE = @P_ID_USER,
		DTS_UPDATE = NEOE.SF_SYSDATE(GETDATE())
	WHERE CD_COMPANY = @P_CD_COMPANY
	AND TP_STEP = @P_STEP
	AND NO_KEY = @P_NO_KEY	
END




GO

