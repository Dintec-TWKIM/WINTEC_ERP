USE [NEOE]
GO

/****** Object:  StoredProcedure [NEOE].[SP_CZ_MA_WORKFLOW_COUNT_20]    Script Date: 2018-08-21 오후 4:55:01 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO




-- 클레임종결
ALTER PROCEDURE [NEOE].[SP_CZ_MA_WORKFLOW_COUNT_20]  
(
	@P_CD_COMPANY			NVARCHAR(7),
	@P_ID_USER				NVARCHAR(15),
	@P_NO_KEY				NVARCHAR(20),
	@P_CD_SALEORG			NVARCHAR(7),		
	@P_CD_SALEGRP			NVARCHAR(500)
)
AS

SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED

SELECT COUNT(1) AS CNT
FROM CZ_SA_CLAIMH CH
LEFT JOIN SA_SOH SH ON SH.CD_COMPANY = CH.CD_COMPANY AND SH.NO_SO = CH.NO_SO
LEFT JOIN FI_GWDOCU GW ON GW.CD_COMPANY = 'K100' AND GW.CD_PC = '010000' AND GW.NO_DOCU = CH.CD_COMPANY + '-' + CH.NO_CLAIM + '-' + CH.CD_STATUS
WHERE (CH.CD_STATUS IN ('0', '1', '2') OR 
	   (CH.CD_STATUS = '3' AND (GW.ST_STAT IS NULL OR GW.ST_STAT IN ('0', '-1', '2', '3')))) 
AND (ISNULL(@P_CD_COMPANY, '') = '' OR CH.CD_COMPANY = @P_CD_COMPANY)
AND (ISNULL(@P_NO_KEY, '') = '' OR CH.NO_SO = @P_NO_KEY)
AND (ISNULL(@P_ID_USER, '') = '' OR CH.NO_EMP = @P_ID_USER)
AND (ISNULL(@P_CD_SALEGRP, '') = '' OR SH.CD_SALEGRP IN (SELECT CD_STR FROM GETTABLEFROMSPLIT(@P_CD_SALEGRP)))
AND (ISNULL(@P_CD_SALEORG, '') = '' OR EXISTS (SELECT 1 
											   FROM MA_SALEGRP
											   WHERE CD_COMPANY = SH.CD_COMPANY
											   AND CD_SALEGRP = SH.CD_SALEGRP
											   AND CD_SALEORG = @P_CD_SALEORG))

GO

