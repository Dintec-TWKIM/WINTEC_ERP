USE [NEOE]
GO
/****** Object:  StoredProcedure [NEOE].[P_CZ_MM_NOT_GI_ITEM_LIST_S1]    Script Date: 2023-04-20 오후 5:43:15 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


ALTER PROCEDURE [NEOE].[P_CZ_MM_NOT_GI_ITEM_LIST_S1]
AS

SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED

SELECT TOP 100 'N' AS S, 
			   C.CD_ITEM,
			   A.NM_ITEM,
			   B.QT_AVST,
			   ((CASE WHEN A.CD_COMPANY = 'K200' THEN 'http://erpd.dintec.co.kr/stock/m/write.aspx?code=' 
												 ELSE 'http://erp.dintec.co.kr/stock/m/write.aspx?code=' END) + A.CD_ITEM) AS CD_QR
FROM MA_PITEM AS A
JOIN CZ_DX_STOCK_QT AS B ON A.CD_COMPANY = B.CD_COMPANY AND A.CD_ITEM = B.CD_ITEM
JOIN CZ_MA_PITEM_FILE AS C ON A.CD_COMPANY = C.CD_COMPANY AND A.CD_ITEM = C.CD_ITEM
WHERE A.CD_COMPANY = 'K100'
AND A.CLS_ITEM = '009'
AND LEN(A.CD_ITEM) = 7	
AND B.QT_AVST > 0
AND NOT LEFT(A.CD_ITEM, 2) IN ('CL', 'SE')
AND NOT RIGHT(ISNULL(C.IMAGE1, ''), 4) IN ('.JPG', 'JPEG', '.PNG')
AND NOT RIGHT(ISNULL(C.IMAGE2, ''), 4) IN ('.JPG', 'JPEG', '.PNG')
AND NOT RIGHT(ISNULL(C.IMAGE3, ''), 4) IN ('.JPG', 'JPEG', '.PNG')
AND NOT RIGHT(ISNULL(C.IMAGE4, ''), 4) IN ('.JPG', 'JPEG', '.PNG')
AND NOT RIGHT(ISNULL(C.IMAGE5, ''), 4) IN ('.JPG', 'JPEG', '.PNG')
AND NOT RIGHT(ISNULL(C.IMAGE6, ''), 4) IN ('.JPG', 'JPEG', '.PNG')
AND NOT RIGHT(ISNULL(C.IMAGE7, ''), 4) IN ('.JPG', 'JPEG', '.PNG')
ORDER BY C.CD_ITEM ASC

