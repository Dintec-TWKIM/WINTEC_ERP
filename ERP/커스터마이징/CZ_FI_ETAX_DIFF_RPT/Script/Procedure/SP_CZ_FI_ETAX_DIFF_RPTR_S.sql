USE [NEOE]
GO
/****** Object:  StoredProcedure [NEOE].[SP_CZ_FI_ETAX_DIFF_RPTR_S]    Script Date: 2018-02-09 오전 9:32:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

ALTER PROCEDURE [NEOE].[SP_CZ_FI_ETAX_DIFF_RPTR_S]
(
	@P_CD_COMPANY		NVARCHAR(7),
    @P_DT_START         NVARCHAR(8),
	@P_NO_COMPANY		NVARCHAR(200),
	@P_TP_ETAX			NVARCHAR(3)
) 
AS
 
SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED

IF @P_TP_ETAX = '001'
BEGIN
	SELECT TX.NO_TAX,
		   TX.NO_DOCU,
		   TX.NO_DOLINE,
		   TX.DT_START,
		   TX.CD_PARTNER,
		   MP.LN_PARTNER,
		   TX.AM_TAXSTD,
		   TX.AM_ADDTAX,
		   TX.TP_TAX,
		   MC.NM_SYSDEF AS NM_TAX,
		   TX.CD_PC
	FROM FI_TAX TX
	LEFT JOIN MA_PARTNER MP ON MP.CD_COMPANY = TX.CD_COMPANY AND MP.CD_PARTNER = TX.CD_PARTNER
	LEFT JOIN MA_CODEDTL MC ON MC.CD_COMPANY = TX.CD_COMPANY AND MC.CD_FIELD = 'MA_B000046' AND MC.CD_SYSDEF = TX.TP_TAX
	WHERE TX.CD_COMPANY = @P_CD_COMPANY
	AND TX.TP_TAX IN ('21', '22', '23', '38', '43', '69')
	AND TX.ID_UPDATE = @P_NO_COMPANY
	AND TX.DT_START = @P_DT_START
END
ELSE
BEGIN
	SELECT TX.NO_TAX,
		   TX.NO_DOCU,
		   TX.NO_DOLINE,
		   TX.DT_START,
		   TX.CD_PARTNER,
		   MP.LN_PARTNER,
		   TX.AM_TAXSTD,
		   TX.AM_ADDTAX,
		   TX.TP_TAX,
		   MC.NM_SYSDEF AS NM_TAX,
		   TX.CD_PC
	FROM FI_TAX TX
	LEFT JOIN MA_PARTNER MP ON MP.CD_COMPANY = TX.CD_COMPANY AND MP.CD_PARTNER = TX.CD_PARTNER
	LEFT JOIN MA_CODEDTL MC ON MC.CD_COMPANY = TX.CD_COMPANY AND MC.CD_FIELD = 'MA_B000046' AND MC.CD_SYSDEF = TX.TP_TAX
	WHERE TX.CD_COMPANY = @P_CD_COMPANY
	AND TX.TP_TAX IN ('26','27','29','32','40','44','46','48','51','54','61','63','65','67')
	AND TX.ID_UPDATE = @P_NO_COMPANY
	AND TX.DT_START = @P_DT_START
END

